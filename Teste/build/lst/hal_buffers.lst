   1               		.file	"hal_buffers.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.ibqObjectInit,"ax",@progbits
  11               	.global	ibqObjectInit
  13               	ibqObjectInit:
  14               	.LFB168:
  15               		.file 1 "../../../os/hal/src/hal_buffers.c"
   1:../../../os/hal/src/hal_buffers.c **** /*
   2:../../../os/hal/src/hal_buffers.c ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio
   3:../../../os/hal/src/hal_buffers.c **** 
   4:../../../os/hal/src/hal_buffers.c ****     Licensed under the Apache License, Version 2.0 (the "License");
   5:../../../os/hal/src/hal_buffers.c ****     you may not use this file except in compliance with the License.
   6:../../../os/hal/src/hal_buffers.c ****     You may obtain a copy of the License at
   7:../../../os/hal/src/hal_buffers.c **** 
   8:../../../os/hal/src/hal_buffers.c ****         http://www.apache.org/licenses/LICENSE-2.0
   9:../../../os/hal/src/hal_buffers.c **** 
  10:../../../os/hal/src/hal_buffers.c ****     Unless required by applicable law or agreed to in writing, software
  11:../../../os/hal/src/hal_buffers.c ****     distributed under the License is distributed on an "AS IS" BASIS,
  12:../../../os/hal/src/hal_buffers.c ****     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13:../../../os/hal/src/hal_buffers.c ****     See the License for the specific language governing permissions and
  14:../../../os/hal/src/hal_buffers.c ****     limitations under the License.
  15:../../../os/hal/src/hal_buffers.c **** */
  16:../../../os/hal/src/hal_buffers.c **** 
  17:../../../os/hal/src/hal_buffers.c **** /**
  18:../../../os/hal/src/hal_buffers.c ****  * @file    hal_buffers.c
  19:../../../os/hal/src/hal_buffers.c ****  * @brief   I/O Buffers code.
  20:../../../os/hal/src/hal_buffers.c ****  *
  21:../../../os/hal/src/hal_buffers.c ****  * @addtogroup HAL_BUFFERS
  22:../../../os/hal/src/hal_buffers.c ****  * @details Buffers Queues are used when there is the need to exchange
  23:../../../os/hal/src/hal_buffers.c ****  *          fixed-length data buffers between ISRs and threads.
  24:../../../os/hal/src/hal_buffers.c ****  *          On the ISR side data can be exchanged only using buffers,
  25:../../../os/hal/src/hal_buffers.c ****  *          on the thread side data can be exchanged both using buffers and/or
  26:../../../os/hal/src/hal_buffers.c ****  *          using an emulation of regular byte queues.
  27:../../../os/hal/src/hal_buffers.c ****  *          There are several kind of buffers queues:<br>
  28:../../../os/hal/src/hal_buffers.c ****  *          - <b>Input queue</b>, unidirectional queue where the writer is the
  29:../../../os/hal/src/hal_buffers.c ****  *            ISR side and the reader is the thread side.
  30:../../../os/hal/src/hal_buffers.c ****  *          - <b>Output queue</b>, unidirectional queue where the writer is the
  31:../../../os/hal/src/hal_buffers.c ****  *            ISR side and the reader is the thread side.
  32:../../../os/hal/src/hal_buffers.c ****  *          - <b>Full duplex queue</b>, bidirectional queue. Full duplex queues
  33:../../../os/hal/src/hal_buffers.c ****  *            are implemented by pairing an input queue and an output queue
  34:../../../os/hal/src/hal_buffers.c ****  *            together.
  35:../../../os/hal/src/hal_buffers.c ****  *          .
  36:../../../os/hal/src/hal_buffers.c ****  * @{
  37:../../../os/hal/src/hal_buffers.c ****  */
  38:../../../os/hal/src/hal_buffers.c **** 
  39:../../../os/hal/src/hal_buffers.c **** #include <string.h>
  40:../../../os/hal/src/hal_buffers.c **** 
  41:../../../os/hal/src/hal_buffers.c **** #include "hal.h"
  42:../../../os/hal/src/hal_buffers.c **** 
  43:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  44:../../../os/hal/src/hal_buffers.c **** /* Driver local definitions.                                                 */
  45:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  46:../../../os/hal/src/hal_buffers.c **** 
  47:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  48:../../../os/hal/src/hal_buffers.c **** /* Driver exported variables.                                                */
  49:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  50:../../../os/hal/src/hal_buffers.c **** 
  51:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  52:../../../os/hal/src/hal_buffers.c **** /* Driver local variables and types.                                         */
  53:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  54:../../../os/hal/src/hal_buffers.c **** 
  55:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  56:../../../os/hal/src/hal_buffers.c **** /* Driver local functions.                                                   */
  57:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  58:../../../os/hal/src/hal_buffers.c **** 
  59:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  60:../../../os/hal/src/hal_buffers.c **** /* Driver exported functions.                                                */
  61:../../../os/hal/src/hal_buffers.c **** /*===========================================================================*/
  62:../../../os/hal/src/hal_buffers.c **** 
  63:../../../os/hal/src/hal_buffers.c **** /**
  64:../../../os/hal/src/hal_buffers.c ****  * @brief   Initializes an input buffers queue object.
  65:../../../os/hal/src/hal_buffers.c ****  *
  66:../../../os/hal/src/hal_buffers.c ****  * @param[out] ibqp     pointer to the @p input_buffers_queue_t object
  67:../../../os/hal/src/hal_buffers.c ****  * @param[in] suspended initial state of the queue
  68:../../../os/hal/src/hal_buffers.c ****  * @param[in] bp        pointer to a memory area allocated for buffers
  69:../../../os/hal/src/hal_buffers.c ****  * @param[in] size      buffers size
  70:../../../os/hal/src/hal_buffers.c ****  * @param[in] n         number of buffers
  71:../../../os/hal/src/hal_buffers.c ****  * @param[in] infy      callback called when a buffer is returned to the queue
  72:../../../os/hal/src/hal_buffers.c ****  * @param[in] link      application defined pointer
  73:../../../os/hal/src/hal_buffers.c ****  *
  74:../../../os/hal/src/hal_buffers.c ****  * @init
  75:../../../os/hal/src/hal_buffers.c ****  */
  76:../../../os/hal/src/hal_buffers.c **** void ibqObjectInit(input_buffers_queue_t *ibqp, bool suspended, uint8_t *bp,
  77:../../../os/hal/src/hal_buffers.c ****                    size_t size, size_t n, bqnotify_t infy, void *link) {
  16               		.loc 1 77 0
  17               		.cfi_startproc
  18               	.LVL0:
  19 0000 CF92      		push r12
  20               	.LCFI0:
  21               		.cfi_def_cfa_offset 3
  22               		.cfi_offset 12, -2
  23 0002 DF92      		push r13
  24               	.LCFI1:
  25               		.cfi_def_cfa_offset 4
  26               		.cfi_offset 13, -3
  27 0004 EF92      		push r14
  28               	.LCFI2:
  29               		.cfi_def_cfa_offset 5
  30               		.cfi_offset 14, -4
  31 0006 FF92      		push r15
  32               	.LCFI3:
  33               		.cfi_def_cfa_offset 6
  34               		.cfi_offset 15, -5
  35 0008 0F93      		push r16
  36               	.LCFI4:
  37               		.cfi_def_cfa_offset 7
  38               		.cfi_offset 16, -6
  39 000a 1F93      		push r17
  40               	.LCFI5:
  41               		.cfi_def_cfa_offset 8
  42               		.cfi_offset 17, -7
  43               	/* prologue: function */
  44               	/* frame size = 0 */
  45               	/* stack size = 6 */
  46               	.L__stack_usage = 6
  47 000c FC01      		movw r30,r24
  48               	.LVL1:
  49               	.LBB254:
  50               	.LBB255:
  51               	.LBB256:
  52               	.LBB257:
  53               		.file 2 "../../../os/rt/include/chschd.h"
   1:../../../os/rt/include/chschd.h **** /*
   2:../../../os/rt/include/chschd.h ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio.
   3:../../../os/rt/include/chschd.h **** 
   4:../../../os/rt/include/chschd.h ****     This file is part of ChibiOS.
   5:../../../os/rt/include/chschd.h **** 
   6:../../../os/rt/include/chschd.h ****     ChibiOS is free software; you can redistribute it and/or modify
   7:../../../os/rt/include/chschd.h ****     it under the terms of the GNU General Public License as published by
   8:../../../os/rt/include/chschd.h ****     the Free Software Foundation; either version 3 of the License, or
   9:../../../os/rt/include/chschd.h ****     (at your option) any later version.
  10:../../../os/rt/include/chschd.h **** 
  11:../../../os/rt/include/chschd.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../../os/rt/include/chschd.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../../os/rt/include/chschd.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../../os/rt/include/chschd.h ****     GNU General Public License for more details.
  15:../../../os/rt/include/chschd.h **** 
  16:../../../os/rt/include/chschd.h ****     You should have received a copy of the GNU General Public License
  17:../../../os/rt/include/chschd.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../../os/rt/include/chschd.h **** */
  19:../../../os/rt/include/chschd.h **** 
  20:../../../os/rt/include/chschd.h **** /**
  21:../../../os/rt/include/chschd.h ****  * @file    chschd.h
  22:../../../os/rt/include/chschd.h ****  * @brief   Scheduler macros and structures.
  23:../../../os/rt/include/chschd.h ****  *
  24:../../../os/rt/include/chschd.h ****  * @addtogroup scheduler
  25:../../../os/rt/include/chschd.h ****  * @{
  26:../../../os/rt/include/chschd.h ****  */
  27:../../../os/rt/include/chschd.h **** 
  28:../../../os/rt/include/chschd.h **** #ifndef CHSCHD_H
  29:../../../os/rt/include/chschd.h **** #define CHSCHD_H
  30:../../../os/rt/include/chschd.h **** 
  31:../../../os/rt/include/chschd.h **** /*===========================================================================*/
  32:../../../os/rt/include/chschd.h **** /* Module constants.                                                         */
  33:../../../os/rt/include/chschd.h **** /*===========================================================================*/
  34:../../../os/rt/include/chschd.h **** 
  35:../../../os/rt/include/chschd.h **** /**
  36:../../../os/rt/include/chschd.h ****  * @name    Wakeup status codes
  37:../../../os/rt/include/chschd.h ****  * @{
  38:../../../os/rt/include/chschd.h ****  */
  39:../../../os/rt/include/chschd.h **** #define MSG_OK              (msg_t)0    /**< @brief Normal wakeup message.  */
  40:../../../os/rt/include/chschd.h **** #define MSG_TIMEOUT         (msg_t)-1   /**< @brief Wakeup caused by a timeout
  41:../../../os/rt/include/chschd.h ****                                              condition.                     */
  42:../../../os/rt/include/chschd.h **** #define MSG_RESET           (msg_t)-2   /**< @brief Wakeup caused by a reset
  43:../../../os/rt/include/chschd.h ****                                              condition.                     */
  44:../../../os/rt/include/chschd.h **** /** @} */
  45:../../../os/rt/include/chschd.h **** 
  46:../../../os/rt/include/chschd.h **** /**
  47:../../../os/rt/include/chschd.h ****  * @name    Priority constants
  48:../../../os/rt/include/chschd.h ****  * @{
  49:../../../os/rt/include/chschd.h ****  */
  50:../../../os/rt/include/chschd.h **** #define NOPRIO              (tprio_t)0      /**< @brief Ready list header
  51:../../../os/rt/include/chschd.h ****                                                  priority.                  */
  52:../../../os/rt/include/chschd.h **** #define IDLEPRIO            (tprio_t)1      /**< @brief Idle priority.      */
  53:../../../os/rt/include/chschd.h **** #define LOWPRIO             (tprio_t)2      /**< @brief Lowest priority.    */
  54:../../../os/rt/include/chschd.h **** #define NORMALPRIO          (tprio_t)128    /**< @brief Normal priority.    */
  55:../../../os/rt/include/chschd.h **** #define HIGHPRIO            (tprio_t)255    /**< @brief Highest priority.   */
  56:../../../os/rt/include/chschd.h **** /** @} */
  57:../../../os/rt/include/chschd.h **** 
  58:../../../os/rt/include/chschd.h **** /**
  59:../../../os/rt/include/chschd.h ****  * @name    Thread states
  60:../../../os/rt/include/chschd.h ****  * @{
  61:../../../os/rt/include/chschd.h ****  */
  62:../../../os/rt/include/chschd.h **** #define CH_STATE_READY      (tstate_t)0      /**< @brief Waiting on the
  63:../../../os/rt/include/chschd.h ****                                                   ready list.               */
  64:../../../os/rt/include/chschd.h **** #define CH_STATE_CURRENT    (tstate_t)1      /**< @brief Currently running. */
  65:../../../os/rt/include/chschd.h **** #define CH_STATE_WTSTART    (tstate_t)2      /**< @brief Just created.      */
  66:../../../os/rt/include/chschd.h **** #define CH_STATE_SUSPENDED  (tstate_t)3      /**< @brief Suspended state.   */
  67:../../../os/rt/include/chschd.h **** #define CH_STATE_QUEUED     (tstate_t)4      /**< @brief On an I/O queue.   */
  68:../../../os/rt/include/chschd.h **** #define CH_STATE_WTSEM      (tstate_t)5      /**< @brief On a semaphore.    */
  69:../../../os/rt/include/chschd.h **** #define CH_STATE_WTMTX      (tstate_t)6      /**< @brief On a mutex.        */
  70:../../../os/rt/include/chschd.h **** #define CH_STATE_WTCOND     (tstate_t)7      /**< @brief On a cond.variable.*/
  71:../../../os/rt/include/chschd.h **** #define CH_STATE_SLEEPING   (tstate_t)8      /**< @brief Sleeping.          */
  72:../../../os/rt/include/chschd.h **** #define CH_STATE_WTEXIT     (tstate_t)9      /**< @brief Waiting a thread.  */
  73:../../../os/rt/include/chschd.h **** #define CH_STATE_WTOREVT    (tstate_t)10     /**< @brief One event.         */
  74:../../../os/rt/include/chschd.h **** #define CH_STATE_WTANDEVT   (tstate_t)11     /**< @brief Several events.    */
  75:../../../os/rt/include/chschd.h **** #define CH_STATE_SNDMSGQ    (tstate_t)12     /**< @brief Sending a message,
  76:../../../os/rt/include/chschd.h ****                                                   in queue.                 */
  77:../../../os/rt/include/chschd.h **** #define CH_STATE_SNDMSG     (tstate_t)13     /**< @brief Sent a message,
  78:../../../os/rt/include/chschd.h ****                                                   waiting answer.           */
  79:../../../os/rt/include/chschd.h **** #define CH_STATE_WTMSG      (tstate_t)14     /**< @brief Waiting for a
  80:../../../os/rt/include/chschd.h ****                                                   message.                  */
  81:../../../os/rt/include/chschd.h **** #define CH_STATE_FINAL      (tstate_t)15     /**< @brief Thread terminated. */
  82:../../../os/rt/include/chschd.h **** 
  83:../../../os/rt/include/chschd.h **** /**
  84:../../../os/rt/include/chschd.h ****  * @brief   Thread states as array of strings.
  85:../../../os/rt/include/chschd.h ****  * @details Each element in an array initialized with this macro can be
  86:../../../os/rt/include/chschd.h ****  *          indexed using the numeric thread state values.
  87:../../../os/rt/include/chschd.h ****  */
  88:../../../os/rt/include/chschd.h **** #define CH_STATE_NAMES                                                     \
  89:../../../os/rt/include/chschd.h ****   "READY", "CURRENT", "WTSTART", "SUSPENDED", "QUEUED", "WTSEM", "WTMTX",  \
  90:../../../os/rt/include/chschd.h ****   "WTCOND", "SLEEPING", "WTEXIT", "WTOREVT", "WTANDEVT", "SNDMSGQ",        \
  91:../../../os/rt/include/chschd.h ****   "SNDMSG", "WTMSG", "FINAL"
  92:../../../os/rt/include/chschd.h **** /** @} */
  93:../../../os/rt/include/chschd.h **** 
  94:../../../os/rt/include/chschd.h **** /**
  95:../../../os/rt/include/chschd.h ****  * @name    Thread flags and attributes
  96:../../../os/rt/include/chschd.h ****  * @{
  97:../../../os/rt/include/chschd.h ****  */
  98:../../../os/rt/include/chschd.h **** #define CH_FLAG_MODE_MASK   (tmode_t)3U     /**< @brief Thread memory mode
  99:../../../os/rt/include/chschd.h ****                                                  mask.                      */
 100:../../../os/rt/include/chschd.h **** #define CH_FLAG_MODE_STATIC (tmode_t)0U     /**< @brief Static thread.      */
 101:../../../os/rt/include/chschd.h **** #define CH_FLAG_MODE_HEAP   (tmode_t)1U     /**< @brief Thread allocated
 102:../../../os/rt/include/chschd.h ****                                                  from a Memory Heap.        */
 103:../../../os/rt/include/chschd.h **** #define CH_FLAG_MODE_MPOOL  (tmode_t)2U     /**< @brief Thread allocated
 104:../../../os/rt/include/chschd.h ****                                                  from a Memory Pool.        */
 105:../../../os/rt/include/chschd.h **** #define CH_FLAG_TERMINATE   (tmode_t)4U     /**< @brief Termination requested
 106:../../../os/rt/include/chschd.h ****                                                  flag.                      */
 107:../../../os/rt/include/chschd.h **** /** @} */
 108:../../../os/rt/include/chschd.h **** 
 109:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 110:../../../os/rt/include/chschd.h **** /* Module pre-compile time settings.                                         */
 111:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 112:../../../os/rt/include/chschd.h **** 
 113:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 114:../../../os/rt/include/chschd.h **** /* Derived constants and error checks.                                       */
 115:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 116:../../../os/rt/include/chschd.h **** 
 117:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 118:../../../os/rt/include/chschd.h **** /* Module data structures and types.                                         */
 119:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 120:../../../os/rt/include/chschd.h **** 
 121:../../../os/rt/include/chschd.h **** /**
 122:../../../os/rt/include/chschd.h ****  * @brief   Generic threads single link list, it works like a stack.
 123:../../../os/rt/include/chschd.h ****  */
 124:../../../os/rt/include/chschd.h **** struct ch_threads_list {
 125:../../../os/rt/include/chschd.h ****   thread_t              *next;      /**< @brief Next in the list/queue.     */
 126:../../../os/rt/include/chschd.h **** };
 127:../../../os/rt/include/chschd.h **** 
 128:../../../os/rt/include/chschd.h **** /**
 129:../../../os/rt/include/chschd.h ****  * @brief   Generic threads bidirectional linked list header and element.
 130:../../../os/rt/include/chschd.h ****  */
 131:../../../os/rt/include/chschd.h **** struct ch_threads_queue {
 132:../../../os/rt/include/chschd.h ****   thread_t              *next;      /**< @brief Next in the list/queue.     */
 133:../../../os/rt/include/chschd.h ****   thread_t              *prev;      /**< @brief Previous in the queue.      */
 134:../../../os/rt/include/chschd.h **** };
 135:../../../os/rt/include/chschd.h **** 
 136:../../../os/rt/include/chschd.h **** /**
 137:../../../os/rt/include/chschd.h ****  * @brief   Structure representing a thread.
 138:../../../os/rt/include/chschd.h ****  * @note    Not all the listed fields are always needed, by switching off some
 139:../../../os/rt/include/chschd.h ****  *          not needed ChibiOS/RT subsystems it is possible to save RAM space
 140:../../../os/rt/include/chschd.h ****  *          by shrinking this structure.
 141:../../../os/rt/include/chschd.h ****  */
 142:../../../os/rt/include/chschd.h **** struct ch_thread {
 143:../../../os/rt/include/chschd.h ****   threads_queue_t       queue;      /**< @brief Threads queue header.       */
 144:../../../os/rt/include/chschd.h ****   tprio_t               prio;       /**< @brief Thread priority.            */
 145:../../../os/rt/include/chschd.h ****   struct port_context   ctx;        /**< @brief Processor context.          */
 146:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_REGISTRY == TRUE) || defined(__DOXYGEN__)
 147:../../../os/rt/include/chschd.h ****   thread_t              *newer;     /**< @brief Newer registry element.     */
 148:../../../os/rt/include/chschd.h ****   thread_t              *older;     /**< @brief Older registry element.     */
 149:../../../os/rt/include/chschd.h **** #endif
 150:../../../os/rt/include/chschd.h ****   /* End of the fields shared with the ReadyList structure. */
 151:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_REGISTRY == TRUE) || defined(__DOXYGEN__)
 152:../../../os/rt/include/chschd.h ****   /**
 153:../../../os/rt/include/chschd.h ****    * @brief   Thread name or @p NULL.
 154:../../../os/rt/include/chschd.h ****    */
 155:../../../os/rt/include/chschd.h ****   const char            *name;
 156:../../../os/rt/include/chschd.h **** #endif
 157:../../../os/rt/include/chschd.h **** #if (CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE) ||  \
 158:../../../os/rt/include/chschd.h ****     defined(__DOXYGEN__)
 159:../../../os/rt/include/chschd.h ****   /**
 160:../../../os/rt/include/chschd.h ****    * @brief   Working area base address.
 161:../../../os/rt/include/chschd.h ****    * @note    This pointer is used for stack overflow checks and for
 162:../../../os/rt/include/chschd.h ****    *          dynamic threading.
 163:../../../os/rt/include/chschd.h ****    */
 164:../../../os/rt/include/chschd.h ****   stkalign_t            *wabase;
 165:../../../os/rt/include/chschd.h **** #endif
 166:../../../os/rt/include/chschd.h ****   /**
 167:../../../os/rt/include/chschd.h ****    * @brief   Current thread state.
 168:../../../os/rt/include/chschd.h ****    */
 169:../../../os/rt/include/chschd.h ****   tstate_t              state;
 170:../../../os/rt/include/chschd.h ****   /**
 171:../../../os/rt/include/chschd.h ****    * @brief   Various thread flags.
 172:../../../os/rt/include/chschd.h ****    */
 173:../../../os/rt/include/chschd.h ****   tmode_t               flags;
 174:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_REGISTRY == TRUE) || defined(__DOXYGEN__)
 175:../../../os/rt/include/chschd.h ****   /**
 176:../../../os/rt/include/chschd.h ****    * @brief   References to this thread.
 177:../../../os/rt/include/chschd.h ****    */
 178:../../../os/rt/include/chschd.h ****   trefs_t               refs;
 179:../../../os/rt/include/chschd.h **** #endif
 180:../../../os/rt/include/chschd.h ****   /**
 181:../../../os/rt/include/chschd.h ****    * @brief   Number of ticks remaining to this thread.
 182:../../../os/rt/include/chschd.h ****    */
 183:../../../os/rt/include/chschd.h **** #if (CH_CFG_TIME_QUANTUM > 0) || defined(__DOXYGEN__)
 184:../../../os/rt/include/chschd.h ****   tslices_t             ticks;
 185:../../../os/rt/include/chschd.h **** #endif
 186:../../../os/rt/include/chschd.h **** #if (CH_DBG_THREADS_PROFILING == TRUE) || defined(__DOXYGEN__)
 187:../../../os/rt/include/chschd.h ****   /**
 188:../../../os/rt/include/chschd.h ****    * @brief   Thread consumed time in ticks.
 189:../../../os/rt/include/chschd.h ****    * @note    This field can overflow.
 190:../../../os/rt/include/chschd.h ****    */
 191:../../../os/rt/include/chschd.h ****   volatile systime_t    time;
 192:../../../os/rt/include/chschd.h **** #endif
 193:../../../os/rt/include/chschd.h ****   /**
 194:../../../os/rt/include/chschd.h ****    * @brief   State-specific fields.
 195:../../../os/rt/include/chschd.h ****    * @note    All the fields declared in this union are only valid in the
 196:../../../os/rt/include/chschd.h ****    *          specified state or condition and are thus volatile.
 197:../../../os/rt/include/chschd.h ****    */
 198:../../../os/rt/include/chschd.h ****   union {
 199:../../../os/rt/include/chschd.h ****     /**
 200:../../../os/rt/include/chschd.h ****      * @brief   Thread wakeup code.
 201:../../../os/rt/include/chschd.h ****      * @note    This field contains the low level message sent to the thread
 202:../../../os/rt/include/chschd.h ****      *          by the waking thread or interrupt handler. The value is valid
 203:../../../os/rt/include/chschd.h ****      *          after exiting the @p chSchWakeupS() function.
 204:../../../os/rt/include/chschd.h ****      */
 205:../../../os/rt/include/chschd.h ****     msg_t               rdymsg;
 206:../../../os/rt/include/chschd.h ****     /**
 207:../../../os/rt/include/chschd.h ****      * @brief   Thread exit code.
 208:../../../os/rt/include/chschd.h ****      * @note    The thread termination code is stored in this field in order
 209:../../../os/rt/include/chschd.h ****      *          to be retrieved by the thread performing a @p chThdWait() on
 210:../../../os/rt/include/chschd.h ****      *          this thread.
 211:../../../os/rt/include/chschd.h ****      */
 212:../../../os/rt/include/chschd.h ****     msg_t               exitcode;
 213:../../../os/rt/include/chschd.h ****     /**
 214:../../../os/rt/include/chschd.h ****      * @brief   Pointer to a generic "wait" object.
 215:../../../os/rt/include/chschd.h ****      * @note    This field is used to get a generic pointer to a synchronization
 216:../../../os/rt/include/chschd.h ****      *          object and is valid when the thread is in one of the wait
 217:../../../os/rt/include/chschd.h ****      *          states.
 218:../../../os/rt/include/chschd.h ****      */
 219:../../../os/rt/include/chschd.h ****     void                *wtobjp;
 220:../../../os/rt/include/chschd.h ****     /**
 221:../../../os/rt/include/chschd.h ****      * @brief   Pointer to a generic thread reference object.
 222:../../../os/rt/include/chschd.h ****      * @note    This field is used to get a pointer to a synchronization
 223:../../../os/rt/include/chschd.h ****      *          object and is valid when the thread is in @p CH_STATE_SUSPENDED
 224:../../../os/rt/include/chschd.h ****      *          state.
 225:../../../os/rt/include/chschd.h ****      */
 226:../../../os/rt/include/chschd.h ****     thread_reference_t  *wttrp;
 227:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_MESSAGES == TRUE) || defined(__DOXYGEN__)
 228:../../../os/rt/include/chschd.h ****     /**
 229:../../../os/rt/include/chschd.h ****      * @brief   Thread sent message.
 230:../../../os/rt/include/chschd.h ****      */
 231:../../../os/rt/include/chschd.h ****     msg_t               sentmsg;
 232:../../../os/rt/include/chschd.h **** #endif
 233:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_SEMAPHORES == TRUE) || defined(__DOXYGEN__)
 234:../../../os/rt/include/chschd.h ****     /**
 235:../../../os/rt/include/chschd.h ****      * @brief   Pointer to a generic semaphore object.
 236:../../../os/rt/include/chschd.h ****      * @note    This field is used to get a pointer to a synchronization
 237:../../../os/rt/include/chschd.h ****      *          object and is valid when the thread is in @p CH_STATE_WTSEM
 238:../../../os/rt/include/chschd.h ****      *          state.
 239:../../../os/rt/include/chschd.h ****      */
 240:../../../os/rt/include/chschd.h ****     struct ch_semaphore *wtsemp;
 241:../../../os/rt/include/chschd.h **** #endif
 242:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_MUTEXES == TRUE) || defined(__DOXYGEN__)
 243:../../../os/rt/include/chschd.h ****     /**
 244:../../../os/rt/include/chschd.h ****      * @brief   Pointer to a generic mutex object.
 245:../../../os/rt/include/chschd.h ****      * @note    This field is used to get a pointer to a synchronization
 246:../../../os/rt/include/chschd.h ****      *          object and is valid when the thread is in @p CH_STATE_WTMTX
 247:../../../os/rt/include/chschd.h ****      *          state.
 248:../../../os/rt/include/chschd.h ****      */
 249:../../../os/rt/include/chschd.h ****     struct ch_mutex     *wtmtxp;
 250:../../../os/rt/include/chschd.h **** #endif
 251:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_EVENTS == TRUE) || defined(__DOXYGEN__)
 252:../../../os/rt/include/chschd.h ****     /**
 253:../../../os/rt/include/chschd.h ****      * @brief   Enabled events mask.
 254:../../../os/rt/include/chschd.h ****      * @note    This field is only valid while the thread is in the
 255:../../../os/rt/include/chschd.h ****      *          @p CH_STATE_WTOREVT or @p CH_STATE_WTANDEVT states.
 256:../../../os/rt/include/chschd.h ****      */
 257:../../../os/rt/include/chschd.h ****     eventmask_t         ewmask;
 258:../../../os/rt/include/chschd.h **** #endif
 259:../../../os/rt/include/chschd.h ****   }                     u;
 260:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_WAITEXIT == TRUE) || defined(__DOXYGEN__)
 261:../../../os/rt/include/chschd.h ****   /**
 262:../../../os/rt/include/chschd.h ****    * @brief   Termination waiting list.
 263:../../../os/rt/include/chschd.h ****    */
 264:../../../os/rt/include/chschd.h ****   threads_list_t        waiting;
 265:../../../os/rt/include/chschd.h **** #endif
 266:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_MESSAGES == TRUE) || defined(__DOXYGEN__)
 267:../../../os/rt/include/chschd.h ****   /**
 268:../../../os/rt/include/chschd.h ****    * @brief   Messages queue.
 269:../../../os/rt/include/chschd.h ****    */
 270:../../../os/rt/include/chschd.h ****   threads_queue_t       msgqueue;
 271:../../../os/rt/include/chschd.h **** #endif
 272:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_EVENTS == TRUE) || defined(__DOXYGEN__)
 273:../../../os/rt/include/chschd.h ****   /**
 274:../../../os/rt/include/chschd.h ****    * @brief   Pending events mask.
 275:../../../os/rt/include/chschd.h ****    */
 276:../../../os/rt/include/chschd.h ****   eventmask_t           epending;
 277:../../../os/rt/include/chschd.h **** #endif
 278:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_MUTEXES == TRUE) || defined(__DOXYGEN__)
 279:../../../os/rt/include/chschd.h ****   /**
 280:../../../os/rt/include/chschd.h ****    * @brief   List of the mutexes owned by this thread.
 281:../../../os/rt/include/chschd.h ****    * @note    The list is terminated by a @p NULL in this field.
 282:../../../os/rt/include/chschd.h ****    */
 283:../../../os/rt/include/chschd.h ****   struct ch_mutex       *mtxlist;
 284:../../../os/rt/include/chschd.h ****   /**
 285:../../../os/rt/include/chschd.h ****    * @brief   Thread's own, non-inherited, priority.
 286:../../../os/rt/include/chschd.h ****    */
 287:../../../os/rt/include/chschd.h ****   tprio_t               realprio;
 288:../../../os/rt/include/chschd.h **** #endif
 289:../../../os/rt/include/chschd.h **** #if ((CH_CFG_USE_DYNAMIC == TRUE) && (CH_CFG_USE_MEMPOOLS == TRUE)) ||      \
 290:../../../os/rt/include/chschd.h ****     defined(__DOXYGEN__)
 291:../../../os/rt/include/chschd.h ****   /**
 292:../../../os/rt/include/chschd.h ****    * @brief   Memory Pool where the thread workspace is returned.
 293:../../../os/rt/include/chschd.h ****    */
 294:../../../os/rt/include/chschd.h ****   void                  *mpool;
 295:../../../os/rt/include/chschd.h **** #endif
 296:../../../os/rt/include/chschd.h **** #if (CH_DBG_STATISTICS == TRUE) || defined(__DOXYGEN__)
 297:../../../os/rt/include/chschd.h ****   /**
 298:../../../os/rt/include/chschd.h ****    * @brief   Thread statistics.
 299:../../../os/rt/include/chschd.h ****    */
 300:../../../os/rt/include/chschd.h ****   time_measurement_t    stats;
 301:../../../os/rt/include/chschd.h **** #endif
 302:../../../os/rt/include/chschd.h **** #if defined(CH_CFG_THREAD_EXTRA_FIELDS)
 303:../../../os/rt/include/chschd.h ****   /* Extra fields defined in chconf.h.*/
 304:../../../os/rt/include/chschd.h ****   CH_CFG_THREAD_EXTRA_FIELDS
 305:../../../os/rt/include/chschd.h **** #endif
 306:../../../os/rt/include/chschd.h **** };
 307:../../../os/rt/include/chschd.h **** 
 308:../../../os/rt/include/chschd.h **** /**
 309:../../../os/rt/include/chschd.h ****  * @extends virtual_timers_list_t
 310:../../../os/rt/include/chschd.h ****  *
 311:../../../os/rt/include/chschd.h ****  * @brief   Virtual Timer descriptor structure.
 312:../../../os/rt/include/chschd.h ****  */
 313:../../../os/rt/include/chschd.h **** struct ch_virtual_timer {
 314:../../../os/rt/include/chschd.h ****   virtual_timer_t       *next;      /**< @brief Next timer in the list.     */
 315:../../../os/rt/include/chschd.h ****   virtual_timer_t       *prev;      /**< @brief Previous timer in the list. */
 316:../../../os/rt/include/chschd.h ****   sysinterval_t         delta;      /**< @brief Time delta before timeout.  */
 317:../../../os/rt/include/chschd.h ****   vtfunc_t              func;       /**< @brief Timer callback function
 318:../../../os/rt/include/chschd.h ****                                                 pointer.                    */
 319:../../../os/rt/include/chschd.h ****   void                  *par;       /**< @brief Timer callback function
 320:../../../os/rt/include/chschd.h ****                                                 parameter.                  */
 321:../../../os/rt/include/chschd.h **** };
 322:../../../os/rt/include/chschd.h **** 
 323:../../../os/rt/include/chschd.h **** /**
 324:../../../os/rt/include/chschd.h ****  * @brief   Virtual timers list header.
 325:../../../os/rt/include/chschd.h ****  * @note    The timers list is implemented as a double link bidirectional list
 326:../../../os/rt/include/chschd.h ****  *          in order to make the unlink time constant, the reset of a virtual
 327:../../../os/rt/include/chschd.h ****  *          timer is often used in the code.
 328:../../../os/rt/include/chschd.h ****  */
 329:../../../os/rt/include/chschd.h **** struct ch_virtual_timers_list {
 330:../../../os/rt/include/chschd.h ****   virtual_timer_t       *next;      /**< @brief Next timer in the delta
 331:../../../os/rt/include/chschd.h ****                                                 list.                       */
 332:../../../os/rt/include/chschd.h ****   virtual_timer_t       *prev;      /**< @brief Last timer in the delta
 333:../../../os/rt/include/chschd.h ****                                                 list.                       */
 334:../../../os/rt/include/chschd.h ****   sysinterval_t         delta;      /**< @brief Must be initialized to -1.  */
 335:../../../os/rt/include/chschd.h **** #if (CH_CFG_ST_TIMEDELTA == 0) || defined(__DOXYGEN__)
 336:../../../os/rt/include/chschd.h ****   volatile systime_t    systime;    /**< @brief System Time counter.        */
 337:../../../os/rt/include/chschd.h **** #endif
 338:../../../os/rt/include/chschd.h **** #if (CH_CFG_ST_TIMEDELTA > 0) || defined(__DOXYGEN__)
 339:../../../os/rt/include/chschd.h ****   /**
 340:../../../os/rt/include/chschd.h ****    * @brief   System time of the last tick event.
 341:../../../os/rt/include/chschd.h ****    */
 342:../../../os/rt/include/chschd.h ****   systime_t             lasttime;   /**< @brief System time of the last
 343:../../../os/rt/include/chschd.h ****                                                 tick event.                 */
 344:../../../os/rt/include/chschd.h **** #endif
 345:../../../os/rt/include/chschd.h **** };
 346:../../../os/rt/include/chschd.h **** 
 347:../../../os/rt/include/chschd.h **** /**
 348:../../../os/rt/include/chschd.h ****  * @extends threads_queue_t
 349:../../../os/rt/include/chschd.h ****  */
 350:../../../os/rt/include/chschd.h **** struct ch_ready_list {
 351:../../../os/rt/include/chschd.h ****   threads_queue_t       queue;      /**< @brief Threads queue.              */
 352:../../../os/rt/include/chschd.h ****   tprio_t               prio;       /**< @brief This field must be
 353:../../../os/rt/include/chschd.h ****                                                 initialized to zero.        */
 354:../../../os/rt/include/chschd.h ****   struct port_context   ctx;        /**< @brief Not used, present because
 355:../../../os/rt/include/chschd.h ****                                                 offsets.                    */
 356:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_REGISTRY == TRUE) || defined(__DOXYGEN__)
 357:../../../os/rt/include/chschd.h ****   thread_t              *newer;     /**< @brief Newer registry element.     */
 358:../../../os/rt/include/chschd.h ****   thread_t              *older;     /**< @brief Older registry element.     */
 359:../../../os/rt/include/chschd.h **** #endif
 360:../../../os/rt/include/chschd.h ****   /* End of the fields shared with the thread_t structure.*/
 361:../../../os/rt/include/chschd.h ****   thread_t              *current;   /**< @brief The currently running
 362:../../../os/rt/include/chschd.h ****                                                 thread.                     */
 363:../../../os/rt/include/chschd.h **** };
 364:../../../os/rt/include/chschd.h **** 
 365:../../../os/rt/include/chschd.h **** /**
 366:../../../os/rt/include/chschd.h ****  * @brief   System debug data structure.
 367:../../../os/rt/include/chschd.h ****  */
 368:../../../os/rt/include/chschd.h **** struct ch_system_debug {
 369:../../../os/rt/include/chschd.h ****   /**
 370:../../../os/rt/include/chschd.h ****    * @brief   Pointer to the panic message.
 371:../../../os/rt/include/chschd.h ****    * @details This pointer is meant to be accessed through the debugger, it is
 372:../../../os/rt/include/chschd.h ****    *          written once and then the system is halted.
 373:../../../os/rt/include/chschd.h ****    * @note    Accesses to this pointer must never be optimized out so the
 374:../../../os/rt/include/chschd.h ****    *          field itself is declared volatile.
 375:../../../os/rt/include/chschd.h ****    */
 376:../../../os/rt/include/chschd.h ****   const char            * volatile panic_msg;
 377:../../../os/rt/include/chschd.h **** #if (CH_DBG_SYSTEM_STATE_CHECK == TRUE) || defined(__DOXYGEN__)
 378:../../../os/rt/include/chschd.h ****   /**
 379:../../../os/rt/include/chschd.h ****    * @brief   ISR nesting level.
 380:../../../os/rt/include/chschd.h ****    */
 381:../../../os/rt/include/chschd.h ****   cnt_t                 isr_cnt;
 382:../../../os/rt/include/chschd.h ****   /**
 383:../../../os/rt/include/chschd.h ****    * @brief   Lock nesting level.
 384:../../../os/rt/include/chschd.h ****    */
 385:../../../os/rt/include/chschd.h ****   cnt_t                 lock_cnt;
 386:../../../os/rt/include/chschd.h **** #endif
 387:../../../os/rt/include/chschd.h **** #if (CH_DBG_TRACE_MASK != CH_DBG_TRACE_MASK_DISABLED) || defined(__DOXYGEN__)
 388:../../../os/rt/include/chschd.h ****   /**
 389:../../../os/rt/include/chschd.h ****    * @brief   Public trace buffer.
 390:../../../os/rt/include/chschd.h ****    */
 391:../../../os/rt/include/chschd.h ****   ch_trace_buffer_t     trace_buffer;
 392:../../../os/rt/include/chschd.h **** #endif
 393:../../../os/rt/include/chschd.h **** };
 394:../../../os/rt/include/chschd.h **** 
 395:../../../os/rt/include/chschd.h **** /**
 396:../../../os/rt/include/chschd.h ****  * @brief   System data structure.
 397:../../../os/rt/include/chschd.h ****  * @note    This structure contain all the data areas used by the OS except
 398:../../../os/rt/include/chschd.h ****  *          stacks.
 399:../../../os/rt/include/chschd.h ****  */
 400:../../../os/rt/include/chschd.h **** struct ch_system {
 401:../../../os/rt/include/chschd.h ****   /**
 402:../../../os/rt/include/chschd.h ****    * @brief   Ready list header.
 403:../../../os/rt/include/chschd.h ****    */
 404:../../../os/rt/include/chschd.h ****   ready_list_t          rlist;
 405:../../../os/rt/include/chschd.h ****   /**
 406:../../../os/rt/include/chschd.h ****    * @brief   Virtual timers delta list header.
 407:../../../os/rt/include/chschd.h ****    */
 408:../../../os/rt/include/chschd.h ****   virtual_timers_list_t vtlist;
 409:../../../os/rt/include/chschd.h ****   /**
 410:../../../os/rt/include/chschd.h ****    * @brief   System debug.
 411:../../../os/rt/include/chschd.h ****    */
 412:../../../os/rt/include/chschd.h ****   system_debug_t        dbg;
 413:../../../os/rt/include/chschd.h ****   /**
 414:../../../os/rt/include/chschd.h ****    * @brief   Main thread descriptor.
 415:../../../os/rt/include/chschd.h ****    */
 416:../../../os/rt/include/chschd.h ****   thread_t              mainthread;
 417:../../../os/rt/include/chschd.h **** #if (CH_CFG_USE_TM == TRUE) || defined(__DOXYGEN__)
 418:../../../os/rt/include/chschd.h ****   /**
 419:../../../os/rt/include/chschd.h ****    * @brief   Time measurement calibration data.
 420:../../../os/rt/include/chschd.h ****    */
 421:../../../os/rt/include/chschd.h ****   tm_calibration_t      tm;
 422:../../../os/rt/include/chschd.h **** #endif
 423:../../../os/rt/include/chschd.h **** #if (CH_DBG_STATISTICS == TRUE) || defined(__DOXYGEN__)
 424:../../../os/rt/include/chschd.h ****   /**
 425:../../../os/rt/include/chschd.h ****    * @brief   Global kernel statistics.
 426:../../../os/rt/include/chschd.h ****    */
 427:../../../os/rt/include/chschd.h ****   kernel_stats_t        kernel_stats;
 428:../../../os/rt/include/chschd.h **** #endif
 429:../../../os/rt/include/chschd.h ****   CH_CFG_SYSTEM_EXTRA_FIELDS
 430:../../../os/rt/include/chschd.h **** };
 431:../../../os/rt/include/chschd.h **** 
 432:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 433:../../../os/rt/include/chschd.h **** /* Module macros.                                                            */
 434:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 435:../../../os/rt/include/chschd.h **** 
 436:../../../os/rt/include/chschd.h **** /**
 437:../../../os/rt/include/chschd.h ****  * @brief   Returns the priority of the first thread on the given ready list.
 438:../../../os/rt/include/chschd.h ****  *
 439:../../../os/rt/include/chschd.h ****  * @notapi
 440:../../../os/rt/include/chschd.h ****  */
 441:../../../os/rt/include/chschd.h **** #define firstprio(rlp)  ((rlp)->next->prio)
 442:../../../os/rt/include/chschd.h **** 
 443:../../../os/rt/include/chschd.h **** /**
 444:../../../os/rt/include/chschd.h ****  * @brief   Current thread pointer access macro.
 445:../../../os/rt/include/chschd.h ****  * @note    This macro is not meant to be used in the application code but
 446:../../../os/rt/include/chschd.h ****  *          only from within the kernel, use @p chThdGetSelfX() instead.
 447:../../../os/rt/include/chschd.h ****  */
 448:../../../os/rt/include/chschd.h **** #define currp ch.rlist.current
 449:../../../os/rt/include/chschd.h **** 
 450:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 451:../../../os/rt/include/chschd.h **** /* External declarations.                                                    */
 452:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 453:../../../os/rt/include/chschd.h **** 
 454:../../../os/rt/include/chschd.h **** #if !defined(__DOXYGEN__)
 455:../../../os/rt/include/chschd.h **** extern ch_system_t ch;
 456:../../../os/rt/include/chschd.h **** #endif
 457:../../../os/rt/include/chschd.h **** 
 458:../../../os/rt/include/chschd.h **** /*
 459:../../../os/rt/include/chschd.h ****  * Scheduler APIs.
 460:../../../os/rt/include/chschd.h ****  */
 461:../../../os/rt/include/chschd.h **** #ifdef __cplusplus
 462:../../../os/rt/include/chschd.h **** extern "C" {
 463:../../../os/rt/include/chschd.h **** #endif
 464:../../../os/rt/include/chschd.h ****   void _scheduler_init(void);
 465:../../../os/rt/include/chschd.h ****   thread_t *chSchReadyI(thread_t *tp);
 466:../../../os/rt/include/chschd.h ****   thread_t *chSchReadyAheadI(thread_t *tp);
 467:../../../os/rt/include/chschd.h ****   void chSchGoSleepS(tstate_t newstate);
 468:../../../os/rt/include/chschd.h ****   msg_t chSchGoSleepTimeoutS(tstate_t newstate, sysinterval_t timeout);
 469:../../../os/rt/include/chschd.h ****   void chSchWakeupS(thread_t *ntp, msg_t msg);
 470:../../../os/rt/include/chschd.h ****   void chSchRescheduleS(void);
 471:../../../os/rt/include/chschd.h ****   bool chSchIsPreemptionRequired(void);
 472:../../../os/rt/include/chschd.h ****   void chSchDoRescheduleBehind(void);
 473:../../../os/rt/include/chschd.h ****   void chSchDoRescheduleAhead(void);
 474:../../../os/rt/include/chschd.h ****   void chSchDoReschedule(void);
 475:../../../os/rt/include/chschd.h **** #if CH_CFG_OPTIMIZE_SPEED == FALSE
 476:../../../os/rt/include/chschd.h ****   void queue_prio_insert(thread_t *tp, threads_queue_t *tqp);
 477:../../../os/rt/include/chschd.h ****   void queue_insert(thread_t *tp, threads_queue_t *tqp);
 478:../../../os/rt/include/chschd.h ****   thread_t *queue_fifo_remove(threads_queue_t *tqp);
 479:../../../os/rt/include/chschd.h ****   thread_t *queue_lifo_remove(threads_queue_t *tqp);
 480:../../../os/rt/include/chschd.h ****   thread_t *queue_dequeue(thread_t *tp);
 481:../../../os/rt/include/chschd.h ****   void list_insert(thread_t *tp, threads_list_t *tlp);
 482:../../../os/rt/include/chschd.h ****   thread_t *list_remove(threads_list_t *tlp);
 483:../../../os/rt/include/chschd.h **** #endif /* CH_CFG_OPTIMIZE_SPEED == FALSE */
 484:../../../os/rt/include/chschd.h **** #ifdef __cplusplus
 485:../../../os/rt/include/chschd.h **** }
 486:../../../os/rt/include/chschd.h **** #endif
 487:../../../os/rt/include/chschd.h **** 
 488:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 489:../../../os/rt/include/chschd.h **** /* Module inline functions.                                                  */
 490:../../../os/rt/include/chschd.h **** /*===========================================================================*/
 491:../../../os/rt/include/chschd.h **** 
 492:../../../os/rt/include/chschd.h **** /**
 493:../../../os/rt/include/chschd.h ****  * @brief   Threads list initialization.
 494:../../../os/rt/include/chschd.h ****  *
 495:../../../os/rt/include/chschd.h ****  * @param[in] tlp       pointer to the threads list object
 496:../../../os/rt/include/chschd.h ****  *
 497:../../../os/rt/include/chschd.h ****  * @notapi
 498:../../../os/rt/include/chschd.h ****  */
 499:../../../os/rt/include/chschd.h **** static inline void list_init(threads_list_t *tlp) {
 500:../../../os/rt/include/chschd.h **** 
 501:../../../os/rt/include/chschd.h ****   tlp->next = (thread_t *)tlp;
 502:../../../os/rt/include/chschd.h **** }
 503:../../../os/rt/include/chschd.h **** 
 504:../../../os/rt/include/chschd.h **** /**
 505:../../../os/rt/include/chschd.h ****  * @brief   Evaluates to @p true if the specified threads list is empty.
 506:../../../os/rt/include/chschd.h ****  *
 507:../../../os/rt/include/chschd.h ****  * @param[in] tlp       pointer to the threads list object
 508:../../../os/rt/include/chschd.h ****  * @return              The status of the list.
 509:../../../os/rt/include/chschd.h ****  *
 510:../../../os/rt/include/chschd.h ****  * @notapi
 511:../../../os/rt/include/chschd.h ****  */
 512:../../../os/rt/include/chschd.h **** static inline bool list_isempty(threads_list_t *tlp) {
 513:../../../os/rt/include/chschd.h **** 
 514:../../../os/rt/include/chschd.h ****   return (bool)(tlp->next == (thread_t *)tlp);
 515:../../../os/rt/include/chschd.h **** }
 516:../../../os/rt/include/chschd.h **** 
 517:../../../os/rt/include/chschd.h **** /**
 518:../../../os/rt/include/chschd.h ****  * @brief   Evaluates to @p true if the specified threads list is not empty.
 519:../../../os/rt/include/chschd.h ****  *
 520:../../../os/rt/include/chschd.h ****  * @param[in] tlp       pointer to the threads list object
 521:../../../os/rt/include/chschd.h ****  * @return              The status of the list.
 522:../../../os/rt/include/chschd.h ****  *
 523:../../../os/rt/include/chschd.h ****  * @notapi
 524:../../../os/rt/include/chschd.h ****  */
 525:../../../os/rt/include/chschd.h **** static inline bool list_notempty(threads_list_t *tlp) {
 526:../../../os/rt/include/chschd.h **** 
 527:../../../os/rt/include/chschd.h ****   return (bool)(tlp->next != (thread_t *)tlp);
 528:../../../os/rt/include/chschd.h **** }
 529:../../../os/rt/include/chschd.h **** 
 530:../../../os/rt/include/chschd.h **** /**
 531:../../../os/rt/include/chschd.h ****  * @brief   Threads queue initialization.
 532:../../../os/rt/include/chschd.h ****  *
 533:../../../os/rt/include/chschd.h ****  * @param[in] tqp       pointer to the threads queue object
 534:../../../os/rt/include/chschd.h ****  *
 535:../../../os/rt/include/chschd.h ****  * @notapi
 536:../../../os/rt/include/chschd.h ****  */
 537:../../../os/rt/include/chschd.h **** static inline void queue_init(threads_queue_t *tqp) {
 538:../../../os/rt/include/chschd.h **** 
 539:../../../os/rt/include/chschd.h ****   tqp->next = (thread_t *)tqp;
  54               		.loc 2 539 0
  55 000e 9183      		std Z+1,r25
  56 0010 8083      		st Z,r24
 540:../../../os/rt/include/chschd.h ****   tqp->prev = (thread_t *)tqp;
  57               		.loc 2 540 0
  58 0012 9383      		std Z+3,r25
  59 0014 8283      		std Z+2,r24
  60               	.LVL2:
  61               	.LBE257:
  62               	.LBE256:
  63               	.LBE255:
  64               	.LBE254:
  78:../../../os/hal/src/hal_buffers.c **** 
  79:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck((ibqp != NULL) && (bp != NULL) && (size >= 2U));
  80:../../../os/hal/src/hal_buffers.c **** 
  81:../../../os/hal/src/hal_buffers.c ****   osalThreadQueueObjectInit(&ibqp->waiting);
  82:../../../os/hal/src/hal_buffers.c ****   ibqp->suspended = suspended;
  65               		.loc 1 82 0
  66 0016 6483      		std Z+4,r22
  83:../../../os/hal/src/hal_buffers.c ****   ibqp->bcounter  = 0;
  67               		.loc 1 83 0
  68 0018 1682      		std Z+6,__zero_reg__
  69 001a 1582      		std Z+5,__zero_reg__
  84:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr    = bp;
  70               		.loc 1 84 0
  71 001c 5287      		std Z+10,r21
  72 001e 4187      		std Z+9,r20
  85:../../../os/hal/src/hal_buffers.c ****   ibqp->bwrptr    = bp;
  73               		.loc 1 85 0
  74 0020 5087      		std Z+8,r21
  75 0022 4783      		std Z+7,r20
  86:../../../os/hal/src/hal_buffers.c ****   ibqp->btop      = bp + ((size + sizeof (size_t)) * n);
  76               		.loc 1 86 0
  77 0024 2E5F      		subi r18,-2
  78 0026 3F4F      		sbci r19,-1
  79               	.LVL3:
  80 0028 209F      		mul r18,r16
  81 002a C001      		movw r24,r0
  82 002c 219F      		mul r18,r17
  83 002e 900D      		add r25,r0
  84 0030 309F      		mul r19,r16
  85 0032 900D      		add r25,r0
  86 0034 1124      		clr r1
  87               	.LVL4:
  88 0036 840F      		add r24,r20
  89 0038 951F      		adc r25,r21
  90 003a 9487      		std Z+12,r25
  91 003c 8387      		std Z+11,r24
  87:../../../os/hal/src/hal_buffers.c ****   ibqp->bsize     = size + sizeof (size_t);
  92               		.loc 1 87 0
  93 003e 3687      		std Z+14,r19
  94 0040 2587      		std Z+13,r18
  88:../../../os/hal/src/hal_buffers.c ****   ibqp->bn        = n;
  95               		.loc 1 88 0
  96 0042 108B      		std Z+16,r17
  97 0044 0787      		std Z+15,r16
  89:../../../os/hal/src/hal_buffers.c ****   ibqp->buffers   = bp;
  98               		.loc 1 89 0
  99 0046 528B      		std Z+18,r21
 100 0048 418B      		std Z+17,r20
  90:../../../os/hal/src/hal_buffers.c ****   ibqp->ptr       = NULL;
 101               		.loc 1 90 0
 102 004a 148A      		std Z+20,__zero_reg__
 103 004c 138A      		std Z+19,__zero_reg__
  91:../../../os/hal/src/hal_buffers.c ****   ibqp->top       = NULL;
 104               		.loc 1 91 0
 105 004e 168A      		std Z+22,__zero_reg__
 106 0050 158A      		std Z+21,__zero_reg__
  92:../../../os/hal/src/hal_buffers.c ****   ibqp->notify    = infy;
 107               		.loc 1 92 0
 108 0052 F08E      		std Z+24,r15
 109 0054 E78A      		std Z+23,r14
  93:../../../os/hal/src/hal_buffers.c ****   ibqp->link      = link;
 110               		.loc 1 93 0
 111 0056 D28E      		std Z+26,r13
 112 0058 C18E      		std Z+25,r12
 113               	/* epilogue start */
  94:../../../os/hal/src/hal_buffers.c **** }
 114               		.loc 1 94 0
 115 005a 1F91      		pop r17
 116 005c 0F91      		pop r16
 117               	.LVL5:
 118 005e FF90      		pop r15
 119 0060 EF90      		pop r14
 120               	.LVL6:
 121 0062 DF90      		pop r13
 122 0064 CF90      		pop r12
 123               	.LVL7:
 124 0066 0895      		ret
 125               		.cfi_endproc
 126               	.LFE168:
 128               		.section	.text.ibqResetI,"ax",@progbits
 129               	.global	ibqResetI
 131               	ibqResetI:
 132               	.LFB169:
  95:../../../os/hal/src/hal_buffers.c **** 
  96:../../../os/hal/src/hal_buffers.c **** /**
  97:../../../os/hal/src/hal_buffers.c ****  * @brief   Resets an input buffers queue.
  98:../../../os/hal/src/hal_buffers.c ****  * @details All the data in the input buffers queue is erased and lost, any
  99:../../../os/hal/src/hal_buffers.c ****  *          waiting thread is resumed with status @p MSG_RESET.
 100:../../../os/hal/src/hal_buffers.c ****  * @note    A reset operation can be used by a low level driver in order to
 101:../../../os/hal/src/hal_buffers.c ****  *          obtain immediate attention from the high level layers.
 102:../../../os/hal/src/hal_buffers.c ****  *
 103:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 104:../../../os/hal/src/hal_buffers.c ****  *
 105:../../../os/hal/src/hal_buffers.c ****  * @iclass
 106:../../../os/hal/src/hal_buffers.c ****  */
 107:../../../os/hal/src/hal_buffers.c **** void ibqResetI(input_buffers_queue_t *ibqp) {
 133               		.loc 1 107 0
 134               		.cfi_startproc
 135               	.LVL8:
 136               	/* prologue: function */
 137               	/* frame size = 0 */
 138               	/* stack size = 0 */
 139               	.L__stack_usage = 0
 140 0000 FC01      		movw r30,r24
 108:../../../os/hal/src/hal_buffers.c **** 
 109:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 110:../../../os/hal/src/hal_buffers.c **** 
 111:../../../os/hal/src/hal_buffers.c ****   ibqp->bcounter  = 0;
 141               		.loc 1 111 0
 142 0002 1682      		std Z+6,__zero_reg__
 143 0004 1582      		std Z+5,__zero_reg__
 112:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr    = ibqp->buffers;
 144               		.loc 1 112 0
 145 0006 8189      		ldd r24,Z+17
 146 0008 9289      		ldd r25,Z+18
 147               	.LVL9:
 148 000a 9287      		std Z+10,r25
 149 000c 8187      		std Z+9,r24
 113:../../../os/hal/src/hal_buffers.c ****   ibqp->bwrptr    = ibqp->buffers;
 150               		.loc 1 113 0
 151 000e 9087      		std Z+8,r25
 152 0010 8783      		std Z+7,r24
 114:../../../os/hal/src/hal_buffers.c ****   ibqp->ptr       = NULL;
 153               		.loc 1 114 0
 154 0012 148A      		std Z+20,__zero_reg__
 155 0014 138A      		std Z+19,__zero_reg__
 115:../../../os/hal/src/hal_buffers.c ****   ibqp->top       = NULL;
 156               		.loc 1 115 0
 157 0016 168A      		std Z+22,__zero_reg__
 158 0018 158A      		std Z+21,__zero_reg__
 159               	.LVL10:
 160               	.LBB258:
 161               	.LBB259:
 162               		.file 3 "../../../os/hal/osal/rt/osal.h"
   1:../../../os/hal/osal/rt/osal.h **** /*
   2:../../../os/hal/osal/rt/osal.h ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio
   3:../../../os/hal/osal/rt/osal.h **** 
   4:../../../os/hal/osal/rt/osal.h ****     Licensed under the Apache License, Version 2.0 (the "License");
   5:../../../os/hal/osal/rt/osal.h ****     you may not use this file except in compliance with the License.
   6:../../../os/hal/osal/rt/osal.h ****     You may obtain a copy of the License at
   7:../../../os/hal/osal/rt/osal.h **** 
   8:../../../os/hal/osal/rt/osal.h ****         http://www.apache.org/licenses/LICENSE-2.0
   9:../../../os/hal/osal/rt/osal.h **** 
  10:../../../os/hal/osal/rt/osal.h ****     Unless required by applicable law or agreed to in writing, software
  11:../../../os/hal/osal/rt/osal.h ****     distributed under the License is distributed on an "AS IS" BASIS,
  12:../../../os/hal/osal/rt/osal.h ****     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13:../../../os/hal/osal/rt/osal.h ****     See the License for the specific language governing permissions and
  14:../../../os/hal/osal/rt/osal.h ****     limitations under the License.
  15:../../../os/hal/osal/rt/osal.h **** */
  16:../../../os/hal/osal/rt/osal.h **** 
  17:../../../os/hal/osal/rt/osal.h **** /**
  18:../../../os/hal/osal/rt/osal.h ****  * @file    osal.h
  19:../../../os/hal/osal/rt/osal.h ****  * @brief   OSAL module header.
  20:../../../os/hal/osal/rt/osal.h ****  *
  21:../../../os/hal/osal/rt/osal.h ****  * @addtogroup OSAL
  22:../../../os/hal/osal/rt/osal.h ****  * @{
  23:../../../os/hal/osal/rt/osal.h ****  */
  24:../../../os/hal/osal/rt/osal.h **** 
  25:../../../os/hal/osal/rt/osal.h **** #ifndef OSAL_H
  26:../../../os/hal/osal/rt/osal.h **** #define OSAL_H
  27:../../../os/hal/osal/rt/osal.h **** 
  28:../../../os/hal/osal/rt/osal.h **** #include <stddef.h>
  29:../../../os/hal/osal/rt/osal.h **** #include <stdint.h>
  30:../../../os/hal/osal/rt/osal.h **** #include <stdbool.h>
  31:../../../os/hal/osal/rt/osal.h **** 
  32:../../../os/hal/osal/rt/osal.h **** #include "ch.h"
  33:../../../os/hal/osal/rt/osal.h **** 
  34:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
  35:../../../os/hal/osal/rt/osal.h **** /* Module constants.                                                         */
  36:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
  37:../../../os/hal/osal/rt/osal.h **** 
  38:../../../os/hal/osal/rt/osal.h **** /**
  39:../../../os/hal/osal/rt/osal.h ****  * @name    Common constants
  40:../../../os/hal/osal/rt/osal.h ****  * @{
  41:../../../os/hal/osal/rt/osal.h ****  */
  42:../../../os/hal/osal/rt/osal.h **** #if !defined(FALSE) || defined(__DOXYGEN__)
  43:../../../os/hal/osal/rt/osal.h **** #define FALSE                               0
  44:../../../os/hal/osal/rt/osal.h **** #endif
  45:../../../os/hal/osal/rt/osal.h **** 
  46:../../../os/hal/osal/rt/osal.h **** #if !defined(TRUE) || defined(__DOXYGEN__)
  47:../../../os/hal/osal/rt/osal.h **** #define TRUE                                1
  48:../../../os/hal/osal/rt/osal.h **** #endif
  49:../../../os/hal/osal/rt/osal.h **** 
  50:../../../os/hal/osal/rt/osal.h **** #define OSAL_SUCCESS                        false
  51:../../../os/hal/osal/rt/osal.h **** #define OSAL_FAILED                         true
  52:../../../os/hal/osal/rt/osal.h **** /** @} */
  53:../../../os/hal/osal/rt/osal.h **** 
  54:../../../os/hal/osal/rt/osal.h **** #if 0
  55:../../../os/hal/osal/rt/osal.h **** /**
  56:../../../os/hal/osal/rt/osal.h ****  * @name    Messages
  57:../../../os/hal/osal/rt/osal.h ****  * @{
  58:../../../os/hal/osal/rt/osal.h ****  */
  59:../../../os/hal/osal/rt/osal.h **** #define MSG_OK                              (msg_t)0
  60:../../../os/hal/osal/rt/osal.h **** #define MSG_TIMEOUT                         (msg_t)-1
  61:../../../os/hal/osal/rt/osal.h **** #define MSG_RESET                           (msg_t)-2
  62:../../../os/hal/osal/rt/osal.h **** /** @} */
  63:../../../os/hal/osal/rt/osal.h **** #endif
  64:../../../os/hal/osal/rt/osal.h **** 
  65:../../../os/hal/osal/rt/osal.h **** #if 0
  66:../../../os/hal/osal/rt/osal.h **** /**
  67:../../../os/hal/osal/rt/osal.h ****  * @name    Special time constants
  68:../../../os/hal/osal/rt/osal.h ****  * @{
  69:../../../os/hal/osal/rt/osal.h ****  */
  70:../../../os/hal/osal/rt/osal.h **** #define TIME_IMMEDIATE                      ((sysinterval_t)0)
  71:../../../os/hal/osal/rt/osal.h **** #define TIME_INFINITE                       ((sysinterval_t)-1)
  72:../../../os/hal/osal/rt/osal.h **** /** @} */
  73:../../../os/hal/osal/rt/osal.h **** #endif
  74:../../../os/hal/osal/rt/osal.h **** 
  75:../../../os/hal/osal/rt/osal.h **** /**
  76:../../../os/hal/osal/rt/osal.h ****  * @name    Systick modes.
  77:../../../os/hal/osal/rt/osal.h ****  * @{
  78:../../../os/hal/osal/rt/osal.h ****  */
  79:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_MODE_NONE                   0
  80:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_MODE_PERIODIC               1
  81:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_MODE_FREERUNNING            2
  82:../../../os/hal/osal/rt/osal.h **** /** @} */
  83:../../../os/hal/osal/rt/osal.h **** 
  84:../../../os/hal/osal/rt/osal.h **** /**
  85:../../../os/hal/osal/rt/osal.h ****  * @name    Systick parameters.
  86:../../../os/hal/osal/rt/osal.h ****  * @{
  87:../../../os/hal/osal/rt/osal.h ****  */
  88:../../../os/hal/osal/rt/osal.h **** /**
  89:../../../os/hal/osal/rt/osal.h ****  * @brief   Size in bits of the @p systick_t type.
  90:../../../os/hal/osal/rt/osal.h ****  */
  91:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_RESOLUTION                  CH_CFG_ST_RESOLUTION
  92:../../../os/hal/osal/rt/osal.h **** 
  93:../../../os/hal/osal/rt/osal.h **** /**
  94:../../../os/hal/osal/rt/osal.h ****  * @brief   Required systick frequency or resolution.
  95:../../../os/hal/osal/rt/osal.h ****  */
  96:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_FREQUENCY                   CH_CFG_ST_FREQUENCY
  97:../../../os/hal/osal/rt/osal.h **** 
  98:../../../os/hal/osal/rt/osal.h **** /**
  99:../../../os/hal/osal/rt/osal.h ****  * @brief   Systick mode required by the underlying OS.
 100:../../../os/hal/osal/rt/osal.h ****  */
 101:../../../os/hal/osal/rt/osal.h **** #if (CH_CFG_ST_TIMEDELTA == 0) || defined(__DOXYGEN__)
 102:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_MODE                        OSAL_ST_MODE_PERIODIC
 103:../../../os/hal/osal/rt/osal.h **** #else
 104:../../../os/hal/osal/rt/osal.h **** #define OSAL_ST_MODE                        OSAL_ST_MODE_FREERUNNING
 105:../../../os/hal/osal/rt/osal.h **** #endif
 106:../../../os/hal/osal/rt/osal.h **** /** @} */
 107:../../../os/hal/osal/rt/osal.h **** 
 108:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 109:../../../os/hal/osal/rt/osal.h **** /* Module pre-compile time settings.                                         */
 110:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 111:../../../os/hal/osal/rt/osal.h **** 
 112:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 113:../../../os/hal/osal/rt/osal.h **** /* Derived constants and error checks.                                       */
 114:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 115:../../../os/hal/osal/rt/osal.h **** 
 116:../../../os/hal/osal/rt/osal.h **** #if !(OSAL_ST_MODE == OSAL_ST_MODE_NONE) &&                                 \
 117:../../../os/hal/osal/rt/osal.h ****     !(OSAL_ST_MODE == OSAL_ST_MODE_PERIODIC) &&                             \
 118:../../../os/hal/osal/rt/osal.h ****     !(OSAL_ST_MODE == OSAL_ST_MODE_FREERUNNING)
 119:../../../os/hal/osal/rt/osal.h **** #error "invalid OSAL_ST_MODE setting in osal.h"
 120:../../../os/hal/osal/rt/osal.h **** #endif
 121:../../../os/hal/osal/rt/osal.h **** 
 122:../../../os/hal/osal/rt/osal.h **** #if (OSAL_ST_RESOLUTION != 16) && (OSAL_ST_RESOLUTION != 32)
 123:../../../os/hal/osal/rt/osal.h **** #error "invalid OSAL_ST_RESOLUTION, must be 16 or 32"
 124:../../../os/hal/osal/rt/osal.h **** #endif
 125:../../../os/hal/osal/rt/osal.h **** 
 126:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 127:../../../os/hal/osal/rt/osal.h **** /* Module data structures and types.                                         */
 128:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 129:../../../os/hal/osal/rt/osal.h **** 
 130:../../../os/hal/osal/rt/osal.h **** #if 0
 131:../../../os/hal/osal/rt/osal.h **** /**
 132:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of a system status word.
 133:../../../os/hal/osal/rt/osal.h ****  */
 134:../../../os/hal/osal/rt/osal.h **** typedef uint32_t syssts_t;
 135:../../../os/hal/osal/rt/osal.h **** #endif
 136:../../../os/hal/osal/rt/osal.h **** 
 137:../../../os/hal/osal/rt/osal.h **** #if 0
 138:../../../os/hal/osal/rt/osal.h **** /**
 139:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of a message.
 140:../../../os/hal/osal/rt/osal.h ****  */
 141:../../../os/hal/osal/rt/osal.h **** typedef int32_t msg_t;
 142:../../../os/hal/osal/rt/osal.h **** #endif
 143:../../../os/hal/osal/rt/osal.h **** 
 144:../../../os/hal/osal/rt/osal.h **** #if 0
 145:../../../os/hal/osal/rt/osal.h **** /**
 146:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of system time counter.
 147:../../../os/hal/osal/rt/osal.h ****  */
 148:../../../os/hal/osal/rt/osal.h **** typedef uint32_t systime_t;
 149:../../../os/hal/osal/rt/osal.h **** #endif
 150:../../../os/hal/osal/rt/osal.h **** 
 151:../../../os/hal/osal/rt/osal.h **** #if 0
 152:../../../os/hal/osal/rt/osal.h **** /**
 153:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of system time interval.
 154:../../../os/hal/osal/rt/osal.h ****  */
 155:../../../os/hal/osal/rt/osal.h **** typedef uint32_t sysinterval_t;
 156:../../../os/hal/osal/rt/osal.h **** #endif
 157:../../../os/hal/osal/rt/osal.h **** 
 158:../../../os/hal/osal/rt/osal.h **** #if 0
 159:../../../os/hal/osal/rt/osal.h **** /**
 160:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of realtime counter.
 161:../../../os/hal/osal/rt/osal.h ****  */
 162:../../../os/hal/osal/rt/osal.h **** typedef uint32_t rtcnt_t;
 163:../../../os/hal/osal/rt/osal.h **** #endif
 164:../../../os/hal/osal/rt/osal.h **** 
 165:../../../os/hal/osal/rt/osal.h **** #if 0
 166:../../../os/hal/osal/rt/osal.h **** /**
 167:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of a thread reference.
 168:../../../os/hal/osal/rt/osal.h ****  */
 169:../../../os/hal/osal/rt/osal.h **** typedef thread_t * thread_reference_t;
 170:../../../os/hal/osal/rt/osal.h **** #endif
 171:../../../os/hal/osal/rt/osal.h **** 
 172:../../../os/hal/osal/rt/osal.h **** #if 0
 173:../../../os/hal/osal/rt/osal.h **** /**
 174:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of an event flags mask.
 175:../../../os/hal/osal/rt/osal.h ****  */
 176:../../../os/hal/osal/rt/osal.h **** typedef uint32_t eventflags_t;
 177:../../../os/hal/osal/rt/osal.h **** #endif
 178:../../../os/hal/osal/rt/osal.h **** 
 179:../../../os/hal/osal/rt/osal.h **** #if (CH_CFG_USE_EVENTS == FALSE) || defined(__DOXYGEN__)
 180:../../../os/hal/osal/rt/osal.h **** /**
 181:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of an event flags object.
 182:../../../os/hal/osal/rt/osal.h ****  * @note    The content of this structure is not part of the API and should
 183:../../../os/hal/osal/rt/osal.h ****  *          not be relied upon. Implementers may define this structure in
 184:../../../os/hal/osal/rt/osal.h ****  *          an entirely different way.
 185:../../../os/hal/osal/rt/osal.h ****  * @note    Retrieval and clearing of the flags are not defined in this
 186:../../../os/hal/osal/rt/osal.h ****  *          API and are implementation-dependent.
 187:../../../os/hal/osal/rt/osal.h ****  */
 188:../../../os/hal/osal/rt/osal.h **** typedef struct event_source event_source_t;
 189:../../../os/hal/osal/rt/osal.h **** 
 190:../../../os/hal/osal/rt/osal.h **** /**
 191:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of an event source callback.
 192:../../../os/hal/osal/rt/osal.h ****  * @note    This type is not part of the OSAL API and is provided
 193:../../../os/hal/osal/rt/osal.h ****  *          exclusively as an example and for convenience.
 194:../../../os/hal/osal/rt/osal.h ****  */
 195:../../../os/hal/osal/rt/osal.h **** typedef void (*eventcallback_t)(event_source_t *esp);
 196:../../../os/hal/osal/rt/osal.h **** 
 197:../../../os/hal/osal/rt/osal.h **** /**
 198:../../../os/hal/osal/rt/osal.h ****  * @brief   Events source object.
 199:../../../os/hal/osal/rt/osal.h ****  * @note    The content of this structure is not part of the API and should
 200:../../../os/hal/osal/rt/osal.h ****  *          not be relied upon. Implementers may define this structure in
 201:../../../os/hal/osal/rt/osal.h ****  *          an entirely different way.
 202:../../../os/hal/osal/rt/osal.h ****  * @note    Retrieval and clearing of the flags are not defined in this
 203:../../../os/hal/osal/rt/osal.h ****  *          API and are implementation-dependent.
 204:../../../os/hal/osal/rt/osal.h ****  */
 205:../../../os/hal/osal/rt/osal.h **** struct event_source {
 206:../../../os/hal/osal/rt/osal.h ****   volatile eventflags_t flags;      /**< @brief Stored event flags.         */
 207:../../../os/hal/osal/rt/osal.h ****   eventcallback_t       cb;         /**< @brief Event source callback.      */
 208:../../../os/hal/osal/rt/osal.h ****   void                  *param;     /**< @brief User defined field.         */
 209:../../../os/hal/osal/rt/osal.h **** };
 210:../../../os/hal/osal/rt/osal.h **** #endif /* CH_CFG_USE_EVENTS == FALSE */
 211:../../../os/hal/osal/rt/osal.h **** 
 212:../../../os/hal/osal/rt/osal.h **** /**
 213:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of a mutex.
 214:../../../os/hal/osal/rt/osal.h ****  * @note    If the OS does not support mutexes or there is no OS then the
 215:../../../os/hal/osal/rt/osal.h ****  *          mechanism can be simulated.
 216:../../../os/hal/osal/rt/osal.h ****  */
 217:../../../os/hal/osal/rt/osal.h **** #if CH_CFG_USE_MUTEXES || defined(__DOXYGEN__)
 218:../../../os/hal/osal/rt/osal.h **** #elif CH_CFG_USE_SEMAPHORES
 219:../../../os/hal/osal/rt/osal.h **** typedef semaphore_t mutex_t;
 220:../../../os/hal/osal/rt/osal.h **** #else
 221:../../../os/hal/osal/rt/osal.h **** typedef uint32_t mutex_t;
 222:../../../os/hal/osal/rt/osal.h **** #endif
 223:../../../os/hal/osal/rt/osal.h **** 
 224:../../../os/hal/osal/rt/osal.h **** #if 0
 225:../../../os/hal/osal/rt/osal.h **** /**
 226:../../../os/hal/osal/rt/osal.h ****  * @brief   Type of a thread queue.
 227:../../../os/hal/osal/rt/osal.h ****  * @details A thread queue is a queue of sleeping threads, queued threads
 228:../../../os/hal/osal/rt/osal.h ****  *          can be dequeued one at time or all together.
 229:../../../os/hal/osal/rt/osal.h ****  * @note    In this implementation it is implemented as a single reference
 230:../../../os/hal/osal/rt/osal.h ****  *          because there are no real threads.
 231:../../../os/hal/osal/rt/osal.h ****  */
 232:../../../os/hal/osal/rt/osal.h **** typedef struct {
 233:../../../os/hal/osal/rt/osal.h ****   thread_reference_t    tr;
 234:../../../os/hal/osal/rt/osal.h **** } threads_queue_t;
 235:../../../os/hal/osal/rt/osal.h **** #endif
 236:../../../os/hal/osal/rt/osal.h **** 
 237:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 238:../../../os/hal/osal/rt/osal.h **** /* Module macros.                                                            */
 239:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 240:../../../os/hal/osal/rt/osal.h **** 
 241:../../../os/hal/osal/rt/osal.h **** /**
 242:../../../os/hal/osal/rt/osal.h ****  * @name    Debug related macros
 243:../../../os/hal/osal/rt/osal.h ****  * @{
 244:../../../os/hal/osal/rt/osal.h ****  */
 245:../../../os/hal/osal/rt/osal.h **** /**
 246:../../../os/hal/osal/rt/osal.h ****  * @brief   Condition assertion.
 247:../../../os/hal/osal/rt/osal.h ****  * @details If the condition check fails then the OSAL panics with a
 248:../../../os/hal/osal/rt/osal.h ****  *          message and halts.
 249:../../../os/hal/osal/rt/osal.h ****  * @note    The condition is tested only if the @p OSAL_ENABLE_ASSERTIONS
 250:../../../os/hal/osal/rt/osal.h ****  *          switch is enabled.
 251:../../../os/hal/osal/rt/osal.h ****  * @note    The remark string is not currently used except for putting a
 252:../../../os/hal/osal/rt/osal.h ****  *          comment in the code about the assertion.
 253:../../../os/hal/osal/rt/osal.h ****  *
 254:../../../os/hal/osal/rt/osal.h ****  * @param[in] c         the condition to be verified to be true
 255:../../../os/hal/osal/rt/osal.h ****  * @param[in] remark    a remark string
 256:../../../os/hal/osal/rt/osal.h ****  *
 257:../../../os/hal/osal/rt/osal.h ****  * @api
 258:../../../os/hal/osal/rt/osal.h ****  */
 259:../../../os/hal/osal/rt/osal.h **** #define osalDbgAssert(c, remark) chDbgAssert(c, remark)
 260:../../../os/hal/osal/rt/osal.h **** 
 261:../../../os/hal/osal/rt/osal.h **** /**
 262:../../../os/hal/osal/rt/osal.h ****  * @brief   Function parameters check.
 263:../../../os/hal/osal/rt/osal.h ****  * @details If the condition check fails then the OSAL panics and halts.
 264:../../../os/hal/osal/rt/osal.h ****  * @note    The condition is tested only if the @p OSAL_ENABLE_CHECKS switch
 265:../../../os/hal/osal/rt/osal.h ****  *          is enabled.
 266:../../../os/hal/osal/rt/osal.h ****  *
 267:../../../os/hal/osal/rt/osal.h ****  * @param[in] c         the condition to be verified to be true
 268:../../../os/hal/osal/rt/osal.h ****  *
 269:../../../os/hal/osal/rt/osal.h ****  * @api
 270:../../../os/hal/osal/rt/osal.h ****  */
 271:../../../os/hal/osal/rt/osal.h **** #define osalDbgCheck(c) chDbgCheck(c)
 272:../../../os/hal/osal/rt/osal.h **** 
 273:../../../os/hal/osal/rt/osal.h **** /**
 274:../../../os/hal/osal/rt/osal.h ****  * @brief   I-Class state check.
 275:../../../os/hal/osal/rt/osal.h ****  * @note    Not implemented in this simplified OSAL.
 276:../../../os/hal/osal/rt/osal.h ****  */
 277:../../../os/hal/osal/rt/osal.h **** #define osalDbgCheckClassI() chDbgCheckClassI()
 278:../../../os/hal/osal/rt/osal.h **** 
 279:../../../os/hal/osal/rt/osal.h **** /**
 280:../../../os/hal/osal/rt/osal.h ****  * @brief   S-Class state check.
 281:../../../os/hal/osal/rt/osal.h ****  * @note    Not implemented in this simplified OSAL.
 282:../../../os/hal/osal/rt/osal.h ****  */
 283:../../../os/hal/osal/rt/osal.h **** #define osalDbgCheckClassS() chDbgCheckClassS()
 284:../../../os/hal/osal/rt/osal.h **** /** @} */
 285:../../../os/hal/osal/rt/osal.h **** 
 286:../../../os/hal/osal/rt/osal.h **** /**
 287:../../../os/hal/osal/rt/osal.h ****  * @name    IRQ service routines wrappers
 288:../../../os/hal/osal/rt/osal.h ****  * @{
 289:../../../os/hal/osal/rt/osal.h ****  */
 290:../../../os/hal/osal/rt/osal.h **** /**
 291:../../../os/hal/osal/rt/osal.h ****  * @brief   Priority level verification macro.
 292:../../../os/hal/osal/rt/osal.h ****  */
 293:../../../os/hal/osal/rt/osal.h **** #define OSAL_IRQ_IS_VALID_PRIORITY(n) CH_IRQ_IS_VALID_KERNEL_PRIORITY(n)
 294:../../../os/hal/osal/rt/osal.h **** 
 295:../../../os/hal/osal/rt/osal.h **** /**
 296:../../../os/hal/osal/rt/osal.h ****  * @brief   IRQ prologue code.
 297:../../../os/hal/osal/rt/osal.h ****  * @details This macro must be inserted at the start of all IRQ handlers.
 298:../../../os/hal/osal/rt/osal.h ****  */
 299:../../../os/hal/osal/rt/osal.h **** #define OSAL_IRQ_PROLOGUE() CH_IRQ_PROLOGUE()
 300:../../../os/hal/osal/rt/osal.h **** 
 301:../../../os/hal/osal/rt/osal.h **** /**
 302:../../../os/hal/osal/rt/osal.h ****  * @brief   IRQ epilogue code.
 303:../../../os/hal/osal/rt/osal.h ****  * @details This macro must be inserted at the end of all IRQ handlers.
 304:../../../os/hal/osal/rt/osal.h ****  */
 305:../../../os/hal/osal/rt/osal.h **** #define OSAL_IRQ_EPILOGUE() CH_IRQ_EPILOGUE()
 306:../../../os/hal/osal/rt/osal.h **** 
 307:../../../os/hal/osal/rt/osal.h **** /**
 308:../../../os/hal/osal/rt/osal.h ****  * @brief   IRQ handler function declaration.
 309:../../../os/hal/osal/rt/osal.h ****  * @details This macro hides the details of an ISR function declaration.
 310:../../../os/hal/osal/rt/osal.h ****  *
 311:../../../os/hal/osal/rt/osal.h ****  * @param[in] id        a vector name as defined in @p vectors.s
 312:../../../os/hal/osal/rt/osal.h ****  */
 313:../../../os/hal/osal/rt/osal.h **** #define OSAL_IRQ_HANDLER(id) CH_IRQ_HANDLER(id)
 314:../../../os/hal/osal/rt/osal.h **** /** @} */
 315:../../../os/hal/osal/rt/osal.h **** 
 316:../../../os/hal/osal/rt/osal.h **** /**
 317:../../../os/hal/osal/rt/osal.h ****  * @name    Time conversion utilities
 318:../../../os/hal/osal/rt/osal.h ****  * @{
 319:../../../os/hal/osal/rt/osal.h ****  */
 320:../../../os/hal/osal/rt/osal.h **** /**
 321:../../../os/hal/osal/rt/osal.h ****  * @brief   Seconds to system ticks.
 322:../../../os/hal/osal/rt/osal.h ****  * @details Converts from seconds to system ticks number.
 323:../../../os/hal/osal/rt/osal.h ****  * @note    The result is rounded upward to the next tick boundary.
 324:../../../os/hal/osal/rt/osal.h ****  *
 325:../../../os/hal/osal/rt/osal.h ****  * @param[in] secs      number of seconds
 326:../../../os/hal/osal/rt/osal.h ****  * @return              The number of ticks.
 327:../../../os/hal/osal/rt/osal.h ****  *
 328:../../../os/hal/osal/rt/osal.h ****  * @api
 329:../../../os/hal/osal/rt/osal.h ****  */
 330:../../../os/hal/osal/rt/osal.h **** #define OSAL_S2I(secs) TIME_S2I(secs)
 331:../../../os/hal/osal/rt/osal.h **** 
 332:../../../os/hal/osal/rt/osal.h **** /**
 333:../../../os/hal/osal/rt/osal.h ****  * @brief   Milliseconds to system ticks.
 334:../../../os/hal/osal/rt/osal.h ****  * @details Converts from milliseconds to system ticks number.
 335:../../../os/hal/osal/rt/osal.h ****  * @note    The result is rounded upward to the next tick boundary.
 336:../../../os/hal/osal/rt/osal.h ****  *
 337:../../../os/hal/osal/rt/osal.h ****  * @param[in] msecs     number of milliseconds
 338:../../../os/hal/osal/rt/osal.h ****  * @return              The number of ticks.
 339:../../../os/hal/osal/rt/osal.h ****  *
 340:../../../os/hal/osal/rt/osal.h ****  * @api
 341:../../../os/hal/osal/rt/osal.h ****  */
 342:../../../os/hal/osal/rt/osal.h **** #define OSAL_MS2I(msecs) TIME_MS2I(msecs)
 343:../../../os/hal/osal/rt/osal.h **** 
 344:../../../os/hal/osal/rt/osal.h **** /**
 345:../../../os/hal/osal/rt/osal.h ****  * @brief   Microseconds to system ticks.
 346:../../../os/hal/osal/rt/osal.h ****  * @details Converts from microseconds to system ticks number.
 347:../../../os/hal/osal/rt/osal.h ****  * @note    The result is rounded upward to the next tick boundary.
 348:../../../os/hal/osal/rt/osal.h ****  *
 349:../../../os/hal/osal/rt/osal.h ****  * @param[in] usecs     number of microseconds
 350:../../../os/hal/osal/rt/osal.h ****  * @return              The number of ticks.
 351:../../../os/hal/osal/rt/osal.h ****  *
 352:../../../os/hal/osal/rt/osal.h ****  * @api
 353:../../../os/hal/osal/rt/osal.h ****  */
 354:../../../os/hal/osal/rt/osal.h **** #define OSAL_US2I(usecs) TIME_US2I(usecs)
 355:../../../os/hal/osal/rt/osal.h **** /** @} */
 356:../../../os/hal/osal/rt/osal.h **** 
 357:../../../os/hal/osal/rt/osal.h **** /**
 358:../../../os/hal/osal/rt/osal.h ****  * @name    Time conversion utilities for the realtime counter
 359:../../../os/hal/osal/rt/osal.h ****  * @{
 360:../../../os/hal/osal/rt/osal.h ****  */
 361:../../../os/hal/osal/rt/osal.h **** /**
 362:../../../os/hal/osal/rt/osal.h ****  * @brief   Seconds to realtime counter.
 363:../../../os/hal/osal/rt/osal.h ****  * @details Converts from seconds to realtime counter cycles.
 364:../../../os/hal/osal/rt/osal.h ****  * @note    The macro assumes that @p freq >= @p 1.
 365:../../../os/hal/osal/rt/osal.h ****  *
 366:../../../os/hal/osal/rt/osal.h ****  * @param[in] freq      clock frequency, in Hz, of the realtime counter
 367:../../../os/hal/osal/rt/osal.h ****  * @param[in] sec       number of seconds
 368:../../../os/hal/osal/rt/osal.h ****  * @return              The number of cycles.
 369:../../../os/hal/osal/rt/osal.h ****  *
 370:../../../os/hal/osal/rt/osal.h ****  * @api
 371:../../../os/hal/osal/rt/osal.h ****  */
 372:../../../os/hal/osal/rt/osal.h **** #define OSAL_S2RTC(freq, sec) S2RTC(freq, sec)
 373:../../../os/hal/osal/rt/osal.h **** 
 374:../../../os/hal/osal/rt/osal.h **** /**
 375:../../../os/hal/osal/rt/osal.h ****  * @brief   Milliseconds to realtime counter.
 376:../../../os/hal/osal/rt/osal.h ****  * @details Converts from milliseconds to realtime counter cycles.
 377:../../../os/hal/osal/rt/osal.h ****  * @note    The result is rounded upward to the next millisecond boundary.
 378:../../../os/hal/osal/rt/osal.h ****  * @note    The macro assumes that @p freq >= @p 1000.
 379:../../../os/hal/osal/rt/osal.h ****  *
 380:../../../os/hal/osal/rt/osal.h ****  * @param[in] freq      clock frequency, in Hz, of the realtime counter
 381:../../../os/hal/osal/rt/osal.h ****  * @param[in] msec      number of milliseconds
 382:../../../os/hal/osal/rt/osal.h ****  * @return              The number of cycles.
 383:../../../os/hal/osal/rt/osal.h ****  *
 384:../../../os/hal/osal/rt/osal.h ****  * @api
 385:../../../os/hal/osal/rt/osal.h ****  */
 386:../../../os/hal/osal/rt/osal.h **** #define OSAL_MS2RTC(freq, msec) MS2RTC(freq, msec)
 387:../../../os/hal/osal/rt/osal.h **** 
 388:../../../os/hal/osal/rt/osal.h **** /**
 389:../../../os/hal/osal/rt/osal.h ****  * @brief   Microseconds to realtime counter.
 390:../../../os/hal/osal/rt/osal.h ****  * @details Converts from microseconds to realtime counter cycles.
 391:../../../os/hal/osal/rt/osal.h ****  * @note    The result is rounded upward to the next microsecond boundary.
 392:../../../os/hal/osal/rt/osal.h ****  * @note    The macro assumes that @p freq >= @p 1000000.
 393:../../../os/hal/osal/rt/osal.h ****  *
 394:../../../os/hal/osal/rt/osal.h ****  * @param[in] freq      clock frequency, in Hz, of the realtime counter
 395:../../../os/hal/osal/rt/osal.h ****  * @param[in] usec      number of microseconds
 396:../../../os/hal/osal/rt/osal.h ****  * @return              The number of cycles.
 397:../../../os/hal/osal/rt/osal.h ****  *
 398:../../../os/hal/osal/rt/osal.h ****  * @api
 399:../../../os/hal/osal/rt/osal.h ****  */
 400:../../../os/hal/osal/rt/osal.h **** #define OSAL_US2RTC(freq, usec) US2RTC(freq, usec)
 401:../../../os/hal/osal/rt/osal.h **** /** @} */
 402:../../../os/hal/osal/rt/osal.h **** 
 403:../../../os/hal/osal/rt/osal.h **** /**
 404:../../../os/hal/osal/rt/osal.h ****  * @name    Sleep macros using absolute time
 405:../../../os/hal/osal/rt/osal.h ****  * @{
 406:../../../os/hal/osal/rt/osal.h ****  */
 407:../../../os/hal/osal/rt/osal.h **** /**
 408:../../../os/hal/osal/rt/osal.h ****  * @brief   Delays the invoking thread for the specified number of seconds.
 409:../../../os/hal/osal/rt/osal.h ****  * @note    The specified time is rounded up to a value allowed by the real
 410:../../../os/hal/osal/rt/osal.h ****  *          system tick clock.
 411:../../../os/hal/osal/rt/osal.h ****  * @note    The maximum specifiable value is implementation dependent.
 412:../../../os/hal/osal/rt/osal.h ****  *
 413:../../../os/hal/osal/rt/osal.h ****  * @param[in] secs      time in seconds, must be different from zero
 414:../../../os/hal/osal/rt/osal.h ****  *
 415:../../../os/hal/osal/rt/osal.h ****  * @api
 416:../../../os/hal/osal/rt/osal.h ****  */
 417:../../../os/hal/osal/rt/osal.h **** #define osalThreadSleepSeconds(secs) osalThreadSleep(OSAL_S2I(secs))
 418:../../../os/hal/osal/rt/osal.h **** 
 419:../../../os/hal/osal/rt/osal.h **** /**
 420:../../../os/hal/osal/rt/osal.h ****  * @brief   Delays the invoking thread for the specified number of
 421:../../../os/hal/osal/rt/osal.h ****  *          milliseconds.
 422:../../../os/hal/osal/rt/osal.h ****  * @note    The specified time is rounded up to a value allowed by the real
 423:../../../os/hal/osal/rt/osal.h ****  *          system tick clock.
 424:../../../os/hal/osal/rt/osal.h ****  * @note    The maximum specifiable value is implementation dependent.
 425:../../../os/hal/osal/rt/osal.h ****  *
 426:../../../os/hal/osal/rt/osal.h ****  * @param[in] msecs     time in milliseconds, must be different from zero
 427:../../../os/hal/osal/rt/osal.h ****  *
 428:../../../os/hal/osal/rt/osal.h ****  * @api
 429:../../../os/hal/osal/rt/osal.h ****  */
 430:../../../os/hal/osal/rt/osal.h **** #define osalThreadSleepMilliseconds(msecs) osalThreadSleep(OSAL_MS2I(msecs))
 431:../../../os/hal/osal/rt/osal.h **** 
 432:../../../os/hal/osal/rt/osal.h **** /**
 433:../../../os/hal/osal/rt/osal.h ****  * @brief   Delays the invoking thread for the specified number of
 434:../../../os/hal/osal/rt/osal.h ****  *          microseconds.
 435:../../../os/hal/osal/rt/osal.h ****  * @note    The specified time is rounded up to a value allowed by the real
 436:../../../os/hal/osal/rt/osal.h ****  *          system tick clock.
 437:../../../os/hal/osal/rt/osal.h ****  * @note    The maximum specifiable value is implementation dependent.
 438:../../../os/hal/osal/rt/osal.h ****  *
 439:../../../os/hal/osal/rt/osal.h ****  * @param[in] usecs     time in microseconds, must be different from zero
 440:../../../os/hal/osal/rt/osal.h ****  *
 441:../../../os/hal/osal/rt/osal.h ****  * @api
 442:../../../os/hal/osal/rt/osal.h ****  */
 443:../../../os/hal/osal/rt/osal.h **** #define osalThreadSleepMicroseconds(usecs) osalThreadSleep(OSAL_US2I(usecs))
 444:../../../os/hal/osal/rt/osal.h **** /** @} */
 445:../../../os/hal/osal/rt/osal.h **** 
 446:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 447:../../../os/hal/osal/rt/osal.h **** /* External declarations.                                                    */
 448:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 449:../../../os/hal/osal/rt/osal.h **** 
 450:../../../os/hal/osal/rt/osal.h **** #ifdef __cplusplus
 451:../../../os/hal/osal/rt/osal.h **** extern "C" {
 452:../../../os/hal/osal/rt/osal.h **** #endif
 453:../../../os/hal/osal/rt/osal.h **** 
 454:../../../os/hal/osal/rt/osal.h **** #ifdef __cplusplus
 455:../../../os/hal/osal/rt/osal.h **** }
 456:../../../os/hal/osal/rt/osal.h **** #endif
 457:../../../os/hal/osal/rt/osal.h **** 
 458:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 459:../../../os/hal/osal/rt/osal.h **** /* Module inline functions.                                                  */
 460:../../../os/hal/osal/rt/osal.h **** /*===========================================================================*/
 461:../../../os/hal/osal/rt/osal.h **** 
 462:../../../os/hal/osal/rt/osal.h **** /**
 463:../../../os/hal/osal/rt/osal.h ****  * @brief   OSAL module initialization.
 464:../../../os/hal/osal/rt/osal.h ****  *
 465:../../../os/hal/osal/rt/osal.h ****  * @api
 466:../../../os/hal/osal/rt/osal.h ****  */
 467:../../../os/hal/osal/rt/osal.h **** static inline void osalInit(void) {
 468:../../../os/hal/osal/rt/osal.h **** 
 469:../../../os/hal/osal/rt/osal.h **** }
 470:../../../os/hal/osal/rt/osal.h **** 
 471:../../../os/hal/osal/rt/osal.h **** /**
 472:../../../os/hal/osal/rt/osal.h ****  * @brief   System halt with error message.
 473:../../../os/hal/osal/rt/osal.h ****  *
 474:../../../os/hal/osal/rt/osal.h ****  * @param[in] reason    the halt message pointer
 475:../../../os/hal/osal/rt/osal.h ****  *
 476:../../../os/hal/osal/rt/osal.h ****  * @api
 477:../../../os/hal/osal/rt/osal.h ****  */
 478:../../../os/hal/osal/rt/osal.h **** static inline void osalSysHalt(const char *reason) {
 479:../../../os/hal/osal/rt/osal.h **** 
 480:../../../os/hal/osal/rt/osal.h ****   chSysHalt(reason);
 481:../../../os/hal/osal/rt/osal.h **** }
 482:../../../os/hal/osal/rt/osal.h **** 
 483:../../../os/hal/osal/rt/osal.h **** /**
 484:../../../os/hal/osal/rt/osal.h ****  * @brief   Disables interrupts globally.
 485:../../../os/hal/osal/rt/osal.h ****  *
 486:../../../os/hal/osal/rt/osal.h ****  * @special
 487:../../../os/hal/osal/rt/osal.h ****  */
 488:../../../os/hal/osal/rt/osal.h **** static inline void osalSysDisable(void) {
 489:../../../os/hal/osal/rt/osal.h **** 
 490:../../../os/hal/osal/rt/osal.h ****   chSysDisable();
 491:../../../os/hal/osal/rt/osal.h **** }
 492:../../../os/hal/osal/rt/osal.h **** 
 493:../../../os/hal/osal/rt/osal.h **** /**
 494:../../../os/hal/osal/rt/osal.h ****  * @brief   Enables interrupts globally.
 495:../../../os/hal/osal/rt/osal.h ****  *
 496:../../../os/hal/osal/rt/osal.h ****  * @special
 497:../../../os/hal/osal/rt/osal.h ****  */
 498:../../../os/hal/osal/rt/osal.h **** static inline void osalSysEnable(void) {
 499:../../../os/hal/osal/rt/osal.h **** 
 500:../../../os/hal/osal/rt/osal.h ****   chSysEnable();
 501:../../../os/hal/osal/rt/osal.h **** }
 502:../../../os/hal/osal/rt/osal.h **** 
 503:../../../os/hal/osal/rt/osal.h **** /**
 504:../../../os/hal/osal/rt/osal.h ****  * @brief   Enters a critical zone from thread context.
 505:../../../os/hal/osal/rt/osal.h ****  * @note    This function cannot be used for reentrant critical zones.
 506:../../../os/hal/osal/rt/osal.h ****  *
 507:../../../os/hal/osal/rt/osal.h ****  * @special
 508:../../../os/hal/osal/rt/osal.h ****  */
 509:../../../os/hal/osal/rt/osal.h **** static inline void osalSysLock(void) {
 510:../../../os/hal/osal/rt/osal.h **** 
 511:../../../os/hal/osal/rt/osal.h ****   chSysLock();
 512:../../../os/hal/osal/rt/osal.h **** }
 513:../../../os/hal/osal/rt/osal.h **** 
 514:../../../os/hal/osal/rt/osal.h **** /**
 515:../../../os/hal/osal/rt/osal.h ****  * @brief   Leaves a critical zone from thread context.
 516:../../../os/hal/osal/rt/osal.h ****  * @note    This function cannot be used for reentrant critical zones.
 517:../../../os/hal/osal/rt/osal.h ****  *
 518:../../../os/hal/osal/rt/osal.h ****  * @special
 519:../../../os/hal/osal/rt/osal.h ****  */
 520:../../../os/hal/osal/rt/osal.h **** static inline void osalSysUnlock(void) {
 521:../../../os/hal/osal/rt/osal.h **** 
 522:../../../os/hal/osal/rt/osal.h ****   chSysUnlock();
 523:../../../os/hal/osal/rt/osal.h **** }
 524:../../../os/hal/osal/rt/osal.h **** 
 525:../../../os/hal/osal/rt/osal.h **** /**
 526:../../../os/hal/osal/rt/osal.h ****  * @brief   Enters a critical zone from ISR context.
 527:../../../os/hal/osal/rt/osal.h ****  * @note    This function cannot be used for reentrant critical zones.
 528:../../../os/hal/osal/rt/osal.h ****  *
 529:../../../os/hal/osal/rt/osal.h ****  * @special
 530:../../../os/hal/osal/rt/osal.h ****  */
 531:../../../os/hal/osal/rt/osal.h **** static inline void osalSysLockFromISR(void) {
 532:../../../os/hal/osal/rt/osal.h **** 
 533:../../../os/hal/osal/rt/osal.h ****   chSysLockFromISR();
 534:../../../os/hal/osal/rt/osal.h **** }
 535:../../../os/hal/osal/rt/osal.h **** 
 536:../../../os/hal/osal/rt/osal.h **** /**
 537:../../../os/hal/osal/rt/osal.h ****  * @brief   Leaves a critical zone from ISR context.
 538:../../../os/hal/osal/rt/osal.h ****  * @note    This function cannot be used for reentrant critical zones.
 539:../../../os/hal/osal/rt/osal.h ****  *
 540:../../../os/hal/osal/rt/osal.h ****  * @special
 541:../../../os/hal/osal/rt/osal.h ****  */
 542:../../../os/hal/osal/rt/osal.h **** static inline void osalSysUnlockFromISR(void) {
 543:../../../os/hal/osal/rt/osal.h **** 
 544:../../../os/hal/osal/rt/osal.h ****   chSysUnlockFromISR();
 545:../../../os/hal/osal/rt/osal.h **** }
 546:../../../os/hal/osal/rt/osal.h **** 
 547:../../../os/hal/osal/rt/osal.h **** /**
 548:../../../os/hal/osal/rt/osal.h ****  * @brief   Returns the execution status and enters a critical zone.
 549:../../../os/hal/osal/rt/osal.h ****  * @details This functions enters into a critical zone and can be called
 550:../../../os/hal/osal/rt/osal.h ****  *          from any context. Because its flexibility it is less efficient
 551:../../../os/hal/osal/rt/osal.h ****  *          than @p chSysLock() which is preferable when the calling context
 552:../../../os/hal/osal/rt/osal.h ****  *          is known.
 553:../../../os/hal/osal/rt/osal.h ****  * @post    The system is in a critical zone.
 554:../../../os/hal/osal/rt/osal.h ****  *
 555:../../../os/hal/osal/rt/osal.h ****  * @return              The previous system status, the encoding of this
 556:../../../os/hal/osal/rt/osal.h ****  *                      status word is architecture-dependent and opaque.
 557:../../../os/hal/osal/rt/osal.h ****  *
 558:../../../os/hal/osal/rt/osal.h ****  * @xclass
 559:../../../os/hal/osal/rt/osal.h ****  */
 560:../../../os/hal/osal/rt/osal.h **** static inline syssts_t osalSysGetStatusAndLockX(void) {
 561:../../../os/hal/osal/rt/osal.h **** 
 562:../../../os/hal/osal/rt/osal.h ****   return chSysGetStatusAndLockX();
 563:../../../os/hal/osal/rt/osal.h **** }
 564:../../../os/hal/osal/rt/osal.h **** 
 565:../../../os/hal/osal/rt/osal.h **** /**
 566:../../../os/hal/osal/rt/osal.h ****  * @brief   Restores the specified execution status and leaves a critical zone.
 567:../../../os/hal/osal/rt/osal.h ****  * @note    A call to @p chSchRescheduleS() is automatically performed
 568:../../../os/hal/osal/rt/osal.h ****  *          if exiting the critical zone and if not in ISR context.
 569:../../../os/hal/osal/rt/osal.h ****  *
 570:../../../os/hal/osal/rt/osal.h ****  * @param[in] sts       the system status to be restored.
 571:../../../os/hal/osal/rt/osal.h ****  *
 572:../../../os/hal/osal/rt/osal.h ****  * @xclass
 573:../../../os/hal/osal/rt/osal.h ****  */
 574:../../../os/hal/osal/rt/osal.h **** static inline void osalSysRestoreStatusX(syssts_t sts) {
 575:../../../os/hal/osal/rt/osal.h **** 
 576:../../../os/hal/osal/rt/osal.h ****   chSysRestoreStatusX(sts);
 577:../../../os/hal/osal/rt/osal.h **** }
 578:../../../os/hal/osal/rt/osal.h **** 
 579:../../../os/hal/osal/rt/osal.h **** /**
 580:../../../os/hal/osal/rt/osal.h ****  * @brief   Polled delay.
 581:../../../os/hal/osal/rt/osal.h ****  * @note    The real delay is always few cycles in excess of the specified
 582:../../../os/hal/osal/rt/osal.h ****  *          value.
 583:../../../os/hal/osal/rt/osal.h ****  *
 584:../../../os/hal/osal/rt/osal.h ****  * @param[in] cycles    number of cycles
 585:../../../os/hal/osal/rt/osal.h ****  *
 586:../../../os/hal/osal/rt/osal.h ****  * @xclass
 587:../../../os/hal/osal/rt/osal.h ****  */
 588:../../../os/hal/osal/rt/osal.h **** #if (PORT_SUPPORTS_RT == TRUE) || defined(__DOXYGEN__)
 589:../../../os/hal/osal/rt/osal.h **** static inline void osalSysPolledDelayX(rtcnt_t cycles) {
 590:../../../os/hal/osal/rt/osal.h **** 
 591:../../../os/hal/osal/rt/osal.h ****   chSysPolledDelayX(cycles);
 592:../../../os/hal/osal/rt/osal.h **** }
 593:../../../os/hal/osal/rt/osal.h **** #endif
 594:../../../os/hal/osal/rt/osal.h **** 
 595:../../../os/hal/osal/rt/osal.h **** /**
 596:../../../os/hal/osal/rt/osal.h ****  * @brief   Systick callback for the underlying OS.
 597:../../../os/hal/osal/rt/osal.h ****  * @note    This callback is only defined if the OSAL requires such a
 598:../../../os/hal/osal/rt/osal.h ****  *          service from the HAL.
 599:../../../os/hal/osal/rt/osal.h ****  */
 600:../../../os/hal/osal/rt/osal.h **** #if (OSAL_ST_MODE != OSAL_ST_MODE_NONE) || defined(__DOXYGEN__)
 601:../../../os/hal/osal/rt/osal.h **** static inline void osalOsTimerHandlerI(void) {
 602:../../../os/hal/osal/rt/osal.h **** 
 603:../../../os/hal/osal/rt/osal.h ****   chSysTimerHandlerI();
 604:../../../os/hal/osal/rt/osal.h **** }
 605:../../../os/hal/osal/rt/osal.h **** #endif
 606:../../../os/hal/osal/rt/osal.h **** 
 607:../../../os/hal/osal/rt/osal.h **** /**
 608:../../../os/hal/osal/rt/osal.h ****  * @brief   Checks if a reschedule is required and performs it.
 609:../../../os/hal/osal/rt/osal.h ****  * @note    I-Class functions invoked from thread context must not reschedule
 610:../../../os/hal/osal/rt/osal.h ****  *          by themselves, an explicit reschedule using this function is
 611:../../../os/hal/osal/rt/osal.h ****  *          required in this scenario.
 612:../../../os/hal/osal/rt/osal.h ****  * @note    Not implemented in this simplified OSAL.
 613:../../../os/hal/osal/rt/osal.h ****  *
 614:../../../os/hal/osal/rt/osal.h ****  * @sclass
 615:../../../os/hal/osal/rt/osal.h ****  */
 616:../../../os/hal/osal/rt/osal.h **** static inline void osalOsRescheduleS(void) {
 617:../../../os/hal/osal/rt/osal.h **** 
 618:../../../os/hal/osal/rt/osal.h ****   chSchRescheduleS();
 619:../../../os/hal/osal/rt/osal.h **** }
 620:../../../os/hal/osal/rt/osal.h **** 
 621:../../../os/hal/osal/rt/osal.h **** /**
 622:../../../os/hal/osal/rt/osal.h ****  * @brief   Current system time.
 623:../../../os/hal/osal/rt/osal.h ****  * @details Returns the number of system ticks since the @p osalInit()
 624:../../../os/hal/osal/rt/osal.h ****  *          invocation.
 625:../../../os/hal/osal/rt/osal.h ****  * @note    The counter can reach its maximum and then restart from zero.
 626:../../../os/hal/osal/rt/osal.h ****  * @note    This function can be called from any context but its atomicity
 627:../../../os/hal/osal/rt/osal.h ****  *          is not guaranteed on architectures whose word size is less than
 628:../../../os/hal/osal/rt/osal.h ****  *          @p systime_t size.
 629:../../../os/hal/osal/rt/osal.h ****  *
 630:../../../os/hal/osal/rt/osal.h ****  * @return              The system time in ticks.
 631:../../../os/hal/osal/rt/osal.h ****  *
 632:../../../os/hal/osal/rt/osal.h ****  * @xclass
 633:../../../os/hal/osal/rt/osal.h ****  */
 634:../../../os/hal/osal/rt/osal.h **** static inline systime_t osalOsGetSystemTimeX(void) {
 635:../../../os/hal/osal/rt/osal.h **** 
 636:../../../os/hal/osal/rt/osal.h ****   return chVTGetSystemTimeX();
 637:../../../os/hal/osal/rt/osal.h **** }
 638:../../../os/hal/osal/rt/osal.h **** 
 639:../../../os/hal/osal/rt/osal.h **** /**
 640:../../../os/hal/osal/rt/osal.h ****  * @brief   Adds an interval to a system time returning a system time.
 641:../../../os/hal/osal/rt/osal.h ****  *
 642:../../../os/hal/osal/rt/osal.h ****  * @param[in] systime   base system time
 643:../../../os/hal/osal/rt/osal.h ****  * @param[in] interval  interval to be added
 644:../../../os/hal/osal/rt/osal.h ****  * @return              The new system time.
 645:../../../os/hal/osal/rt/osal.h ****  *
 646:../../../os/hal/osal/rt/osal.h ****  * @xclass
 647:../../../os/hal/osal/rt/osal.h ****  */
 648:../../../os/hal/osal/rt/osal.h **** static inline systime_t osalTimeAddX(systime_t systime,
 649:../../../os/hal/osal/rt/osal.h ****                                      sysinterval_t interval) {
 650:../../../os/hal/osal/rt/osal.h **** 
 651:../../../os/hal/osal/rt/osal.h ****   return chTimeAddX(systime, interval);
 652:../../../os/hal/osal/rt/osal.h **** }
 653:../../../os/hal/osal/rt/osal.h **** 
 654:../../../os/hal/osal/rt/osal.h **** /**
 655:../../../os/hal/osal/rt/osal.h ****  * @brief   Subtracts two system times returning an interval.
 656:../../../os/hal/osal/rt/osal.h ****  *
 657:../../../os/hal/osal/rt/osal.h ****  * @param[in] start     first system time
 658:../../../os/hal/osal/rt/osal.h ****  * @param[in] end       second system time
 659:../../../os/hal/osal/rt/osal.h ****  * @return              The interval representing the time difference.
 660:../../../os/hal/osal/rt/osal.h ****  *
 661:../../../os/hal/osal/rt/osal.h ****  * @xclass
 662:../../../os/hal/osal/rt/osal.h ****  */
 663:../../../os/hal/osal/rt/osal.h **** static inline sysinterval_t osalTimeDiffX(systime_t start, systime_t end) {
 664:../../../os/hal/osal/rt/osal.h **** 
 665:../../../os/hal/osal/rt/osal.h ****   return chTimeDiffX(start, end);
 666:../../../os/hal/osal/rt/osal.h **** }
 667:../../../os/hal/osal/rt/osal.h **** 
 668:../../../os/hal/osal/rt/osal.h **** /**
 669:../../../os/hal/osal/rt/osal.h ****  * @brief   Checks if the specified time is within the specified time window.
 670:../../../os/hal/osal/rt/osal.h ****  * @note    When start==end then the function returns always true because the
 671:../../../os/hal/osal/rt/osal.h ****  *          whole time range is specified.
 672:../../../os/hal/osal/rt/osal.h ****  * @note    This function can be called from any context.
 673:../../../os/hal/osal/rt/osal.h ****  *
 674:../../../os/hal/osal/rt/osal.h ****  * @param[in] time      the time to be verified
 675:../../../os/hal/osal/rt/osal.h ****  * @param[in] start     the start of the time window (inclusive)
 676:../../../os/hal/osal/rt/osal.h ****  * @param[in] end       the end of the time window (non inclusive)
 677:../../../os/hal/osal/rt/osal.h ****  * @retval true         current time within the specified time window.
 678:../../../os/hal/osal/rt/osal.h ****  * @retval false        current time not within the specified time window.
 679:../../../os/hal/osal/rt/osal.h ****  *
 680:../../../os/hal/osal/rt/osal.h ****  * @xclass
 681:../../../os/hal/osal/rt/osal.h ****  */
 682:../../../os/hal/osal/rt/osal.h **** static inline bool osalTimeIsInRangeX(systime_t time,
 683:../../../os/hal/osal/rt/osal.h ****                                       systime_t start,
 684:../../../os/hal/osal/rt/osal.h ****                                       systime_t end) {
 685:../../../os/hal/osal/rt/osal.h **** 
 686:../../../os/hal/osal/rt/osal.h ****   return chTimeIsInRangeX(time, start, end);
 687:../../../os/hal/osal/rt/osal.h **** }
 688:../../../os/hal/osal/rt/osal.h **** 
 689:../../../os/hal/osal/rt/osal.h **** /**
 690:../../../os/hal/osal/rt/osal.h ****  * @brief   Suspends the invoking thread for the specified time.
 691:../../../os/hal/osal/rt/osal.h ****  *
 692:../../../os/hal/osal/rt/osal.h ****  * @param[in] delay     the delay in system ticks, the special values are
 693:../../../os/hal/osal/rt/osal.h ****  *                      handled as follow:
 694:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_INFINITE is allowed but interpreted as a
 695:../../../os/hal/osal/rt/osal.h ****  *                        normal time specification.
 696:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_IMMEDIATE this value is not allowed.
 697:../../../os/hal/osal/rt/osal.h ****  *                      .
 698:../../../os/hal/osal/rt/osal.h ****  *
 699:../../../os/hal/osal/rt/osal.h ****  * @sclass
 700:../../../os/hal/osal/rt/osal.h ****  */
 701:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadSleepS(sysinterval_t delay) {
 702:../../../os/hal/osal/rt/osal.h **** 
 703:../../../os/hal/osal/rt/osal.h ****   chThdSleepS(delay);
 704:../../../os/hal/osal/rt/osal.h **** }
 705:../../../os/hal/osal/rt/osal.h **** 
 706:../../../os/hal/osal/rt/osal.h **** /**
 707:../../../os/hal/osal/rt/osal.h ****  * @brief   Suspends the invoking thread for the specified time.
 708:../../../os/hal/osal/rt/osal.h ****  *
 709:../../../os/hal/osal/rt/osal.h ****  * @param[in] delay     the delay in system ticks, the special values are
 710:../../../os/hal/osal/rt/osal.h ****  *                      handled as follow:
 711:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_INFINITE is allowed but interpreted as a
 712:../../../os/hal/osal/rt/osal.h ****  *                        normal time specification.
 713:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_IMMEDIATE this value is not allowed.
 714:../../../os/hal/osal/rt/osal.h ****  *                      .
 715:../../../os/hal/osal/rt/osal.h ****  *
 716:../../../os/hal/osal/rt/osal.h ****  * @api
 717:../../../os/hal/osal/rt/osal.h ****  */
 718:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadSleep(sysinterval_t delay) {
 719:../../../os/hal/osal/rt/osal.h **** 
 720:../../../os/hal/osal/rt/osal.h ****   chThdSleep(delay);
 721:../../../os/hal/osal/rt/osal.h **** }
 722:../../../os/hal/osal/rt/osal.h **** 
 723:../../../os/hal/osal/rt/osal.h **** /**
 724:../../../os/hal/osal/rt/osal.h ****  * @brief   Sends the current thread sleeping and sets a reference variable.
 725:../../../os/hal/osal/rt/osal.h ****  * @note    This function must reschedule, it can only be called from thread
 726:../../../os/hal/osal/rt/osal.h ****  *          context.
 727:../../../os/hal/osal/rt/osal.h ****  *
 728:../../../os/hal/osal/rt/osal.h ****  * @param[in] trp       a pointer to a thread reference object
 729:../../../os/hal/osal/rt/osal.h ****  * @return              The wake up message.
 730:../../../os/hal/osal/rt/osal.h ****  *
 731:../../../os/hal/osal/rt/osal.h ****  * @sclass
 732:../../../os/hal/osal/rt/osal.h ****  */
 733:../../../os/hal/osal/rt/osal.h **** static inline msg_t osalThreadSuspendS(thread_reference_t *trp) {
 734:../../../os/hal/osal/rt/osal.h **** 
 735:../../../os/hal/osal/rt/osal.h ****   return chThdSuspendTimeoutS(trp, TIME_INFINITE);
 736:../../../os/hal/osal/rt/osal.h **** }
 737:../../../os/hal/osal/rt/osal.h **** 
 738:../../../os/hal/osal/rt/osal.h **** /**
 739:../../../os/hal/osal/rt/osal.h ****  * @brief   Sends the current thread sleeping and sets a reference variable.
 740:../../../os/hal/osal/rt/osal.h ****  * @note    This function must reschedule, it can only be called from thread
 741:../../../os/hal/osal/rt/osal.h ****  *          context.
 742:../../../os/hal/osal/rt/osal.h ****  *
 743:../../../os/hal/osal/rt/osal.h ****  * @param[in] trp       a pointer to a thread reference object
 744:../../../os/hal/osal/rt/osal.h ****  * @param[in] timeout   the timeout in system ticks, the special values are
 745:../../../os/hal/osal/rt/osal.h ****  *                      handled as follow:
 746:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 747:../../../os/hal/osal/rt/osal.h ****  *                        state.
 748:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_IMMEDIATE the thread is not enqueued and
 749:../../../os/hal/osal/rt/osal.h ****  *                        the function returns @p MSG_TIMEOUT as if a timeout
 750:../../../os/hal/osal/rt/osal.h ****  *                        occurred.
 751:../../../os/hal/osal/rt/osal.h ****  *                      .
 752:../../../os/hal/osal/rt/osal.h ****  * @return              The wake up message.
 753:../../../os/hal/osal/rt/osal.h ****  * @retval MSG_TIMEOUT  if the operation timed out.
 754:../../../os/hal/osal/rt/osal.h ****  *
 755:../../../os/hal/osal/rt/osal.h ****  * @sclass
 756:../../../os/hal/osal/rt/osal.h ****  */
 757:../../../os/hal/osal/rt/osal.h **** static inline msg_t osalThreadSuspendTimeoutS(thread_reference_t *trp,
 758:../../../os/hal/osal/rt/osal.h ****                                               sysinterval_t timeout) {
 759:../../../os/hal/osal/rt/osal.h **** 
 760:../../../os/hal/osal/rt/osal.h ****   return chThdSuspendTimeoutS(trp, timeout);
 761:../../../os/hal/osal/rt/osal.h **** }
 762:../../../os/hal/osal/rt/osal.h **** 
 763:../../../os/hal/osal/rt/osal.h **** /**
 764:../../../os/hal/osal/rt/osal.h ****  * @brief   Wakes up a thread waiting on a thread reference object.
 765:../../../os/hal/osal/rt/osal.h ****  * @note    This function must not reschedule because it can be called from
 766:../../../os/hal/osal/rt/osal.h ****  *          ISR context.
 767:../../../os/hal/osal/rt/osal.h ****  *
 768:../../../os/hal/osal/rt/osal.h ****  * @param[in] trp       a pointer to a thread reference object
 769:../../../os/hal/osal/rt/osal.h ****  * @param[in] msg       the message code
 770:../../../os/hal/osal/rt/osal.h ****  *
 771:../../../os/hal/osal/rt/osal.h ****  * @iclass
 772:../../../os/hal/osal/rt/osal.h ****  */
 773:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadResumeI(thread_reference_t *trp, msg_t msg) {
 774:../../../os/hal/osal/rt/osal.h **** 
 775:../../../os/hal/osal/rt/osal.h ****   chThdResumeI(trp, msg);
 776:../../../os/hal/osal/rt/osal.h **** }
 777:../../../os/hal/osal/rt/osal.h **** 
 778:../../../os/hal/osal/rt/osal.h **** /**
 779:../../../os/hal/osal/rt/osal.h ****  * @brief   Wakes up a thread waiting on a thread reference object.
 780:../../../os/hal/osal/rt/osal.h ****  * @note    This function must reschedule, it can only be called from thread
 781:../../../os/hal/osal/rt/osal.h ****  *          context.
 782:../../../os/hal/osal/rt/osal.h ****  *
 783:../../../os/hal/osal/rt/osal.h ****  * @param[in] trp       a pointer to a thread reference object
 784:../../../os/hal/osal/rt/osal.h ****  * @param[in] msg       the message code
 785:../../../os/hal/osal/rt/osal.h ****  *
 786:../../../os/hal/osal/rt/osal.h ****  * @iclass
 787:../../../os/hal/osal/rt/osal.h ****  */
 788:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadResumeS(thread_reference_t *trp, msg_t msg) {
 789:../../../os/hal/osal/rt/osal.h **** 
 790:../../../os/hal/osal/rt/osal.h ****   chThdResumeS(trp, msg);
 791:../../../os/hal/osal/rt/osal.h **** }
 792:../../../os/hal/osal/rt/osal.h **** 
 793:../../../os/hal/osal/rt/osal.h **** /**
 794:../../../os/hal/osal/rt/osal.h ****  * @brief   Initializes a threads queue object.
 795:../../../os/hal/osal/rt/osal.h ****  *
 796:../../../os/hal/osal/rt/osal.h ****  * @param[out] tqp      pointer to the threads queue object
 797:../../../os/hal/osal/rt/osal.h ****  *
 798:../../../os/hal/osal/rt/osal.h ****  * @init
 799:../../../os/hal/osal/rt/osal.h ****  */
 800:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadQueueObjectInit(threads_queue_t *tqp) {
 801:../../../os/hal/osal/rt/osal.h **** 
 802:../../../os/hal/osal/rt/osal.h ****   chThdQueueObjectInit(tqp);
 803:../../../os/hal/osal/rt/osal.h **** }
 804:../../../os/hal/osal/rt/osal.h **** 
 805:../../../os/hal/osal/rt/osal.h **** /**
 806:../../../os/hal/osal/rt/osal.h ****  * @brief   Enqueues the caller thread.
 807:../../../os/hal/osal/rt/osal.h ****  * @details The caller thread is enqueued and put to sleep until it is
 808:../../../os/hal/osal/rt/osal.h ****  *          dequeued or the specified timeouts expires.
 809:../../../os/hal/osal/rt/osal.h ****  *
 810:../../../os/hal/osal/rt/osal.h ****  * @param[in] tqp       pointer to the threads queue object
 811:../../../os/hal/osal/rt/osal.h ****  * @param[in] timeout   the timeout in system ticks, the special values are
 812:../../../os/hal/osal/rt/osal.h ****  *                      handled as follow:
 813:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 814:../../../os/hal/osal/rt/osal.h ****  *                        state.
 815:../../../os/hal/osal/rt/osal.h ****  *                      - @a TIME_IMMEDIATE the thread is not enqueued and
 816:../../../os/hal/osal/rt/osal.h ****  *                        the function returns @p MSG_TIMEOUT as if a timeout
 817:../../../os/hal/osal/rt/osal.h ****  *                        occurred.
 818:../../../os/hal/osal/rt/osal.h ****  *                      .
 819:../../../os/hal/osal/rt/osal.h ****  * @return              The message from @p osalQueueWakeupOneI() or
 820:../../../os/hal/osal/rt/osal.h ****  *                      @p osalQueueWakeupAllI() functions.
 821:../../../os/hal/osal/rt/osal.h ****  * @retval MSG_TIMEOUT  if the thread has not been dequeued within the
 822:../../../os/hal/osal/rt/osal.h ****  *                      specified timeout or if the function has been
 823:../../../os/hal/osal/rt/osal.h ****  *                      invoked with @p TIME_IMMEDIATE as timeout
 824:../../../os/hal/osal/rt/osal.h ****  *                      specification.
 825:../../../os/hal/osal/rt/osal.h ****  *
 826:../../../os/hal/osal/rt/osal.h ****  * @sclass
 827:../../../os/hal/osal/rt/osal.h ****  */
 828:../../../os/hal/osal/rt/osal.h **** static inline msg_t osalThreadEnqueueTimeoutS(threads_queue_t *tqp,
 829:../../../os/hal/osal/rt/osal.h ****                                               sysinterval_t timeout) {
 830:../../../os/hal/osal/rt/osal.h **** 
 831:../../../os/hal/osal/rt/osal.h ****   return chThdEnqueueTimeoutS(tqp, timeout);
 832:../../../os/hal/osal/rt/osal.h **** }
 833:../../../os/hal/osal/rt/osal.h **** 
 834:../../../os/hal/osal/rt/osal.h **** /**
 835:../../../os/hal/osal/rt/osal.h ****  * @brief   Dequeues and wakes up one thread from the queue, if any.
 836:../../../os/hal/osal/rt/osal.h ****  *
 837:../../../os/hal/osal/rt/osal.h ****  * @param[in] tqp       pointer to the threads queue object
 838:../../../os/hal/osal/rt/osal.h ****  * @param[in] msg       the message code
 839:../../../os/hal/osal/rt/osal.h ****  *
 840:../../../os/hal/osal/rt/osal.h ****  * @iclass
 841:../../../os/hal/osal/rt/osal.h ****  */
 842:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadDequeueNextI(threads_queue_t *tqp, msg_t msg) {
 843:../../../os/hal/osal/rt/osal.h **** 
 844:../../../os/hal/osal/rt/osal.h ****   chThdDequeueNextI(tqp, msg);
 845:../../../os/hal/osal/rt/osal.h **** }
 846:../../../os/hal/osal/rt/osal.h **** 
 847:../../../os/hal/osal/rt/osal.h **** /**
 848:../../../os/hal/osal/rt/osal.h ****  * @brief   Dequeues and wakes up all threads from the queue.
 849:../../../os/hal/osal/rt/osal.h ****  *
 850:../../../os/hal/osal/rt/osal.h ****  * @param[in] tqp       pointer to the threads queue object
 851:../../../os/hal/osal/rt/osal.h ****  * @param[in] msg       the message code
 852:../../../os/hal/osal/rt/osal.h ****  *
 853:../../../os/hal/osal/rt/osal.h ****  * @iclass
 854:../../../os/hal/osal/rt/osal.h ****  */
 855:../../../os/hal/osal/rt/osal.h **** static inline void osalThreadDequeueAllI(threads_queue_t *tqp, msg_t msg) {
 856:../../../os/hal/osal/rt/osal.h **** 
 857:../../../os/hal/osal/rt/osal.h ****   chThdDequeueAllI(tqp, msg);
 163               		.loc 3 857 0
 164 001a 6EEF      		ldi r22,lo8(-2)
 165 001c 7FEF      		ldi r23,lo8(-1)
 166 001e CF01      		movw r24,r30
 167 0020 0C94 0000 		jmp chThdDequeueAllI
 168               	.LVL11:
 169               	.LBE259:
 170               	.LBE258:
 171               		.cfi_endproc
 172               	.LFE169:
 174               		.section	.text.ibqGetEmptyBufferI,"ax",@progbits
 175               	.global	ibqGetEmptyBufferI
 177               	ibqGetEmptyBufferI:
 178               	.LFB170:
 116:../../../os/hal/src/hal_buffers.c ****   osalThreadDequeueAllI(&ibqp->waiting, MSG_RESET);
 117:../../../os/hal/src/hal_buffers.c **** }
 118:../../../os/hal/src/hal_buffers.c **** 
 119:../../../os/hal/src/hal_buffers.c **** /**
 120:../../../os/hal/src/hal_buffers.c ****  * @brief   Gets the next empty buffer from the queue.
 121:../../../os/hal/src/hal_buffers.c ****  * @note    The function always returns the same buffer if called repeatedly.
 122:../../../os/hal/src/hal_buffers.c ****  *
 123:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 124:../../../os/hal/src/hal_buffers.c ****  * @return              A pointer to the next buffer to be filled.
 125:../../../os/hal/src/hal_buffers.c ****  * @retval NULL         if the queue is full.
 126:../../../os/hal/src/hal_buffers.c ****  *
 127:../../../os/hal/src/hal_buffers.c ****  * @iclass
 128:../../../os/hal/src/hal_buffers.c ****  */
 129:../../../os/hal/src/hal_buffers.c **** uint8_t *ibqGetEmptyBufferI(input_buffers_queue_t *ibqp) {
 179               		.loc 1 129 0
 180               		.cfi_startproc
 181               	.LVL12:
 182               	/* prologue: function */
 183               	/* frame size = 0 */
 184               	/* stack size = 0 */
 185               	.L__stack_usage = 0
 186 0000 FC01      		movw r30,r24
 130:../../../os/hal/src/hal_buffers.c **** 
 131:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 132:../../../os/hal/src/hal_buffers.c **** 
 133:../../../os/hal/src/hal_buffers.c ****   if (ibqIsFullI(ibqp)) {
 187               		.loc 1 133 0
 188 0002 2781      		ldd r18,Z+7
 189 0004 3085      		ldd r19,Z+8
 190 0006 8185      		ldd r24,Z+9
 191 0008 9285      		ldd r25,Z+10
 192               	.LVL13:
 193 000a 2817      		cp r18,r24
 194 000c 3907      		cpc r19,r25
 195 000e 01F0      		breq .L11
 196               	.L4:
 134:../../../os/hal/src/hal_buffers.c ****     return NULL;
 135:../../../os/hal/src/hal_buffers.c ****   }
 136:../../../os/hal/src/hal_buffers.c **** 
 137:../../../os/hal/src/hal_buffers.c ****   return ibqp->bwrptr + sizeof (size_t);
 197               		.loc 1 137 0
 198 0010 C901      		movw r24,r18
 199 0012 0296      		adiw r24,2
 138:../../../os/hal/src/hal_buffers.c **** }
 200               		.loc 1 138 0
 201 0014 0895      		ret
 202               	.L11:
 133:../../../os/hal/src/hal_buffers.c ****     return NULL;
 203               		.loc 1 133 0 discriminator 1
 204 0016 8581      		ldd r24,Z+5
 205 0018 9681      		ldd r25,Z+6
 206 001a 892B      		or r24,r25
 207 001c 01F0      		breq .L4
 134:../../../os/hal/src/hal_buffers.c ****     return NULL;
 208               		.loc 1 134 0
 209 001e 80E0      		ldi r24,0
 210 0020 90E0      		ldi r25,0
 211 0022 0895      		ret
 212               		.cfi_endproc
 213               	.LFE170:
 215               		.section	.text.ibqPostFullBufferI,"ax",@progbits
 216               	.global	ibqPostFullBufferI
 218               	ibqPostFullBufferI:
 219               	.LFB171:
 139:../../../os/hal/src/hal_buffers.c **** 
 140:../../../os/hal/src/hal_buffers.c **** /**
 141:../../../os/hal/src/hal_buffers.c ****  * @brief   Posts a new filled buffer to the queue.
 142:../../../os/hal/src/hal_buffers.c ****  *
 143:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 144:../../../os/hal/src/hal_buffers.c ****  * @param[in] size      used size of the buffer, cannot be zero
 145:../../../os/hal/src/hal_buffers.c ****  *
 146:../../../os/hal/src/hal_buffers.c ****  * @iclass
 147:../../../os/hal/src/hal_buffers.c ****  */
 148:../../../os/hal/src/hal_buffers.c **** void ibqPostFullBufferI(input_buffers_queue_t *ibqp, size_t size) {
 220               		.loc 1 148 0
 221               		.cfi_startproc
 222               	.LVL14:
 223               	/* prologue: function */
 224               	/* frame size = 0 */
 225               	/* stack size = 0 */
 226               	.L__stack_usage = 0
 227 0000 FC01      		movw r30,r24
 149:../../../os/hal/src/hal_buffers.c **** 
 150:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 151:../../../os/hal/src/hal_buffers.c **** 
 152:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck((size > 0U) && (size <= (ibqp->bsize - sizeof (size_t))));
 153:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!ibqIsFullI(ibqp), "buffers queue full");
 154:../../../os/hal/src/hal_buffers.c **** 
 155:../../../os/hal/src/hal_buffers.c ****   /* Writing size field in the buffer.*/
 156:../../../os/hal/src/hal_buffers.c ****   *((size_t *)ibqp->bwrptr) = size;
 228               		.loc 1 156 0
 229 0002 A781      		ldd r26,Z+7
 230 0004 B085      		ldd r27,Z+8
 231 0006 1196      		adiw r26,1
 232 0008 7C93      		st X,r23
 233 000a 6E93      		st -X,r22
 157:../../../os/hal/src/hal_buffers.c **** 
 158:../../../os/hal/src/hal_buffers.c ****   /* Posting the buffer in the queue.*/
 159:../../../os/hal/src/hal_buffers.c ****   ibqp->bcounter++;
 234               		.loc 1 159 0
 235 000c 2581      		ldd r18,Z+5
 236 000e 3681      		ldd r19,Z+6
 237 0010 2F5F      		subi r18,-1
 238 0012 3F4F      		sbci r19,-1
 239 0014 3683      		std Z+6,r19
 240 0016 2583      		std Z+5,r18
 160:../../../os/hal/src/hal_buffers.c ****   ibqp->bwrptr += ibqp->bsize;
 241               		.loc 1 160 0
 242 0018 8585      		ldd r24,Z+13
 243 001a 9685      		ldd r25,Z+14
 244               	.LVL15:
 245 001c 8A0F      		add r24,r26
 246 001e 9B1F      		adc r25,r27
 247 0020 9087      		std Z+8,r25
 248 0022 8783      		std Z+7,r24
 161:../../../os/hal/src/hal_buffers.c ****   if (ibqp->bwrptr >= ibqp->btop) {
 249               		.loc 1 161 0
 250 0024 2385      		ldd r18,Z+11
 251 0026 3485      		ldd r19,Z+12
 252 0028 8217      		cp r24,r18
 253 002a 9307      		cpc r25,r19
 254 002c 00F0      		brlo .L13
 162:../../../os/hal/src/hal_buffers.c ****     ibqp->bwrptr = ibqp->buffers;
 255               		.loc 1 162 0
 256 002e 8189      		ldd r24,Z+17
 257 0030 9289      		ldd r25,Z+18
 258 0032 9087      		std Z+8,r25
 259 0034 8783      		std Z+7,r24
 260               	.L13:
 261               	.LVL16:
 262               	.LBB260:
 263               	.LBB261:
 844:../../../os/hal/osal/rt/osal.h **** }
 264               		.loc 3 844 0
 265 0036 60E0      		ldi r22,0
 266 0038 70E0      		ldi r23,0
 267               	.LVL17:
 268 003a CF01      		movw r24,r30
 269 003c 0C94 0000 		jmp chThdDequeueNextI
 270               	.LVL18:
 271               	.LBE261:
 272               	.LBE260:
 273               		.cfi_endproc
 274               	.LFE171:
 276               		.section	.text.ibqGetFullBufferTimeoutS,"ax",@progbits
 277               	.global	ibqGetFullBufferTimeoutS
 279               	ibqGetFullBufferTimeoutS:
 280               	.LFB173:
 163:../../../os/hal/src/hal_buffers.c ****   }
 164:../../../os/hal/src/hal_buffers.c **** 
 165:../../../os/hal/src/hal_buffers.c ****   /* Waking up one waiting thread, if any.*/
 166:../../../os/hal/src/hal_buffers.c ****   osalThreadDequeueNextI(&ibqp->waiting, MSG_OK);
 167:../../../os/hal/src/hal_buffers.c **** }
 168:../../../os/hal/src/hal_buffers.c **** 
 169:../../../os/hal/src/hal_buffers.c **** /**
 170:../../../os/hal/src/hal_buffers.c ****  * @brief   Gets the next filled buffer from the queue.
 171:../../../os/hal/src/hal_buffers.c ****  * @note    The function always acquires the same buffer if called repeatedly.
 172:../../../os/hal/src/hal_buffers.c ****  * @post    After calling the function the fields @p ptr and @p top are set
 173:../../../os/hal/src/hal_buffers.c ****  *          at beginning and end of the buffer data or @p NULL if the queue
 174:../../../os/hal/src/hal_buffers.c ****  *          is empty.
 175:../../../os/hal/src/hal_buffers.c ****  *
 176:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 177:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 178:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 179:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 180:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 181:../../../os/hal/src/hal_buffers.c ****  *                      .
 182:../../../os/hal/src/hal_buffers.c ****  * @return              The operation status.
 183:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_OK       if a buffer has been acquired.
 184:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_TIMEOUT  if the specified time expired.
 185:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_RESET    if the queue has been reset or has been put in
 186:../../../os/hal/src/hal_buffers.c ****  *                      suspended state.
 187:../../../os/hal/src/hal_buffers.c ****  *
 188:../../../os/hal/src/hal_buffers.c ****  * @api
 189:../../../os/hal/src/hal_buffers.c ****  */
 190:../../../os/hal/src/hal_buffers.c **** msg_t ibqGetFullBufferTimeout(input_buffers_queue_t *ibqp,
 191:../../../os/hal/src/hal_buffers.c ****                               sysinterval_t timeout) {
 192:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 193:../../../os/hal/src/hal_buffers.c **** 
 194:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 195:../../../os/hal/src/hal_buffers.c ****   msg = ibqGetFullBufferTimeoutS(ibqp, timeout);
 196:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 197:../../../os/hal/src/hal_buffers.c **** 
 198:../../../os/hal/src/hal_buffers.c ****   return msg;
 199:../../../os/hal/src/hal_buffers.c **** }
 200:../../../os/hal/src/hal_buffers.c **** 
 201:../../../os/hal/src/hal_buffers.c ****   /**
 202:../../../os/hal/src/hal_buffers.c ****    * @brief   Gets the next filled buffer from the queue.
 203:../../../os/hal/src/hal_buffers.c ****    * @note    The function always acquires the same buffer if called repeatedly.
 204:../../../os/hal/src/hal_buffers.c ****    * @post    After calling the function the fields @p ptr and @p top are set
 205:../../../os/hal/src/hal_buffers.c ****    *          at beginning and end of the buffer data or @p NULL if the queue
 206:../../../os/hal/src/hal_buffers.c ****    *          is empty.
 207:../../../os/hal/src/hal_buffers.c ****    *
 208:../../../os/hal/src/hal_buffers.c ****    * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 209:../../../os/hal/src/hal_buffers.c ****    * @param[in] timeout   the number of ticks before the operation timeouts,
 210:../../../os/hal/src/hal_buffers.c ****    *                      the following special values are allowed:
 211:../../../os/hal/src/hal_buffers.c ****    *                      - @a TIME_IMMEDIATE immediate timeout.
 212:../../../os/hal/src/hal_buffers.c ****    *                      - @a TIME_INFINITE no timeout.
 213:../../../os/hal/src/hal_buffers.c ****    *                      .
 214:../../../os/hal/src/hal_buffers.c ****    * @return              The operation status.
 215:../../../os/hal/src/hal_buffers.c ****    * @retval MSG_OK       if a buffer has been acquired.
 216:../../../os/hal/src/hal_buffers.c ****    * @retval MSG_TIMEOUT  if the specified time expired.
 217:../../../os/hal/src/hal_buffers.c ****    * @retval MSG_RESET    if the queue has been reset or has been put in
 218:../../../os/hal/src/hal_buffers.c ****    *                      suspended state.
 219:../../../os/hal/src/hal_buffers.c ****    *
 220:../../../os/hal/src/hal_buffers.c ****    * @sclass
 221:../../../os/hal/src/hal_buffers.c ****    */
 222:../../../os/hal/src/hal_buffers.c ****   msg_t ibqGetFullBufferTimeoutS(input_buffers_queue_t *ibqp,
 223:../../../os/hal/src/hal_buffers.c ****                                  sysinterval_t timeout) {
 281               		.loc 1 223 0
 282               		.cfi_startproc
 283               	.LVL19:
 284 0000 0F93      		push r16
 285               	.LCFI6:
 286               		.cfi_def_cfa_offset 3
 287               		.cfi_offset 16, -2
 288 0002 1F93      		push r17
 289               	.LCFI7:
 290               		.cfi_def_cfa_offset 4
 291               		.cfi_offset 17, -3
 292 0004 CF93      		push r28
 293               	.LCFI8:
 294               		.cfi_def_cfa_offset 5
 295               		.cfi_offset 28, -4
 296 0006 DF93      		push r29
 297               	.LCFI9:
 298               		.cfi_def_cfa_offset 6
 299               		.cfi_offset 29, -5
 300               	/* prologue: function */
 301               	/* frame size = 0 */
 302               	/* stack size = 4 */
 303               	.L__stack_usage = 4
 304 0008 EC01      		movw r28,r24
 305 000a 8B01      		movw r16,r22
 224:../../../os/hal/src/hal_buffers.c **** 
 225:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassS();
 226:../../../os/hal/src/hal_buffers.c **** 
 227:../../../os/hal/src/hal_buffers.c ****   while (ibqIsEmptyI(ibqp)) {
 306               		.loc 1 227 0
 307 000c 00C0      		rjmp .L15
 308               	.LVL20:
 309               	.L17:
 310               	.LBB270:
 228:../../../os/hal/src/hal_buffers.c ****     if (ibqp->suspended) {
 311               		.loc 1 228 0
 312 000e 8C81      		ldd r24,Y+4
 313 0010 8111      		cpse r24,__zero_reg__
 314 0012 00C0      		rjmp .L18
 315               	.LVL21:
 316               	.LBB271:
 317               	.LBB272:
 831:../../../os/hal/osal/rt/osal.h **** }
 318               		.loc 3 831 0
 319 0014 B801      		movw r22,r16
 320 0016 CE01      		movw r24,r28
 321 0018 0E94 0000 		call chThdEnqueueTimeoutS
 322               	.LVL22:
 323               	.LBE272:
 324               	.LBE271:
 229:../../../os/hal/src/hal_buffers.c ****       return MSG_RESET;
 230:../../../os/hal/src/hal_buffers.c ****     }
 231:../../../os/hal/src/hal_buffers.c ****     msg_t msg = osalThreadEnqueueTimeoutS(&ibqp->waiting, timeout);
 232:../../../os/hal/src/hal_buffers.c ****     if (msg < MSG_OK) {
 325               		.loc 1 232 0
 326 001c 97FD      		sbrc r25,7
 327 001e 00C0      		rjmp .L16
 328               	.L15:
 329               	.LBE270:
 227:../../../os/hal/src/hal_buffers.c ****     if (ibqp->suspended) {
 330               		.loc 1 227 0
 331 0020 8D81      		ldd r24,Y+5
 332 0022 9E81      		ldd r25,Y+6
 333 0024 892B      		or r24,r25
 334 0026 01F0      		breq .L17
 335               	.LVL23:
 336               	.LBB273:
 337               	.LBB274:
 233:../../../os/hal/src/hal_buffers.c ****        return msg;
 234:../../../os/hal/src/hal_buffers.c ****     }
 235:../../../os/hal/src/hal_buffers.c ****   }
 236:../../../os/hal/src/hal_buffers.c **** 
 237:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!ibqIsEmptyI(ibqp), "still empty");
 238:../../../os/hal/src/hal_buffers.c **** 
 239:../../../os/hal/src/hal_buffers.c ****   /* Setting up the "current" buffer and its boundary.*/
 240:../../../os/hal/src/hal_buffers.c ****   ibqp->ptr = ibqp->brdptr + sizeof (size_t);
 338               		.loc 1 240 0
 339 0028 E985      		ldd r30,Y+9
 340 002a FA85      		ldd r31,Y+10
 341 002c 9F01      		movw r18,r30
 342 002e 2E5F      		subi r18,-2
 343 0030 3F4F      		sbci r19,-1
 344 0032 3C8B      		std Y+20,r19
 345 0034 2B8B      		std Y+19,r18
 241:../../../os/hal/src/hal_buffers.c ****   ibqp->top = ibqp->ptr + *((size_t *)ibqp->brdptr);
 346               		.loc 1 241 0
 347 0036 8081      		ld r24,Z
 348 0038 9181      		ldd r25,Z+1
 349 003a 820F      		add r24,r18
 350 003c 931F      		adc r25,r19
 351 003e 9E8B      		std Y+22,r25
 352 0040 8D8B      		std Y+21,r24
 353               	.LVL24:
 354 0042 80E0      		ldi r24,0
 355 0044 90E0      		ldi r25,0
 356               	.L16:
 357               	/* epilogue start */
 358               	.LBE274:
 359               	.LBE273:
 242:../../../os/hal/src/hal_buffers.c **** 
 243:../../../os/hal/src/hal_buffers.c ****   return MSG_OK;
 244:../../../os/hal/src/hal_buffers.c **** }
 360               		.loc 1 244 0
 361 0046 DF91      		pop r29
 362 0048 CF91      		pop r28
 363               	.LVL25:
 364 004a 1F91      		pop r17
 365 004c 0F91      		pop r16
 366               	.LVL26:
 367 004e 0895      		ret
 368               	.LVL27:
 369               	.L18:
 370               	.LBB275:
 229:../../../os/hal/src/hal_buffers.c ****     }
 371               		.loc 1 229 0
 372 0050 8EEF      		ldi r24,lo8(-2)
 373 0052 9FEF      		ldi r25,lo8(-1)
 374               	/* epilogue start */
 375               	.LBE275:
 376               		.loc 1 244 0
 377 0054 DF91      		pop r29
 378 0056 CF91      		pop r28
 379               	.LVL28:
 380 0058 1F91      		pop r17
 381 005a 0F91      		pop r16
 382               	.LVL29:
 383 005c 0895      		ret
 384               		.cfi_endproc
 385               	.LFE173:
 387               		.section	.text.ibqGetFullBufferTimeout,"ax",@progbits
 388               	.global	ibqGetFullBufferTimeout
 390               	ibqGetFullBufferTimeout:
 391               	.LFB172:
 191:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 392               		.loc 1 191 0
 393               		.cfi_startproc
 394               	.LVL30:
 395               	/* prologue: function */
 396               	/* frame size = 0 */
 397               	/* stack size = 0 */
 398               	.L__stack_usage = 0
 399               	.LBB276:
 400               	.LBB277:
 401               	.LBB278:
 402               	.LBB279:
 403               		.file 4 "../../../os/common/ports/AVR/chcore.h"
   1:../../../os/common/ports/AVR/chcore.h **** /*
   2:../../../os/common/ports/AVR/chcore.h ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio.
   3:../../../os/common/ports/AVR/chcore.h **** 
   4:../../../os/common/ports/AVR/chcore.h ****     This file is part of ChibiOS.
   5:../../../os/common/ports/AVR/chcore.h **** 
   6:../../../os/common/ports/AVR/chcore.h ****     ChibiOS is free software; you can redistribute it and/or modify
   7:../../../os/common/ports/AVR/chcore.h ****     it under the terms of the GNU General Public License as published by
   8:../../../os/common/ports/AVR/chcore.h ****     the Free Software Foundation; either version 3 of the License, or
   9:../../../os/common/ports/AVR/chcore.h ****     (at your option) any later version.
  10:../../../os/common/ports/AVR/chcore.h **** 
  11:../../../os/common/ports/AVR/chcore.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../../os/common/ports/AVR/chcore.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../../os/common/ports/AVR/chcore.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../../os/common/ports/AVR/chcore.h ****     GNU General Public License for more details.
  15:../../../os/common/ports/AVR/chcore.h **** 
  16:../../../os/common/ports/AVR/chcore.h ****     You should have received a copy of the GNU General Public License
  17:../../../os/common/ports/AVR/chcore.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../../os/common/ports/AVR/chcore.h **** */
  19:../../../os/common/ports/AVR/chcore.h **** 
  20:../../../os/common/ports/AVR/chcore.h **** /**
  21:../../../os/common/ports/AVR/chcore.h ****  * @file    templates/chcore.h
  22:../../../os/common/ports/AVR/chcore.h ****  * @brief   Port related template macros and structures.
  23:../../../os/common/ports/AVR/chcore.h ****  * @details This file is a template of the system driver macros provided by
  24:../../../os/common/ports/AVR/chcore.h ****  *          a port.
  25:../../../os/common/ports/AVR/chcore.h ****  *
  26:../../../os/common/ports/AVR/chcore.h ****  * @addtogroup core
  27:../../../os/common/ports/AVR/chcore.h ****  * @{
  28:../../../os/common/ports/AVR/chcore.h ****  */
  29:../../../os/common/ports/AVR/chcore.h **** 
  30:../../../os/common/ports/AVR/chcore.h **** #ifndef CHCORE_H
  31:../../../os/common/ports/AVR/chcore.h **** #define CHCORE_H
  32:../../../os/common/ports/AVR/chcore.h **** 
  33:../../../os/common/ports/AVR/chcore.h **** #include <avr/io.h>
  34:../../../os/common/ports/AVR/chcore.h **** #include <avr/interrupt.h>
  35:../../../os/common/ports/AVR/chcore.h **** 
  36:../../../os/common/ports/AVR/chcore.h **** extern bool __avr_in_isr;
  37:../../../os/common/ports/AVR/chcore.h **** 
  38:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
  39:../../../os/common/ports/AVR/chcore.h **** /* Module constants.                                                         */
  40:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
  41:../../../os/common/ports/AVR/chcore.h **** 
  42:../../../os/common/ports/AVR/chcore.h **** /**
  43:../../../os/common/ports/AVR/chcore.h ****  * @name    Port Capabilities and Constants
  44:../../../os/common/ports/AVR/chcore.h ****  * @{
  45:../../../os/common/ports/AVR/chcore.h ****  */
  46:../../../os/common/ports/AVR/chcore.h **** /**
  47:../../../os/common/ports/AVR/chcore.h ****  * @brief   This port supports a realtime counter.
  48:../../../os/common/ports/AVR/chcore.h ****  */
  49:../../../os/common/ports/AVR/chcore.h **** #define PORT_SUPPORTS_RT                FALSE
  50:../../../os/common/ports/AVR/chcore.h **** 
  51:../../../os/common/ports/AVR/chcore.h **** /**
  52:../../../os/common/ports/AVR/chcore.h ****  * @brief   Natural alignment constant.
  53:../../../os/common/ports/AVR/chcore.h ****  * @note    It is the minimum alignment for pointer-size variables.
  54:../../../os/common/ports/AVR/chcore.h ****  */
  55:../../../os/common/ports/AVR/chcore.h **** #define PORT_NATURAL_ALIGN              1U
  56:../../../os/common/ports/AVR/chcore.h **** 
  57:../../../os/common/ports/AVR/chcore.h **** /**
  58:../../../os/common/ports/AVR/chcore.h ****  * @brief   Stack alignment constant.
  59:../../../os/common/ports/AVR/chcore.h ****  * @note    It is the alignement required for the stack pointer.
  60:../../../os/common/ports/AVR/chcore.h ****  */
  61:../../../os/common/ports/AVR/chcore.h **** #define PORT_STACK_ALIGN                1U
  62:../../../os/common/ports/AVR/chcore.h **** 
  63:../../../os/common/ports/AVR/chcore.h **** /**
  64:../../../os/common/ports/AVR/chcore.h ****  * @brief   Working Areas alignment constant.
  65:../../../os/common/ports/AVR/chcore.h ****  * @note    It is the alignment to be enforced for thread working areas.
  66:../../../os/common/ports/AVR/chcore.h ****  */
  67:../../../os/common/ports/AVR/chcore.h **** #define PORT_WORKING_AREA_ALIGN         1U
  68:../../../os/common/ports/AVR/chcore.h **** /** @} */
  69:../../../os/common/ports/AVR/chcore.h **** 
  70:../../../os/common/ports/AVR/chcore.h **** /**
  71:../../../os/common/ports/AVR/chcore.h ****  * @name    Architecture and Compiler
  72:../../../os/common/ports/AVR/chcore.h ****  * @{
  73:../../../os/common/ports/AVR/chcore.h ****  */
  74:../../../os/common/ports/AVR/chcore.h **** /**
  75:../../../os/common/ports/AVR/chcore.h ****  * @brief   Macro defining an AVR architecture.
  76:../../../os/common/ports/AVR/chcore.h ****  */
  77:../../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_AVR
  78:../../../os/common/ports/AVR/chcore.h **** 
  79:../../../os/common/ports/AVR/chcore.h **** /**
  80:../../../os/common/ports/AVR/chcore.h ****  * @brief   Macro defining the specific AVR architecture.
  81:../../../os/common/ports/AVR/chcore.h ****  */
  82:../../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_AVR_MEGAAVR
  83:../../../os/common/ports/AVR/chcore.h **** 
  84:../../../os/common/ports/AVR/chcore.h **** /**
  85:../../../os/common/ports/AVR/chcore.h ****  * @brief   Name of the implemented architecture.
  86:../../../os/common/ports/AVR/chcore.h ****  */
  87:../../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_NAME          "MegaAVR"
  88:../../../os/common/ports/AVR/chcore.h **** 
  89:../../../os/common/ports/AVR/chcore.h **** /**
  90:../../../os/common/ports/AVR/chcore.h ****  * @brief   Compiler name and version.
  91:../../../os/common/ports/AVR/chcore.h ****  */
  92:../../../os/common/ports/AVR/chcore.h **** #if defined(__GNUC__) || defined(__DOXYGEN__)
  93:../../../os/common/ports/AVR/chcore.h **** #define PORT_COMPILER_NAME              "GCC " __VERSION__
  94:../../../os/common/ports/AVR/chcore.h **** 
  95:../../../os/common/ports/AVR/chcore.h **** #else
  96:../../../os/common/ports/AVR/chcore.h **** #error "unsupported compiler"
  97:../../../os/common/ports/AVR/chcore.h **** #endif
  98:../../../os/common/ports/AVR/chcore.h **** 
  99:../../../os/common/ports/AVR/chcore.h **** /**
 100:../../../os/common/ports/AVR/chcore.h ****  * @brief   Port-specific information string.
 101:../../../os/common/ports/AVR/chcore.h ****  */
 102:../../../os/common/ports/AVR/chcore.h **** #define PORT_INFO                       "None"
 103:../../../os/common/ports/AVR/chcore.h **** /** @} */
 104:../../../os/common/ports/AVR/chcore.h **** 
 105:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 106:../../../os/common/ports/AVR/chcore.h **** /* Module pre-compile time settings.                                         */
 107:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 108:../../../os/common/ports/AVR/chcore.h **** 
 109:../../../os/common/ports/AVR/chcore.h **** /**
 110:../../../os/common/ports/AVR/chcore.h ****  * @brief   Stack size for the system idle thread.
 111:../../../os/common/ports/AVR/chcore.h ****  * @details This size depends on the idle thread implementation, usually
 112:../../../os/common/ports/AVR/chcore.h ****  *          the idle thread should take no more space than those reserved
 113:../../../os/common/ports/AVR/chcore.h ****  *          by @p PORT_INT_REQUIRED_STACK.
 114:../../../os/common/ports/AVR/chcore.h ****  */
 115:../../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_IDLE_THREAD_STACK_SIZE) || defined(__DOXYGEN__)
 116:../../../os/common/ports/AVR/chcore.h **** #define PORT_IDLE_THREAD_STACK_SIZE     8
 117:../../../os/common/ports/AVR/chcore.h **** #endif
 118:../../../os/common/ports/AVR/chcore.h **** 
 119:../../../os/common/ports/AVR/chcore.h **** /**
 120:../../../os/common/ports/AVR/chcore.h ****  * @brief   Per-thread stack overhead for interrupts servicing.
 121:../../../os/common/ports/AVR/chcore.h ****  * @details This constant is used in the calculation of the correct working
 122:../../../os/common/ports/AVR/chcore.h ****  *          area size.
 123:../../../os/common/ports/AVR/chcore.h ****  */
 124:../../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_INT_REQUIRED_STACK) || defined(__DOXYGEN__)
 125:../../../os/common/ports/AVR/chcore.h **** #define PORT_INT_REQUIRED_STACK         32
 126:../../../os/common/ports/AVR/chcore.h **** #endif
 127:../../../os/common/ports/AVR/chcore.h **** 
 128:../../../os/common/ports/AVR/chcore.h **** /**
 129:../../../os/common/ports/AVR/chcore.h ****  * @brief   Enables an alternative timer implementation.
 130:../../../os/common/ports/AVR/chcore.h ****  * @details Usually the port uses a timer interface defined in the file
 131:../../../os/common/ports/AVR/chcore.h ****  *          @p chcore_timer.h, if this option is enabled then the file
 132:../../../os/common/ports/AVR/chcore.h ****  *          @p chcore_timer_alt.h is included instead.
 133:../../../os/common/ports/AVR/chcore.h ****  */
 134:../../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_USE_ALT_TIMER) || defined(__DOXYGEN__)
 135:../../../os/common/ports/AVR/chcore.h **** #define PORT_USE_ALT_TIMER              FALSE
 136:../../../os/common/ports/AVR/chcore.h **** #endif
 137:../../../os/common/ports/AVR/chcore.h **** 
 138:../../../os/common/ports/AVR/chcore.h **** /**
 139:../../../os/common/ports/AVR/chcore.h ****  * @brief   Enables a "wait for interrupt" instruction in the idle loop.
 140:../../../os/common/ports/AVR/chcore.h ****  */
 141:../../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_AVR_WFI_SLEEP_IDLE) || defined(__DOXYGEN__)
 142:../../../os/common/ports/AVR/chcore.h **** #define PORT_AVR_WFI_SLEEP_IDLE      FALSE
 143:../../../os/common/ports/AVR/chcore.h **** #endif
 144:../../../os/common/ports/AVR/chcore.h **** 
 145:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 146:../../../os/common/ports/AVR/chcore.h **** /* Derived constants and error checks.                                       */
 147:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 148:../../../os/common/ports/AVR/chcore.h **** 
 149:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 150:../../../os/common/ports/AVR/chcore.h **** /* Module data structures and types.                                         */
 151:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 152:../../../os/common/ports/AVR/chcore.h **** 
 153:../../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 154:../../../os/common/ports/AVR/chcore.h ****    asm module.*/
 155:../../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 156:../../../os/common/ports/AVR/chcore.h **** 
 157:../../../os/common/ports/AVR/chcore.h **** /**
 158:../../../os/common/ports/AVR/chcore.h ****  * @brief   Type of stack and memory alignment enforcement.
 159:../../../os/common/ports/AVR/chcore.h ****  * @note    In this architecture the stack alignment is enforced to 8 bits.
 160:../../../os/common/ports/AVR/chcore.h ****  */
 161:../../../os/common/ports/AVR/chcore.h **** typedef uint8_t stkalign_t;
 162:../../../os/common/ports/AVR/chcore.h **** 
 163:../../../os/common/ports/AVR/chcore.h **** /**
 164:../../../os/common/ports/AVR/chcore.h ****  * @brief   Interrupt saved context.
 165:../../../os/common/ports/AVR/chcore.h ****  * @details This structure represents the stack frame saved during a
 166:../../../os/common/ports/AVR/chcore.h ****  *          preemption-capable interrupt handler.
 167:../../../os/common/ports/AVR/chcore.h ****  * @note    R2 and R13 are not saved because those are assumed to be immutable
 168:../../../os/common/ports/AVR/chcore.h ****  *          during the system life cycle.
 169:../../../os/common/ports/AVR/chcore.h ****  */
 170:../../../os/common/ports/AVR/chcore.h **** struct port_extctx {
 171:../../../os/common/ports/AVR/chcore.h ****   uint8_t       _next;
 172:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r31;
 173:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r30;
 174:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r27;
 175:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r26;
 176:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r25;
 177:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r24;
 178:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r23;
 179:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r22;
 180:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r21;
 181:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r20;
 182:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r19;
 183:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r18;
 184:../../../os/common/ports/AVR/chcore.h ****   uint8_t       sr;
 185:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r1;
 186:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r0;
 187:../../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__)
 188:../../../os/common/ports/AVR/chcore.h ****   uint8_t       pcx;
 189:../../../os/common/ports/AVR/chcore.h **** #endif
 190:../../../os/common/ports/AVR/chcore.h ****   uint16_t      pc;
 191:../../../os/common/ports/AVR/chcore.h **** };
 192:../../../os/common/ports/AVR/chcore.h **** 
 193:../../../os/common/ports/AVR/chcore.h **** /**
 194:../../../os/common/ports/AVR/chcore.h ****  * @brief   System saved context.
 195:../../../os/common/ports/AVR/chcore.h ****  * @details This structure represents the inner stack frame during a context
 196:../../../os/common/ports/AVR/chcore.h ****  *          switching.
 197:../../../os/common/ports/AVR/chcore.h ****  * @note    R2 and R13 are not saved because those are assumed to be immutable
 198:../../../os/common/ports/AVR/chcore.h ****  *          during the system life cycle.
 199:../../../os/common/ports/AVR/chcore.h ****  * @note    LR is stored in the caller context so it is not present in this
 200:../../../os/common/ports/AVR/chcore.h ****  *          structure.
 201:../../../os/common/ports/AVR/chcore.h ****  */
 202:../../../os/common/ports/AVR/chcore.h **** struct port_intctx {
 203:../../../os/common/ports/AVR/chcore.h ****   uint8_t       _next;
 204:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r29;
 205:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r28;
 206:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r17;
 207:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r16;
 208:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r15;
 209:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r14;
 210:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r13;
 211:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r12;
 212:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r11;
 213:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r10;
 214:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r9;
 215:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r8;
 216:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r7;
 217:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r6;
 218:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r5;
 219:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r4;
 220:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r3;
 221:../../../os/common/ports/AVR/chcore.h ****   uint8_t       r2;
 222:../../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__)
 223:../../../os/common/ports/AVR/chcore.h ****   uint8_t       pcx;
 224:../../../os/common/ports/AVR/chcore.h **** #endif
 225:../../../os/common/ports/AVR/chcore.h ****   uint8_t       pcl;
 226:../../../os/common/ports/AVR/chcore.h ****   uint8_t       pch;
 227:../../../os/common/ports/AVR/chcore.h **** };
 228:../../../os/common/ports/AVR/chcore.h **** 
 229:../../../os/common/ports/AVR/chcore.h **** /**
 230:../../../os/common/ports/AVR/chcore.h ****  * @brief   Platform dependent part of the @p thread_t structure.
 231:../../../os/common/ports/AVR/chcore.h ****  * @details This structure usually contains just the saved stack pointer
 232:../../../os/common/ports/AVR/chcore.h ****  *          defined as a pointer to a @p port_intctx structure.
 233:../../../os/common/ports/AVR/chcore.h ****  */
 234:../../../os/common/ports/AVR/chcore.h **** struct port_context {
 235:../../../os/common/ports/AVR/chcore.h ****   struct port_intctx *sp;
 236:../../../os/common/ports/AVR/chcore.h **** };
 237:../../../os/common/ports/AVR/chcore.h **** 
 238:../../../os/common/ports/AVR/chcore.h **** #endif /* !defined(_FROM_ASM_) */
 239:../../../os/common/ports/AVR/chcore.h **** 
 240:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 241:../../../os/common/ports/AVR/chcore.h **** /* Module macros.                                                            */
 242:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 243:../../../os/common/ports/AVR/chcore.h **** 
 244:../../../os/common/ports/AVR/chcore.h **** /**
 245:../../../os/common/ports/AVR/chcore.h ****  * @brief   Platform dependent part of the @p chThdCreateI() API.
 246:../../../os/common/ports/AVR/chcore.h ****  * @details This code usually setup the context switching frame represented
 247:../../../os/common/ports/AVR/chcore.h ****  *          by an @p port_intctx structure.
 248:../../../os/common/ports/AVR/chcore.h ****  */
 249:../../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__) || defined(__DOXYGEN__)
 250:../../../os/common/ports/AVR/chcore.h **** #define PORT_SETUP_CONTEXT(tp, wbase, wtop, pf, arg) {                      \
 251:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp = (struct port_intctx *)((uint8_t *)(wtop) -                   \
 252:../../../os/common/ports/AVR/chcore.h ****                                       sizeof(struct port_intctx));          \
 253:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r2  = (uint8_t)(0xff & (uint16_t)pf);                         \
 254:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r3  = (uint8_t)((uint16_t)(pf) >> 8);                         \
 255:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r4  = (uint8_t)(0xff & (uint16_t)arg);                        \
 256:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r5  = (uint8_t)((uint16_t)(arg) >> 8);                        \
 257:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcx = (uint8_t)0;                                             \
 258:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcl = (uint16_t)_port_thread_start >> 8;                      \
 259:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pch = (uint8_t)(0xff & (uint16_t)_port_thread_start);         \
 260:../../../os/common/ports/AVR/chcore.h **** }
 261:../../../os/common/ports/AVR/chcore.h **** #else /* !__AVR_3_BYTE_PC__ */
 262:../../../os/common/ports/AVR/chcore.h **** #define PORT_SETUP_CONTEXT(tp, wbase, wtop, pf, arg) {                      \
 263:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp = (struct port_intctx *)((uint8_t *)(wtop) -                   \
 264:../../../os/common/ports/AVR/chcore.h ****                                       sizeof(struct port_intctx));          \
 265:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r2  = (uint8_t)(0xff & (uint16_t)pf);                         \
 266:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r3  = (uint8_t)((uint16_t)(pf) >> 8);                         \
 267:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r4  = (uint8_t)(0xff & (uint16_t)arg);                        \
 268:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r5  = (uint8_t)((uint16_t)(arg) >> 8);                        \
 269:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcl = (uint16_t)_port_thread_start >> 8;                      \
 270:../../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pch = (uint8_t)(0xff & (uint16_t)_port_thread_start);         \
 271:../../../os/common/ports/AVR/chcore.h **** }
 272:../../../os/common/ports/AVR/chcore.h **** #endif /* !__AVR_3_BYTE_PC__ */
 273:../../../os/common/ports/AVR/chcore.h **** 
 274:../../../os/common/ports/AVR/chcore.h **** /**
 275:../../../os/common/ports/AVR/chcore.h ****  * @brief   Computes the thread working area global size.
 276:../../../os/common/ports/AVR/chcore.h ****  * @note    There is no need to perform alignments in this macro.
 277:../../../os/common/ports/AVR/chcore.h ****  */
 278:../../../os/common/ports/AVR/chcore.h **** #define PORT_WA_SIZE(n) ((sizeof(struct port_intctx) - 1) +                \
 279:../../../os/common/ports/AVR/chcore.h ****                          (sizeof(struct port_extctx) - 1) +                \
 280:../../../os/common/ports/AVR/chcore.h ****                          ((size_t)(n)) + ((size_t)(PORT_INT_REQUIRED_STACK)))
 281:../../../os/common/ports/AVR/chcore.h **** 
 282:../../../os/common/ports/AVR/chcore.h **** /**
 283:../../../os/common/ports/AVR/chcore.h ****  * @brief   Static working area allocation.
 284:../../../os/common/ports/AVR/chcore.h ****  * @details This macro is used to allocate a static thread working area
 285:../../../os/common/ports/AVR/chcore.h ****  *          aligned as both position and size.
 286:../../../os/common/ports/AVR/chcore.h ****  *
 287:../../../os/common/ports/AVR/chcore.h ****  * @param[in] s         the name to be assigned to the stack array
 288:../../../os/common/ports/AVR/chcore.h ****  * @param[in] n         the stack size to be assigned to the thread
 289:../../../os/common/ports/AVR/chcore.h ****  */
 290:../../../os/common/ports/AVR/chcore.h **** #define PORT_WORKING_AREA(s, n)                                             \
 291:../../../os/common/ports/AVR/chcore.h ****   stkalign_t s[THD_WORKING_AREA_SIZE(n) / sizeof (stkalign_t)]
 292:../../../os/common/ports/AVR/chcore.h **** 
 293:../../../os/common/ports/AVR/chcore.h **** /**
 294:../../../os/common/ports/AVR/chcore.h ****  * @brief   Priority level verification macro.
 295:../../../os/common/ports/AVR/chcore.h ****  */
 296:../../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_IS_VALID_PRIORITY(n) false
 297:../../../os/common/ports/AVR/chcore.h **** 
 298:../../../os/common/ports/AVR/chcore.h **** /**
 299:../../../os/common/ports/AVR/chcore.h ****  * @brief   Priority level verification macro.
 300:../../../os/common/ports/AVR/chcore.h ****  */
 301:../../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_IS_VALID_KERNEL_PRIORITY(n) false
 302:../../../os/common/ports/AVR/chcore.h **** 
 303:../../../os/common/ports/AVR/chcore.h **** /**
 304:../../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ prologue code.
 305:../../../os/common/ports/AVR/chcore.h ****  * @details This macro must be inserted at the start of all IRQ handlers
 306:../../../os/common/ports/AVR/chcore.h ****  *          enabled to invoke system APIs.
 307:../../../os/common/ports/AVR/chcore.h ****  * @note    This code tricks the compiler to save all the specified registers
 308:../../../os/common/ports/AVR/chcore.h ****  *          by "touching" them.
 309:../../../os/common/ports/AVR/chcore.h ****  */
 310:../../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_PROLOGUE() {                                               \
 311:../../../os/common/ports/AVR/chcore.h ****   asm ("" : : : "r18", "r19", "r20", "r21", "r22", "r23", "r24",            \
 312:../../../os/common/ports/AVR/chcore.h ****                 "r25", "r26", "r27", "r30", "r31");                         \
 313:../../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = true;                                                      \
 314:../../../os/common/ports/AVR/chcore.h **** }
 315:../../../os/common/ports/AVR/chcore.h **** 
 316:../../../os/common/ports/AVR/chcore.h **** /**
 317:../../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ epilogue code.
 318:../../../os/common/ports/AVR/chcore.h ****  * @details This macro must be inserted at the end of all IRQ handlers
 319:../../../os/common/ports/AVR/chcore.h ****  *          enabled to invoke system APIs.
 320:../../../os/common/ports/AVR/chcore.h ****  */
 321:../../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_EPILOGUE() {                                               \
 322:../../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = false;                                                     \
 323:../../../os/common/ports/AVR/chcore.h ****   _dbg_check_lock();                                                        \
 324:../../../os/common/ports/AVR/chcore.h ****   if (chSchIsPreemptionRequired())                                          \
 325:../../../os/common/ports/AVR/chcore.h ****     chSchDoReschedule();                                                    \
 326:../../../os/common/ports/AVR/chcore.h ****   _dbg_check_unlock();                                                      \
 327:../../../os/common/ports/AVR/chcore.h **** }
 328:../../../os/common/ports/AVR/chcore.h **** 
 329:../../../os/common/ports/AVR/chcore.h **** /**
 330:../../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ handler function declaration.
 331:../../../os/common/ports/AVR/chcore.h ****  * @note    @p id can be a function name or a vector number depending on the
 332:../../../os/common/ports/AVR/chcore.h ****  *          port implementation.
 333:../../../os/common/ports/AVR/chcore.h ****  */
 334:../../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_HANDLER(id) ISR(id)
 335:../../../os/common/ports/AVR/chcore.h **** 
 336:../../../os/common/ports/AVR/chcore.h **** /**
 337:../../../os/common/ports/AVR/chcore.h ****  * @brief   Fast IRQ handler function declaration.
 338:../../../os/common/ports/AVR/chcore.h ****  * @note    @p id can be a function name or a vector number depending on the
 339:../../../os/common/ports/AVR/chcore.h ****  *          port implementation.
 340:../../../os/common/ports/AVR/chcore.h ****  */
 341:../../../os/common/ports/AVR/chcore.h **** #define PORT_FAST_IRQ_HANDLER(id) ISR(id)
 342:../../../os/common/ports/AVR/chcore.h **** 
 343:../../../os/common/ports/AVR/chcore.h **** /**
 344:../../../os/common/ports/AVR/chcore.h ****  * @brief   Performs a context switch between two threads.
 345:../../../os/common/ports/AVR/chcore.h ****  * @details This is the most critical code in any port, this function
 346:../../../os/common/ports/AVR/chcore.h ****  *          is responsible for the context switch between 2 threads.
 347:../../../os/common/ports/AVR/chcore.h ****  * @note    The implementation of this code affects <b>directly</b> the context
 348:../../../os/common/ports/AVR/chcore.h ****  *          switch performance so optimize here as much as you can.
 349:../../../os/common/ports/AVR/chcore.h ****  *
 350:../../../os/common/ports/AVR/chcore.h ****  * @param[in] ntp       the thread to be switched in
 351:../../../os/common/ports/AVR/chcore.h ****  * @param[in] otp       the thread to be switched out
 352:../../../os/common/ports/AVR/chcore.h ****  */
 353:../../../os/common/ports/AVR/chcore.h **** #define port_switch(ntp, otp) {                                             \
 354:../../../os/common/ports/AVR/chcore.h ****   _port_switch(ntp, otp);                                                   \
 355:../../../os/common/ports/AVR/chcore.h ****   asm volatile ("" : : : "memory");                                         \
 356:../../../os/common/ports/AVR/chcore.h **** }
 357:../../../os/common/ports/AVR/chcore.h **** 
 358:../../../os/common/ports/AVR/chcore.h **** 
 359:../../../os/common/ports/AVR/chcore.h **** /**
 360:../../../os/common/ports/AVR/chcore.h ****  * @brief   Port-related initialization code.
 361:../../../os/common/ports/AVR/chcore.h ****  * @note    This function is empty in this port.
 362:../../../os/common/ports/AVR/chcore.h ****  */
 363:../../../os/common/ports/AVR/chcore.h **** #define port_init() {                                                       \
 364:../../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = true;                                                      \
 365:../../../os/common/ports/AVR/chcore.h **** }
 366:../../../os/common/ports/AVR/chcore.h **** 
 367:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 368:../../../os/common/ports/AVR/chcore.h **** /* External declarations.                                                    */
 369:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 370:../../../os/common/ports/AVR/chcore.h **** 
 371:../../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 372:../../../os/common/ports/AVR/chcore.h ****    asm module.*/
 373:../../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 374:../../../os/common/ports/AVR/chcore.h **** 
 375:../../../os/common/ports/AVR/chcore.h **** #ifdef __cplusplus
 376:../../../os/common/ports/AVR/chcore.h **** extern "C" {
 377:../../../os/common/ports/AVR/chcore.h **** #endif
 378:../../../os/common/ports/AVR/chcore.h ****   void _port_switch(thread_t *ntp, thread_t *otp);
 379:../../../os/common/ports/AVR/chcore.h ****   void _port_thread_start(void);
 380:../../../os/common/ports/AVR/chcore.h **** #ifdef __cplusplus
 381:../../../os/common/ports/AVR/chcore.h **** }
 382:../../../os/common/ports/AVR/chcore.h **** #endif
 383:../../../os/common/ports/AVR/chcore.h **** 
 384:../../../os/common/ports/AVR/chcore.h **** #endif /* !defined(_FROM_ASM_) */
 385:../../../os/common/ports/AVR/chcore.h **** 
 386:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 387:../../../os/common/ports/AVR/chcore.h **** /* Module inline functions.                                                  */
 388:../../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 389:../../../os/common/ports/AVR/chcore.h **** 
 390:../../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 391:../../../os/common/ports/AVR/chcore.h ****    asm module.*/
 392:../../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 393:../../../os/common/ports/AVR/chcore.h **** 
 394:../../../os/common/ports/AVR/chcore.h **** /**
 395:../../../os/common/ports/AVR/chcore.h ****  * @brief   Returns a word encoding the current interrupts status.
 396:../../../os/common/ports/AVR/chcore.h ****  *
 397:../../../os/common/ports/AVR/chcore.h ****  * @return              The interrupts status.
 398:../../../os/common/ports/AVR/chcore.h ****  */
 399:../../../os/common/ports/AVR/chcore.h **** static inline syssts_t port_get_irq_status(void) {
 400:../../../os/common/ports/AVR/chcore.h **** 
 401:../../../os/common/ports/AVR/chcore.h ****   return SREG;
 402:../../../os/common/ports/AVR/chcore.h **** }
 403:../../../os/common/ports/AVR/chcore.h **** 
 404:../../../os/common/ports/AVR/chcore.h **** /**
 405:../../../os/common/ports/AVR/chcore.h ****  * @brief   Checks the interrupt status.
 406:../../../os/common/ports/AVR/chcore.h ****  *
 407:../../../os/common/ports/AVR/chcore.h ****  * @param[in] sts       the interrupt status word
 408:../../../os/common/ports/AVR/chcore.h ****  *
 409:../../../os/common/ports/AVR/chcore.h ****  * @return              The interrupt status.
 410:../../../os/common/ports/AVR/chcore.h ****  * @retval false        the word specified a disabled interrupts status.
 411:../../../os/common/ports/AVR/chcore.h ****  * @retval true         the word specified an enabled interrupts status.
 412:../../../os/common/ports/AVR/chcore.h ****  */
 413:../../../os/common/ports/AVR/chcore.h **** static inline bool port_irq_enabled(syssts_t sts) {
 414:../../../os/common/ports/AVR/chcore.h **** 
 415:../../../os/common/ports/AVR/chcore.h ****   return (bool)((sts & 0x80) != 0);
 416:../../../os/common/ports/AVR/chcore.h **** }
 417:../../../os/common/ports/AVR/chcore.h **** 
 418:../../../os/common/ports/AVR/chcore.h **** /**
 419:../../../os/common/ports/AVR/chcore.h ****  * @brief   Determines the current execution context.
 420:../../../os/common/ports/AVR/chcore.h ****  *
 421:../../../os/common/ports/AVR/chcore.h ****  * @return              The execution context.
 422:../../../os/common/ports/AVR/chcore.h ****  * @retval false        not running in ISR mode.
 423:../../../os/common/ports/AVR/chcore.h ****  * @retval true         running in ISR mode.
 424:../../../os/common/ports/AVR/chcore.h ****  */
 425:../../../os/common/ports/AVR/chcore.h **** static inline bool port_is_isr_context(void) {
 426:../../../os/common/ports/AVR/chcore.h **** 
 427:../../../os/common/ports/AVR/chcore.h ****   return __avr_in_isr;
 428:../../../os/common/ports/AVR/chcore.h **** }
 429:../../../os/common/ports/AVR/chcore.h **** 
 430:../../../os/common/ports/AVR/chcore.h **** /**
 431:../../../os/common/ports/AVR/chcore.h ****  * @brief   Kernel-lock action.
 432:../../../os/common/ports/AVR/chcore.h ****  * @details Usually this function just disables interrupts but may perform more
 433:../../../os/common/ports/AVR/chcore.h ****  *          actions.
 434:../../../os/common/ports/AVR/chcore.h ****  */
 435:../../../os/common/ports/AVR/chcore.h **** static inline void port_lock(void) {
 436:../../../os/common/ports/AVR/chcore.h **** 
 437:../../../os/common/ports/AVR/chcore.h ****   asm volatile ("cli" : : : "memory");
 404               		.loc 4 437 0
 405               	/* #APP */
 406               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 407 0000 F894      		cli
 408               	 ;  0 "" 2
 409               	/* #NOAPP */
 410               	.LBE279:
 411               	.LBE278:
 412               	.LBE277:
 413               	.LBE276:
 195:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 414               		.loc 1 195 0
 415 0002 0E94 0000 		call ibqGetFullBufferTimeoutS
 416               	.LVL31:
 417               	.LBB280:
 418               	.LBB281:
 419               	.LBB282:
 420               	.LBB283:
 421               	.LBB284:
 438:../../../os/common/ports/AVR/chcore.h **** }
 439:../../../os/common/ports/AVR/chcore.h **** 
 440:../../../os/common/ports/AVR/chcore.h **** /**
 441:../../../os/common/ports/AVR/chcore.h ****  * @brief   Kernel-unlock action.
 442:../../../os/common/ports/AVR/chcore.h ****  * @details Usually this function just enables interrupts but may perform more
 443:../../../os/common/ports/AVR/chcore.h ****  *          actions.
 444:../../../os/common/ports/AVR/chcore.h ****  */
 445:../../../os/common/ports/AVR/chcore.h **** static inline void port_unlock(void) {
 446:../../../os/common/ports/AVR/chcore.h **** 
 447:../../../os/common/ports/AVR/chcore.h ****   asm volatile ("sei" : : : "memory");
 422               		.loc 4 447 0
 423               	/* #APP */
 424               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 425 0006 7894      		sei
 426               	 ;  0 "" 2
 427               	/* #NOAPP */
 428               	.LBE284:
 429               	.LBE283:
 430               	.LBE282:
 431               	.LBE281:
 432               	.LBE280:
 199:../../../os/hal/src/hal_buffers.c **** 
 433               		.loc 1 199 0
 434 0008 0895      		ret
 435               		.cfi_endproc
 436               	.LFE172:
 438               		.section	.text.ibqReleaseEmptyBuffer,"ax",@progbits
 439               	.global	ibqReleaseEmptyBuffer
 441               	ibqReleaseEmptyBuffer:
 442               	.LFB174:
 245:../../../os/hal/src/hal_buffers.c **** 
 246:../../../os/hal/src/hal_buffers.c **** /**
 247:../../../os/hal/src/hal_buffers.c ****  * @brief   Releases the buffer back in the queue.
 248:../../../os/hal/src/hal_buffers.c ****  * @note    The object callback is called after releasing the buffer.
 249:../../../os/hal/src/hal_buffers.c ****  *
 250:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 251:../../../os/hal/src/hal_buffers.c ****  *
 252:../../../os/hal/src/hal_buffers.c ****  * @api
 253:../../../os/hal/src/hal_buffers.c ****  */
 254:../../../os/hal/src/hal_buffers.c **** void ibqReleaseEmptyBuffer(input_buffers_queue_t *ibqp) {
 443               		.loc 1 254 0
 444               		.cfi_startproc
 445               	.LVL32:
 446               	/* prologue: function */
 447               	/* frame size = 0 */
 448               	/* stack size = 0 */
 449               	.L__stack_usage = 0
 450 0000 DC01      		movw r26,r24
 451               	.LBB285:
 452               	.LBB286:
 453               	.LBB287:
 454               	.LBB288:
 437:../../../os/common/ports/AVR/chcore.h **** }
 455               		.loc 4 437 0
 456               	/* #APP */
 457               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 458 0002 F894      		cli
 459               	 ;  0 "" 2
 460               	.LVL33:
 461               	/* #NOAPP */
 462               	.LBE288:
 463               	.LBE287:
 464               	.LBE286:
 465               	.LBE285:
 466               	.LBB289:
 467               	.LBB290:
 255:../../../os/hal/src/hal_buffers.c **** 
 256:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 257:../../../os/hal/src/hal_buffers.c ****   ibqReleaseEmptyBufferS(ibqp);
 258:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 259:../../../os/hal/src/hal_buffers.c **** }
 260:../../../os/hal/src/hal_buffers.c **** 
 261:../../../os/hal/src/hal_buffers.c ****   /**
 262:../../../os/hal/src/hal_buffers.c ****    * @brief   Releases the buffer back in the queue.
 263:../../../os/hal/src/hal_buffers.c ****    * @note    The object callback is called after releasing the buffer.
 264:../../../os/hal/src/hal_buffers.c ****    *
 265:../../../os/hal/src/hal_buffers.c ****    * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 266:../../../os/hal/src/hal_buffers.c ****    *
 267:../../../os/hal/src/hal_buffers.c ****    * @sclass
 268:../../../os/hal/src/hal_buffers.c ****    */
 269:../../../os/hal/src/hal_buffers.c ****   void ibqReleaseEmptyBufferS(input_buffers_queue_t *ibqp) {
 270:../../../os/hal/src/hal_buffers.c **** 
 271:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassS();
 272:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!ibqIsEmptyI(ibqp), "buffers queue empty");
 273:../../../os/hal/src/hal_buffers.c **** 
 274:../../../os/hal/src/hal_buffers.c ****   /* Freeing a buffer slot in the queue.*/
 275:../../../os/hal/src/hal_buffers.c ****   ibqp->bcounter--;
 468               		.loc 1 275 0
 469 0004 1596      		adiw r26,5
 470 0006 8D91      		ld r24,X+
 471 0008 9C91      		ld r25,X
 472 000a 1697      		sbiw r26,5+1
 473               	.LVL34:
 474 000c 0197      		sbiw r24,1
 475 000e 1696      		adiw r26,5+1
 476 0010 9C93      		st X,r25
 477 0012 8E93      		st -X,r24
 478 0014 1597      		sbiw r26,5
 276:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr += ibqp->bsize;
 479               		.loc 1 276 0
 480 0016 1996      		adiw r26,9
 481 0018 2D91      		ld r18,X+
 482 001a 3C91      		ld r19,X
 483 001c 1A97      		sbiw r26,9+1
 484 001e 1D96      		adiw r26,13
 485 0020 8D91      		ld r24,X+
 486 0022 9C91      		ld r25,X
 487 0024 1E97      		sbiw r26,13+1
 488 0026 820F      		add r24,r18
 489 0028 931F      		adc r25,r19
 490 002a 1A96      		adiw r26,9+1
 491 002c 9C93      		st X,r25
 492 002e 8E93      		st -X,r24
 493 0030 1997      		sbiw r26,9
 277:../../../os/hal/src/hal_buffers.c ****   if (ibqp->brdptr >= ibqp->btop) {
 494               		.loc 1 277 0
 495 0032 1B96      		adiw r26,11
 496 0034 2D91      		ld r18,X+
 497 0036 3C91      		ld r19,X
 498 0038 1C97      		sbiw r26,11+1
 499 003a 8217      		cp r24,r18
 500 003c 9307      		cpc r25,r19
 501 003e 00F0      		brlo .L21
 278:../../../os/hal/src/hal_buffers.c ****     ibqp->brdptr = ibqp->buffers;
 502               		.loc 1 278 0
 503 0040 5196      		adiw r26,17
 504 0042 8D91      		ld r24,X+
 505 0044 9C91      		ld r25,X
 506 0046 5297      		sbiw r26,17+1
 507 0048 1A96      		adiw r26,9+1
 508 004a 9C93      		st X,r25
 509 004c 8E93      		st -X,r24
 510 004e 1997      		sbiw r26,9
 511               	.L21:
 279:../../../os/hal/src/hal_buffers.c ****   }
 280:../../../os/hal/src/hal_buffers.c **** 
 281:../../../os/hal/src/hal_buffers.c ****   /* No "current" buffer.*/
 282:../../../os/hal/src/hal_buffers.c ****   ibqp->ptr = NULL;
 512               		.loc 1 282 0
 513 0050 5496      		adiw r26,19+1
 514 0052 1C92      		st X,__zero_reg__
 515 0054 1E92      		st -X,__zero_reg__
 516 0056 5397      		sbiw r26,19
 283:../../../os/hal/src/hal_buffers.c **** 
 284:../../../os/hal/src/hal_buffers.c ****   /* Notifying the buffer release.*/
 285:../../../os/hal/src/hal_buffers.c ****   if (ibqp->notify != NULL) {
 517               		.loc 1 285 0
 518 0058 5796      		adiw r26,23
 519 005a ED91      		ld r30,X+
 520 005c FC91      		ld r31,X
 521 005e 5897      		sbiw r26,23+1
 522 0060 3097      		sbiw r30,0
 523 0062 01F0      		breq .L22
 524 0064 CD01      		movw r24,r26
 286:../../../os/hal/src/hal_buffers.c ****     ibqp->notify(ibqp);
 525               		.loc 1 286 0
 526 0066 0995      		icall
 527               	.LVL35:
 528               	.L22:
 529               	.LBE290:
 530               	.LBE289:
 531               	.LBB291:
 532               	.LBB292:
 533               	.LBB293:
 534               	.LBB294:
 535               	.LBB295:
 536               		.loc 4 447 0
 537               	/* #APP */
 538               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 539 0068 7894      		sei
 540               	 ;  0 "" 2
 541               	/* #NOAPP */
 542 006a 0895      		ret
 543               	.LBE295:
 544               	.LBE294:
 545               	.LBE293:
 546               	.LBE292:
 547               	.LBE291:
 548               		.cfi_endproc
 549               	.LFE174:
 551               		.section	.text.ibqReleaseEmptyBufferS,"ax",@progbits
 552               	.global	ibqReleaseEmptyBufferS
 554               	ibqReleaseEmptyBufferS:
 555               	.LFB175:
 269:../../../os/hal/src/hal_buffers.c **** 
 556               		.loc 1 269 0
 557               		.cfi_startproc
 558               	.LVL36:
 559               	/* prologue: function */
 560               	/* frame size = 0 */
 561               	/* stack size = 0 */
 562               	.L__stack_usage = 0
 563 0000 DC01      		movw r26,r24
 275:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr += ibqp->bsize;
 564               		.loc 1 275 0
 565 0002 1596      		adiw r26,5
 566 0004 8D91      		ld r24,X+
 567 0006 9C91      		ld r25,X
 568 0008 1697      		sbiw r26,5+1
 569               	.LVL37:
 570 000a 0197      		sbiw r24,1
 571 000c 1696      		adiw r26,5+1
 572 000e 9C93      		st X,r25
 573 0010 8E93      		st -X,r24
 574 0012 1597      		sbiw r26,5
 276:../../../os/hal/src/hal_buffers.c ****   if (ibqp->brdptr >= ibqp->btop) {
 575               		.loc 1 276 0
 576 0014 1996      		adiw r26,9
 577 0016 2D91      		ld r18,X+
 578 0018 3C91      		ld r19,X
 579 001a 1A97      		sbiw r26,9+1
 580 001c 1D96      		adiw r26,13
 581 001e 8D91      		ld r24,X+
 582 0020 9C91      		ld r25,X
 583 0022 1E97      		sbiw r26,13+1
 584 0024 820F      		add r24,r18
 585 0026 931F      		adc r25,r19
 586 0028 1A96      		adiw r26,9+1
 587 002a 9C93      		st X,r25
 588 002c 8E93      		st -X,r24
 589 002e 1997      		sbiw r26,9
 277:../../../os/hal/src/hal_buffers.c ****     ibqp->brdptr = ibqp->buffers;
 590               		.loc 1 277 0
 591 0030 1B96      		adiw r26,11
 592 0032 2D91      		ld r18,X+
 593 0034 3C91      		ld r19,X
 594 0036 1C97      		sbiw r26,11+1
 595 0038 8217      		cp r24,r18
 596 003a 9307      		cpc r25,r19
 597 003c 00F0      		brlo .L27
 278:../../../os/hal/src/hal_buffers.c ****   }
 598               		.loc 1 278 0
 599 003e 5196      		adiw r26,17
 600 0040 8D91      		ld r24,X+
 601 0042 9C91      		ld r25,X
 602 0044 5297      		sbiw r26,17+1
 603 0046 1A96      		adiw r26,9+1
 604 0048 9C93      		st X,r25
 605 004a 8E93      		st -X,r24
 606 004c 1997      		sbiw r26,9
 607               	.L27:
 282:../../../os/hal/src/hal_buffers.c **** 
 608               		.loc 1 282 0
 609 004e 5496      		adiw r26,19+1
 610 0050 1C92      		st X,__zero_reg__
 611 0052 1E92      		st -X,__zero_reg__
 612 0054 5397      		sbiw r26,19
 285:../../../os/hal/src/hal_buffers.c ****     ibqp->notify(ibqp);
 613               		.loc 1 285 0
 614 0056 5796      		adiw r26,23
 615 0058 ED91      		ld r30,X+
 616 005a FC91      		ld r31,X
 617 005c 5897      		sbiw r26,23+1
 618 005e 3097      		sbiw r30,0
 619 0060 01F0      		breq .L26
 620               		.loc 1 286 0
 621 0062 CD01      		movw r24,r26
 622 0064 0994      		ijmp
 623               	.LVL38:
 624               	.L26:
 625 0066 0895      		ret
 626               		.cfi_endproc
 627               	.LFE175:
 629               		.section	.text.ibqGetTimeout,"ax",@progbits
 630               	.global	ibqGetTimeout
 632               	ibqGetTimeout:
 633               	.LFB176:
 287:../../../os/hal/src/hal_buffers.c ****   }
 288:../../../os/hal/src/hal_buffers.c **** }
 289:../../../os/hal/src/hal_buffers.c **** 
 290:../../../os/hal/src/hal_buffers.c **** /**
 291:../../../os/hal/src/hal_buffers.c ****  * @brief   Input queue read with timeout.
 292:../../../os/hal/src/hal_buffers.c ****  * @details This function reads a byte value from an input queue. If
 293:../../../os/hal/src/hal_buffers.c ****  *          the queue is empty then the calling thread is suspended until a
 294:../../../os/hal/src/hal_buffers.c ****  *          new buffer arrives in the queue or a timeout occurs.
 295:../../../os/hal/src/hal_buffers.c ****  *
 296:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 297:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 298:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 299:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 300:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 301:../../../os/hal/src/hal_buffers.c ****  *                      .
 302:../../../os/hal/src/hal_buffers.c ****  * @return              A byte value from the queue.
 303:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_TIMEOUT  if the specified time expired.
 304:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_RESET    if the queue has been reset or has been put in
 305:../../../os/hal/src/hal_buffers.c ****  *                      suspended state.
 306:../../../os/hal/src/hal_buffers.c ****  *
 307:../../../os/hal/src/hal_buffers.c ****  * @api
 308:../../../os/hal/src/hal_buffers.c ****  */
 309:../../../os/hal/src/hal_buffers.c **** msg_t ibqGetTimeout(input_buffers_queue_t *ibqp, sysinterval_t timeout) {
 634               		.loc 1 309 0
 635               		.cfi_startproc
 636               	.LVL39:
 637 0000 0F93      		push r16
 638               	.LCFI10:
 639               		.cfi_def_cfa_offset 3
 640               		.cfi_offset 16, -2
 641 0002 1F93      		push r17
 642               	.LCFI11:
 643               		.cfi_def_cfa_offset 4
 644               		.cfi_offset 17, -3
 645 0004 CF93      		push r28
 646               	.LCFI12:
 647               		.cfi_def_cfa_offset 5
 648               		.cfi_offset 28, -4
 649 0006 DF93      		push r29
 650               	.LCFI13:
 651               		.cfi_def_cfa_offset 6
 652               		.cfi_offset 29, -5
 653               	/* prologue: function */
 654               	/* frame size = 0 */
 655               	/* stack size = 4 */
 656               	.L__stack_usage = 4
 657 0008 EC01      		movw r28,r24
 658               	.LBB296:
 659               	.LBB297:
 660               	.LBB298:
 661               	.LBB299:
 437:../../../os/common/ports/AVR/chcore.h **** }
 662               		.loc 4 437 0
 663               	/* #APP */
 664               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 665 000a F894      		cli
 666               	 ;  0 "" 2
 667               	/* #NOAPP */
 668               	.LBE299:
 669               	.LBE298:
 670               	.LBE297:
 671               	.LBE296:
 310:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 311:../../../os/hal/src/hal_buffers.c **** 
 312:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 313:../../../os/hal/src/hal_buffers.c **** 
 314:../../../os/hal/src/hal_buffers.c ****   /* This condition indicates that a new buffer must be acquired.*/
 315:../../../os/hal/src/hal_buffers.c ****   if (ibqp->ptr == NULL) {
 672               		.loc 1 315 0
 673 000c EB89      		ldd r30,Y+19
 674 000e FC89      		ldd r31,Y+20
 675 0010 3097      		sbiw r30,0
 676 0012 01F0      		breq .L40
 677               	.LVL40:
 678               	.L30:
 316:../../../os/hal/src/hal_buffers.c ****     msg = ibqGetFullBufferTimeoutS(ibqp, timeout);
 317:../../../os/hal/src/hal_buffers.c ****     if (msg != MSG_OK) {
 318:../../../os/hal/src/hal_buffers.c ****       osalSysUnlock();
 319:../../../os/hal/src/hal_buffers.c ****       return msg;
 320:../../../os/hal/src/hal_buffers.c ****     }
 321:../../../os/hal/src/hal_buffers.c ****   }
 322:../../../os/hal/src/hal_buffers.c **** 
 323:../../../os/hal/src/hal_buffers.c ****   /* Next byte from the buffer.*/
 324:../../../os/hal/src/hal_buffers.c ****   msg = (msg_t)*ibqp->ptr;
 679               		.loc 1 324 0
 680 0014 0191      		ld r16,Z+
 681 0016 10E0      		ldi r17,0
 682               	.LVL41:
 325:../../../os/hal/src/hal_buffers.c ****   ibqp->ptr++;
 683               		.loc 1 325 0
 684 0018 FC8B      		std Y+20,r31
 685 001a EB8B      		std Y+19,r30
 326:../../../os/hal/src/hal_buffers.c **** 
 327:../../../os/hal/src/hal_buffers.c ****   /* If the current buffer has been fully read then it is returned as
 328:../../../os/hal/src/hal_buffers.c ****      empty in the queue.*/
 329:../../../os/hal/src/hal_buffers.c ****   if (ibqp->ptr >= ibqp->top) {
 686               		.loc 1 329 0
 687 001c 8D89      		ldd r24,Y+21
 688 001e 9E89      		ldd r25,Y+22
 689 0020 E817      		cp r30,r24
 690 0022 F907      		cpc r31,r25
 691 0024 00F0      		brlo .L34
 692               	.LVL42:
 693               	.LBB300:
 694               	.LBB301:
 275:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr += ibqp->bsize;
 695               		.loc 1 275 0
 696 0026 8D81      		ldd r24,Y+5
 697 0028 9E81      		ldd r25,Y+6
 698 002a 0197      		sbiw r24,1
 699 002c 9E83      		std Y+6,r25
 700 002e 8D83      		std Y+5,r24
 276:../../../os/hal/src/hal_buffers.c ****   if (ibqp->brdptr >= ibqp->btop) {
 701               		.loc 1 276 0
 702 0030 2985      		ldd r18,Y+9
 703 0032 3A85      		ldd r19,Y+10
 704 0034 8D85      		ldd r24,Y+13
 705 0036 9E85      		ldd r25,Y+14
 706 0038 820F      		add r24,r18
 707 003a 931F      		adc r25,r19
 708 003c 9A87      		std Y+10,r25
 709 003e 8987      		std Y+9,r24
 277:../../../os/hal/src/hal_buffers.c ****     ibqp->brdptr = ibqp->buffers;
 710               		.loc 1 277 0
 711 0040 2B85      		ldd r18,Y+11
 712 0042 3C85      		ldd r19,Y+12
 713 0044 8217      		cp r24,r18
 714 0046 9307      		cpc r25,r19
 715 0048 00F0      		brlo .L35
 278:../../../os/hal/src/hal_buffers.c ****   }
 716               		.loc 1 278 0
 717 004a 8989      		ldd r24,Y+17
 718 004c 9A89      		ldd r25,Y+18
 719 004e 9A87      		std Y+10,r25
 720 0050 8987      		std Y+9,r24
 721               	.L35:
 282:../../../os/hal/src/hal_buffers.c **** 
 722               		.loc 1 282 0
 723 0052 1C8A      		std Y+20,__zero_reg__
 724 0054 1B8A      		std Y+19,__zero_reg__
 285:../../../os/hal/src/hal_buffers.c ****     ibqp->notify(ibqp);
 725               		.loc 1 285 0
 726 0056 EF89      		ldd r30,Y+23
 727 0058 F88D      		ldd r31,Y+24
 728 005a 3097      		sbiw r30,0
 729 005c 01F0      		breq .L34
 286:../../../os/hal/src/hal_buffers.c ****   }
 730               		.loc 1 286 0
 731 005e CE01      		movw r24,r28
 732 0060 0995      		icall
 733               	.LVL43:
 734               	.L34:
 735               	.LBE301:
 736               	.LBE300:
 737               	.LBB302:
 738               	.LBB303:
 739               	.LBB304:
 740               	.LBB305:
 741               	.LBB306:
 742               		.loc 4 447 0
 743               	/* #APP */
 744               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 745 0062 7894      		sei
 746               	 ;  0 "" 2
 747               	/* #NOAPP */
 748               	.LBE306:
 749               	.LBE305:
 750               	.LBE304:
 751               	.LBE303:
 752               	.LBE302:
 330:../../../os/hal/src/hal_buffers.c ****     ibqReleaseEmptyBufferS(ibqp);
 331:../../../os/hal/src/hal_buffers.c ****   }
 332:../../../os/hal/src/hal_buffers.c **** 
 333:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 334:../../../os/hal/src/hal_buffers.c ****   return msg;
 753               		.loc 1 334 0
 754 0064 C801      		movw r24,r16
 755               	.LVL44:
 756               	.L32:
 757               	/* epilogue start */
 335:../../../os/hal/src/hal_buffers.c **** }
 758               		.loc 1 335 0
 759 0066 DF91      		pop r29
 760 0068 CF91      		pop r28
 761               	.LVL45:
 762 006a 1F91      		pop r17
 763 006c 0F91      		pop r16
 764 006e 0895      		ret
 765               	.LVL46:
 766               	.L40:
 316:../../../os/hal/src/hal_buffers.c ****     if (msg != MSG_OK) {
 767               		.loc 1 316 0
 768 0070 0E94 0000 		call ibqGetFullBufferTimeoutS
 769               	.LVL47:
 317:../../../os/hal/src/hal_buffers.c ****       osalSysUnlock();
 770               		.loc 1 317 0
 771 0074 0097      		sbiw r24,0
 772 0076 01F4      		brne .L31
 773 0078 EB89      		ldd r30,Y+19
 774 007a FC89      		ldd r31,Y+20
 775 007c 00C0      		rjmp .L30
 776               	.L31:
 777               	.LBB307:
 778               	.LBB308:
 779               	.LBB309:
 780               	.LBB310:
 781               	.LBB311:
 782               		.loc 4 447 0
 783               	/* #APP */
 784               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 785 007e 7894      		sei
 786               	 ;  0 "" 2
 787               	/* #NOAPP */
 788               	.LBE311:
 789               	.LBE310:
 790               	.LBE309:
 791               	.LBE308:
 792               	.LBE307:
 319:../../../os/hal/src/hal_buffers.c ****     }
 793               		.loc 1 319 0
 794 0080 00C0      		rjmp .L32
 795               		.cfi_endproc
 796               	.LFE176:
 798               		.section	.text.ibqReadTimeout,"ax",@progbits
 799               	.global	ibqReadTimeout
 801               	ibqReadTimeout:
 802               	.LFB177:
 336:../../../os/hal/src/hal_buffers.c **** 
 337:../../../os/hal/src/hal_buffers.c **** /**
 338:../../../os/hal/src/hal_buffers.c ****  * @brief   Input queue read with timeout.
 339:../../../os/hal/src/hal_buffers.c ****  * @details The function reads data from an input queue into a buffer.
 340:../../../os/hal/src/hal_buffers.c ****  *          The operation completes when the specified amount of data has been
 341:../../../os/hal/src/hal_buffers.c ****  *          transferred or after the specified timeout or if the queue has
 342:../../../os/hal/src/hal_buffers.c ****  *          been reset.
 343:../../../os/hal/src/hal_buffers.c ****  *
 344:../../../os/hal/src/hal_buffers.c ****  * @param[in] ibqp      pointer to the @p input_buffers_queue_t object
 345:../../../os/hal/src/hal_buffers.c ****  * @param[out] bp       pointer to the data buffer
 346:../../../os/hal/src/hal_buffers.c ****  * @param[in] n         the maximum amount of data to be transferred, the
 347:../../../os/hal/src/hal_buffers.c ****  *                      value 0 is reserved
 348:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 349:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 350:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 351:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 352:../../../os/hal/src/hal_buffers.c ****  *                      .
 353:../../../os/hal/src/hal_buffers.c ****  * @return              The number of bytes effectively transferred.
 354:../../../os/hal/src/hal_buffers.c ****  * @retval 0            if a timeout occurred.
 355:../../../os/hal/src/hal_buffers.c ****  *
 356:../../../os/hal/src/hal_buffers.c ****  * @api
 357:../../../os/hal/src/hal_buffers.c ****  */
 358:../../../os/hal/src/hal_buffers.c **** size_t ibqReadTimeout(input_buffers_queue_t *ibqp, uint8_t *bp,
 359:../../../os/hal/src/hal_buffers.c ****                       size_t n, sysinterval_t timeout) {
 803               		.loc 1 359 0
 804               		.cfi_startproc
 805               	.LVL48:
 806 0000 4F92      		push r4
 807               	.LCFI14:
 808               		.cfi_def_cfa_offset 3
 809               		.cfi_offset 4, -2
 810 0002 5F92      		push r5
 811               	.LCFI15:
 812               		.cfi_def_cfa_offset 4
 813               		.cfi_offset 5, -3
 814 0004 6F92      		push r6
 815               	.LCFI16:
 816               		.cfi_def_cfa_offset 5
 817               		.cfi_offset 6, -4
 818 0006 7F92      		push r7
 819               	.LCFI17:
 820               		.cfi_def_cfa_offset 6
 821               		.cfi_offset 7, -5
 822 0008 8F92      		push r8
 823               	.LCFI18:
 824               		.cfi_def_cfa_offset 7
 825               		.cfi_offset 8, -6
 826 000a 9F92      		push r9
 827               	.LCFI19:
 828               		.cfi_def_cfa_offset 8
 829               		.cfi_offset 9, -7
 830 000c AF92      		push r10
 831               	.LCFI20:
 832               		.cfi_def_cfa_offset 9
 833               		.cfi_offset 10, -8
 834 000e BF92      		push r11
 835               	.LCFI21:
 836               		.cfi_def_cfa_offset 10
 837               		.cfi_offset 11, -9
 838 0010 CF92      		push r12
 839               	.LCFI22:
 840               		.cfi_def_cfa_offset 11
 841               		.cfi_offset 12, -10
 842 0012 DF92      		push r13
 843               	.LCFI23:
 844               		.cfi_def_cfa_offset 12
 845               		.cfi_offset 13, -11
 846 0014 EF92      		push r14
 847               	.LCFI24:
 848               		.cfi_def_cfa_offset 13
 849               		.cfi_offset 14, -12
 850 0016 FF92      		push r15
 851               	.LCFI25:
 852               		.cfi_def_cfa_offset 14
 853               		.cfi_offset 15, -13
 854 0018 0F93      		push r16
 855               	.LCFI26:
 856               		.cfi_def_cfa_offset 15
 857               		.cfi_offset 16, -14
 858 001a 1F93      		push r17
 859               	.LCFI27:
 860               		.cfi_def_cfa_offset 16
 861               		.cfi_offset 17, -15
 862 001c CF93      		push r28
 863               	.LCFI28:
 864               		.cfi_def_cfa_offset 17
 865               		.cfi_offset 28, -16
 866 001e DF93      		push r29
 867               	.LCFI29:
 868               		.cfi_def_cfa_offset 18
 869               		.cfi_offset 29, -17
 870               	/* prologue: function */
 871               	/* frame size = 0 */
 872               	/* stack size = 16 */
 873               	.L__stack_usage = 16
 874 0020 EC01      		movw r28,r24
 875 0022 6B01      		movw r12,r22
 876 0024 5A01      		movw r10,r20
 877 0026 4901      		movw r8,r18
 878               	.LVL49:
 879               	.LBB312:
 880               	.LBB313:
 881               	.LBB314:
 882               	.LBB315:
 437:../../../os/common/ports/AVR/chcore.h **** }
 883               		.loc 4 437 0
 884               	/* #APP */
 885               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 886 0028 F894      		cli
 887               	 ;  0 "" 2
 888               	/* #NOAPP */
 889               	.LBE315:
 890               	.LBE314:
 891               	.LBE313:
 892               	.LBE312:
 893               	.LBB316:
 894               	.LBB317:
 895               	.LBB318:
 896               		.file 5 "../../../os/rt/include/chvt.h"
   1:../../../os/rt/include/chvt.h **** /*
   2:../../../os/rt/include/chvt.h ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio.
   3:../../../os/rt/include/chvt.h **** 
   4:../../../os/rt/include/chvt.h ****     This file is part of ChibiOS.
   5:../../../os/rt/include/chvt.h **** 
   6:../../../os/rt/include/chvt.h ****     ChibiOS is free software; you can redistribute it and/or modify
   7:../../../os/rt/include/chvt.h ****     it under the terms of the GNU General Public License as published by
   8:../../../os/rt/include/chvt.h ****     the Free Software Foundation; either version 3 of the License, or
   9:../../../os/rt/include/chvt.h ****     (at your option) any later version.
  10:../../../os/rt/include/chvt.h **** 
  11:../../../os/rt/include/chvt.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../../os/rt/include/chvt.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../../os/rt/include/chvt.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../../os/rt/include/chvt.h ****     GNU General Public License for more details.
  15:../../../os/rt/include/chvt.h **** 
  16:../../../os/rt/include/chvt.h ****     You should have received a copy of the GNU General Public License
  17:../../../os/rt/include/chvt.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../../os/rt/include/chvt.h **** */
  19:../../../os/rt/include/chvt.h **** 
  20:../../../os/rt/include/chvt.h **** /**
  21:../../../os/rt/include/chvt.h ****  * @file    chvt.h
  22:../../../os/rt/include/chvt.h ****  * @brief   Time and Virtual Timers module macros and structures.
  23:../../../os/rt/include/chvt.h ****  *
  24:../../../os/rt/include/chvt.h ****  * @addtogroup time
  25:../../../os/rt/include/chvt.h ****  * @{
  26:../../../os/rt/include/chvt.h ****  */
  27:../../../os/rt/include/chvt.h **** 
  28:../../../os/rt/include/chvt.h **** #ifndef CHVT_H
  29:../../../os/rt/include/chvt.h **** #define CHVT_H
  30:../../../os/rt/include/chvt.h **** 
  31:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  32:../../../os/rt/include/chvt.h **** /* Module constants.                                                         */
  33:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  34:../../../os/rt/include/chvt.h **** 
  35:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  36:../../../os/rt/include/chvt.h **** /* Module pre-compile time settings.                                         */
  37:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  38:../../../os/rt/include/chvt.h **** 
  39:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  40:../../../os/rt/include/chvt.h **** /* Derived constants and error checks.                                       */
  41:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  42:../../../os/rt/include/chvt.h **** 
  43:../../../os/rt/include/chvt.h **** #if (CH_CFG_ST_TIMEDELTA < 0) || (CH_CFG_ST_TIMEDELTA == 1)
  44:../../../os/rt/include/chvt.h **** #error "invalid CH_CFG_ST_TIMEDELTA specified, must "                       \
  45:../../../os/rt/include/chvt.h ****        "be zero or greater than one"
  46:../../../os/rt/include/chvt.h **** #endif
  47:../../../os/rt/include/chvt.h **** 
  48:../../../os/rt/include/chvt.h **** //#if (CH_CFG_ST_TIMEDELTA > 0) && (CH_CFG_TIME_QUANTUM > 0)
  49:../../../os/rt/include/chvt.h **** //#error "CH_CFG_TIME_QUANTUM not supported in tickless mode"
  50:../../../os/rt/include/chvt.h **** //#endif
  51:../../../os/rt/include/chvt.h **** 
  52:../../../os/rt/include/chvt.h **** #if (CH_CFG_ST_TIMEDELTA > 0) && (CH_DBG_THREADS_PROFILING == TRUE)
  53:../../../os/rt/include/chvt.h **** #error "CH_DBG_THREADS_PROFILING not supported in tickless mode"
  54:../../../os/rt/include/chvt.h **** #endif
  55:../../../os/rt/include/chvt.h **** 
  56:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  57:../../../os/rt/include/chvt.h **** /* Module data structures and types.                                         */
  58:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  59:../../../os/rt/include/chvt.h **** 
  60:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  61:../../../os/rt/include/chvt.h **** /* Module macros.                                                            */
  62:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  63:../../../os/rt/include/chvt.h **** 
  64:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  65:../../../os/rt/include/chvt.h **** /* External declarations.                                                    */
  66:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  67:../../../os/rt/include/chvt.h **** 
  68:../../../os/rt/include/chvt.h **** /*
  69:../../../os/rt/include/chvt.h ****  * Virtual Timers APIs.
  70:../../../os/rt/include/chvt.h ****  */
  71:../../../os/rt/include/chvt.h **** #ifdef __cplusplus
  72:../../../os/rt/include/chvt.h **** extern "C" {
  73:../../../os/rt/include/chvt.h **** #endif
  74:../../../os/rt/include/chvt.h ****   void _vt_init(void);
  75:../../../os/rt/include/chvt.h ****   void chVTDoSetI(virtual_timer_t *vtp, sysinterval_t delay,
  76:../../../os/rt/include/chvt.h ****                   vtfunc_t vtfunc, void *par);
  77:../../../os/rt/include/chvt.h ****   void chVTDoResetI(virtual_timer_t *vtp);
  78:../../../os/rt/include/chvt.h **** #ifdef __cplusplus
  79:../../../os/rt/include/chvt.h **** }
  80:../../../os/rt/include/chvt.h **** #endif
  81:../../../os/rt/include/chvt.h **** 
  82:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  83:../../../os/rt/include/chvt.h **** /* Module inline functions.                                                  */
  84:../../../os/rt/include/chvt.h **** /*===========================================================================*/
  85:../../../os/rt/include/chvt.h **** 
  86:../../../os/rt/include/chvt.h **** /**
  87:../../../os/rt/include/chvt.h ****  * @brief   Initializes a @p virtual_timer_t object.
  88:../../../os/rt/include/chvt.h ****  * @note    Initializing a timer object is not strictly required because
  89:../../../os/rt/include/chvt.h ****  *          the function @p chVTSetI() initializes the object too. This
  90:../../../os/rt/include/chvt.h ****  *          function is only useful if you need to perform a @p chVTIsArmed()
  91:../../../os/rt/include/chvt.h ****  *          check before calling @p chVTSetI().
  92:../../../os/rt/include/chvt.h ****  *
  93:../../../os/rt/include/chvt.h ****  * @param[out] vtp      the @p virtual_timer_t structure pointer
  94:../../../os/rt/include/chvt.h ****  *
  95:../../../os/rt/include/chvt.h ****  * @init
  96:../../../os/rt/include/chvt.h ****  */
  97:../../../os/rt/include/chvt.h **** static inline void chVTObjectInit(virtual_timer_t *vtp) {
  98:../../../os/rt/include/chvt.h **** 
  99:../../../os/rt/include/chvt.h ****   vtp->func = NULL;
 100:../../../os/rt/include/chvt.h **** }
 101:../../../os/rt/include/chvt.h **** 
 102:../../../os/rt/include/chvt.h **** /**
 103:../../../os/rt/include/chvt.h ****  * @brief   Current system time.
 104:../../../os/rt/include/chvt.h ****  * @details Returns the number of system ticks since the @p chSysInit()
 105:../../../os/rt/include/chvt.h ****  *          invocation.
 106:../../../os/rt/include/chvt.h ****  * @note    The counter can reach its maximum and then restart from zero.
 107:../../../os/rt/include/chvt.h ****  * @note    This function can be called from any context but its atomicity
 108:../../../os/rt/include/chvt.h ****  *          is not guaranteed on architectures whose word size is less than
 109:../../../os/rt/include/chvt.h ****  *          @p systime_t size.
 110:../../../os/rt/include/chvt.h ****  *
 111:../../../os/rt/include/chvt.h ****  * @return              The system time in ticks.
 112:../../../os/rt/include/chvt.h ****  *
 113:../../../os/rt/include/chvt.h ****  * @xclass
 114:../../../os/rt/include/chvt.h ****  */
 115:../../../os/rt/include/chvt.h **** static inline systime_t chVTGetSystemTimeX(void) {
 116:../../../os/rt/include/chvt.h **** 
 117:../../../os/rt/include/chvt.h **** #if CH_CFG_ST_TIMEDELTA == 0
 118:../../../os/rt/include/chvt.h ****   return ch.vtlist.systime;
 897               		.loc 5 118 0
 898 002a 4090 0000 		lds r4,ch+19
 899 002e 5090 0000 		lds r5,ch+19+1
 900               	.LVL50:
 901               	.LBE318:
 902               	.LBE317:
 903               	.LBE316:
 904               	.LBB319:
 905               	.LBB320:
 906               	.LBB321:
 907               		.file 6 "../../../os/rt/include/chtime.h"
   1:../../../os/rt/include/chtime.h **** /*
   2:../../../os/rt/include/chtime.h ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio.
   3:../../../os/rt/include/chtime.h **** 
   4:../../../os/rt/include/chtime.h ****     This file is part of ChibiOS.
   5:../../../os/rt/include/chtime.h **** 
   6:../../../os/rt/include/chtime.h ****     ChibiOS is free software; you can redistribute it and/or modify
   7:../../../os/rt/include/chtime.h ****     it under the terms of the GNU General Public License as published by
   8:../../../os/rt/include/chtime.h ****     the Free Software Foundation; either version 3 of the License, or
   9:../../../os/rt/include/chtime.h ****     (at your option) any later version.
  10:../../../os/rt/include/chtime.h **** 
  11:../../../os/rt/include/chtime.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../../os/rt/include/chtime.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../../os/rt/include/chtime.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../../os/rt/include/chtime.h ****     GNU General Public License for more details.
  15:../../../os/rt/include/chtime.h **** 
  16:../../../os/rt/include/chtime.h ****     You should have received a copy of the GNU General Public License
  17:../../../os/rt/include/chtime.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../../os/rt/include/chtime.h **** */
  19:../../../os/rt/include/chtime.h **** 
  20:../../../os/rt/include/chtime.h **** /**
  21:../../../os/rt/include/chtime.h ****  * @file    chtime.h
  22:../../../os/rt/include/chtime.h ****  * @brief   Time and intervals macros and structures.
  23:../../../os/rt/include/chtime.h ****  *
  24:../../../os/rt/include/chtime.h ****  * @addtogroup time_intervals
  25:../../../os/rt/include/chtime.h ****  * @{
  26:../../../os/rt/include/chtime.h ****  */
  27:../../../os/rt/include/chtime.h **** 
  28:../../../os/rt/include/chtime.h **** #ifndef CHTIME_H
  29:../../../os/rt/include/chtime.h **** #define CHTIME_H
  30:../../../os/rt/include/chtime.h **** 
  31:../../../os/rt/include/chtime.h **** /*===========================================================================*/
  32:../../../os/rt/include/chtime.h **** /* Module constants.                                                         */
  33:../../../os/rt/include/chtime.h **** /*===========================================================================*/
  34:../../../os/rt/include/chtime.h **** 
  35:../../../os/rt/include/chtime.h **** /**
  36:../../../os/rt/include/chtime.h ****  * @name    Special time constants
  37:../../../os/rt/include/chtime.h ****  * @{
  38:../../../os/rt/include/chtime.h ****  */
  39:../../../os/rt/include/chtime.h **** /**
  40:../../../os/rt/include/chtime.h ****  * @brief   Zero interval specification for some functions with a timeout
  41:../../../os/rt/include/chtime.h ****  *          specification.
  42:../../../os/rt/include/chtime.h ****  * @note    Not all functions accept @p TIME_IMMEDIATE as timeout parameter,
  43:../../../os/rt/include/chtime.h ****  *          see the specific function documentation.
  44:../../../os/rt/include/chtime.h ****  */
  45:../../../os/rt/include/chtime.h **** #define TIME_IMMEDIATE      ((sysinterval_t)0)
  46:../../../os/rt/include/chtime.h **** 
  47:../../../os/rt/include/chtime.h **** /**
  48:../../../os/rt/include/chtime.h ****  * @brief   Infinite interval specification for all functions with a timeout
  49:../../../os/rt/include/chtime.h ****  *          specification.
  50:../../../os/rt/include/chtime.h ****  * @note    Not all functions accept @p TIME_INFINITE as timeout parameter,
  51:../../../os/rt/include/chtime.h ****  *          see the specific function documentation.
  52:../../../os/rt/include/chtime.h ****  */
  53:../../../os/rt/include/chtime.h **** #define TIME_INFINITE       ((sysinterval_t)-1)
  54:../../../os/rt/include/chtime.h **** 
  55:../../../os/rt/include/chtime.h **** /**
  56:../../../os/rt/include/chtime.h ****  * @brief   Maximum interval constant usable as timeout.
  57:../../../os/rt/include/chtime.h ****  */
  58:../../../os/rt/include/chtime.h **** #define TIME_MAX_INTERVAL   ((sysinterval_t)-2)
  59:../../../os/rt/include/chtime.h **** 
  60:../../../os/rt/include/chtime.h **** /**
  61:../../../os/rt/include/chtime.h ****  * @brief   Maximum system of system time before it wraps.
  62:../../../os/rt/include/chtime.h ****  */
  63:../../../os/rt/include/chtime.h **** #define TIME_MAX_SYSTIME    ((systime_t)-1)
  64:../../../os/rt/include/chtime.h **** /** @} */
  65:../../../os/rt/include/chtime.h **** 
  66:../../../os/rt/include/chtime.h **** /*===========================================================================*/
  67:../../../os/rt/include/chtime.h **** /* Module pre-compile time settings.                                         */
  68:../../../os/rt/include/chtime.h **** /*===========================================================================*/
  69:../../../os/rt/include/chtime.h **** 
  70:../../../os/rt/include/chtime.h **** /**
  71:../../../os/rt/include/chtime.h ****  * @brief   System time counter resolution.
  72:../../../os/rt/include/chtime.h ****  * @note    Allowed values are 16, 32 or 64 bits.
  73:../../../os/rt/include/chtime.h ****  */
  74:../../../os/rt/include/chtime.h **** #if !defined(CH_CFG_ST_RESOLUTION) || defined(__DOXYGEN__)
  75:../../../os/rt/include/chtime.h **** #define CH_CFG_ST_RESOLUTION                32
  76:../../../os/rt/include/chtime.h **** #endif
  77:../../../os/rt/include/chtime.h **** 
  78:../../../os/rt/include/chtime.h **** /**
  79:../../../os/rt/include/chtime.h ****  * @brief   System tick frequency.
  80:../../../os/rt/include/chtime.h ****  * @details Frequency of the system timer that drives the system ticks. This
  81:../../../os/rt/include/chtime.h ****  *          setting also defines the system tick time unit.
  82:../../../os/rt/include/chtime.h ****  */
  83:../../../os/rt/include/chtime.h **** #if !defined(CH_CFG_ST_FREQUENCY) || defined(__DOXYGEN__)
  84:../../../os/rt/include/chtime.h **** #define CH_CFG_ST_FREQUENCY                 1000
  85:../../../os/rt/include/chtime.h **** #endif
  86:../../../os/rt/include/chtime.h **** 
  87:../../../os/rt/include/chtime.h **** /**
  88:../../../os/rt/include/chtime.h ****  * @brief   Time intervals data size.
  89:../../../os/rt/include/chtime.h ****  * @note    Allowed values are 16, 32 or 64 bits.
  90:../../../os/rt/include/chtime.h ****  */
  91:../../../os/rt/include/chtime.h **** #if !defined(CH_CFG_INTERVALS_SIZE) || defined(__DOXYGEN__)
  92:../../../os/rt/include/chtime.h **** #define CH_CFG_INTERVALS_SIZE               32
  93:../../../os/rt/include/chtime.h **** #endif
  94:../../../os/rt/include/chtime.h **** 
  95:../../../os/rt/include/chtime.h **** /**
  96:../../../os/rt/include/chtime.h ****  * @brief   Time types data size.
  97:../../../os/rt/include/chtime.h ****  * @note    Allowed values are 16 or 32 bits.
  98:../../../os/rt/include/chtime.h ****  */
  99:../../../os/rt/include/chtime.h **** #if !defined(CH_CFG_TIME_TYPES_SIZE) || defined(__DOXYGEN__)
 100:../../../os/rt/include/chtime.h **** #define CH_CFG_TIME_TYPES_SIZE              32
 101:../../../os/rt/include/chtime.h **** #endif
 102:../../../os/rt/include/chtime.h **** 
 103:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 104:../../../os/rt/include/chtime.h **** /* Derived constants and error checks.                                       */
 105:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 106:../../../os/rt/include/chtime.h **** 
 107:../../../os/rt/include/chtime.h **** #if (CH_CFG_ST_RESOLUTION != 16) && (CH_CFG_ST_RESOLUTION != 32) &&         \
 108:../../../os/rt/include/chtime.h ****     (CH_CFG_ST_RESOLUTION != 64)
 109:../../../os/rt/include/chtime.h **** #error "invalid CH_CFG_ST_RESOLUTION specified, must be 16, 32 or 64"
 110:../../../os/rt/include/chtime.h **** #endif
 111:../../../os/rt/include/chtime.h **** 
 112:../../../os/rt/include/chtime.h **** #if CH_CFG_ST_FREQUENCY < 10
 113:../../../os/rt/include/chtime.h **** #error "invalid CH_CFG_ST_FREQUENCY specified, must be >= 10"
 114:../../../os/rt/include/chtime.h **** #endif
 115:../../../os/rt/include/chtime.h **** 
 116:../../../os/rt/include/chtime.h **** #if (CH_CFG_INTERVALS_SIZE != 16) && (CH_CFG_INTERVALS_SIZE != 32) &&       \
 117:../../../os/rt/include/chtime.h ****     (CH_CFG_INTERVALS_SIZE != 64)
 118:../../../os/rt/include/chtime.h **** #error "invalid CH_CFG_INTERVALS_SIZE specified, must be 16, 32 or 64"
 119:../../../os/rt/include/chtime.h **** #endif
 120:../../../os/rt/include/chtime.h **** 
 121:../../../os/rt/include/chtime.h **** #if (CH_CFG_TIME_TYPES_SIZE != 16) && (CH_CFG_TIME_TYPES_SIZE != 32)
 122:../../../os/rt/include/chtime.h **** #error "invalid CH_CFG_TIME_TYPES_SIZE specified, must be 16 or 32"
 123:../../../os/rt/include/chtime.h **** #endif
 124:../../../os/rt/include/chtime.h **** 
 125:../../../os/rt/include/chtime.h **** #if CH_CFG_INTERVALS_SIZE < CH_CFG_ST_RESOLUTION
 126:../../../os/rt/include/chtime.h **** #error "CH_CFG_INTERVALS_SIZE must be >= CH_CFG_ST_RESOLUTION"
 127:../../../os/rt/include/chtime.h **** #endif
 128:../../../os/rt/include/chtime.h **** 
 129:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 130:../../../os/rt/include/chtime.h **** /* Module data structures and types.                                         */
 131:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 132:../../../os/rt/include/chtime.h **** 
 133:../../../os/rt/include/chtime.h **** /**
 134:../../../os/rt/include/chtime.h ****  * @brief   Type of system time.
 135:../../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16, 32 or 64 bits.
 136:../../../os/rt/include/chtime.h ****  */
 137:../../../os/rt/include/chtime.h **** #if (CH_CFG_ST_RESOLUTION == 64) || defined(__DOXYGEN__)
 138:../../../os/rt/include/chtime.h **** typedef uint64_t systime_t;
 139:../../../os/rt/include/chtime.h **** #elif CH_CFG_ST_RESOLUTION == 32
 140:../../../os/rt/include/chtime.h **** typedef uint32_t systime_t;
 141:../../../os/rt/include/chtime.h **** #elif CH_CFG_ST_RESOLUTION == 16
 142:../../../os/rt/include/chtime.h **** typedef uint16_t systime_t;
 143:../../../os/rt/include/chtime.h **** #endif
 144:../../../os/rt/include/chtime.h **** 
 145:../../../os/rt/include/chtime.h **** /**
 146:../../../os/rt/include/chtime.h ****  * @brief   Type of time interval.
 147:../../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16, 32 or 64 bits.
 148:../../../os/rt/include/chtime.h ****  */
 149:../../../os/rt/include/chtime.h **** #if (CH_CFG_INTERVALS_SIZE == 64) || defined(__DOXYGEN__)
 150:../../../os/rt/include/chtime.h **** typedef uint64_t sysinterval_t;
 151:../../../os/rt/include/chtime.h **** #elif CH_CFG_INTERVALS_SIZE == 32
 152:../../../os/rt/include/chtime.h **** typedef uint32_t sysinterval_t;
 153:../../../os/rt/include/chtime.h **** #elif CH_CFG_INTERVALS_SIZE == 16
 154:../../../os/rt/include/chtime.h **** typedef uint16_t sysinterval_t;
 155:../../../os/rt/include/chtime.h **** #endif
 156:../../../os/rt/include/chtime.h **** 
 157:../../../os/rt/include/chtime.h **** #if (CH_CFG_TIME_TYPES_SIZE == 32) || defined(__DOXYGEN__)
 158:../../../os/rt/include/chtime.h **** /**
 159:../../../os/rt/include/chtime.h ****  * @brief   Type of seconds.
 160:../../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 161:../../../os/rt/include/chtime.h ****  */
 162:../../../os/rt/include/chtime.h **** typedef uint32_t time_secs_t;
 163:../../../os/rt/include/chtime.h **** 
 164:../../../os/rt/include/chtime.h **** /**
 165:../../../os/rt/include/chtime.h ****  * @brief   Type of milliseconds.
 166:../../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 167:../../../os/rt/include/chtime.h ****  */
 168:../../../os/rt/include/chtime.h **** typedef uint32_t time_msecs_t;
 169:../../../os/rt/include/chtime.h **** 
 170:../../../os/rt/include/chtime.h **** /**
 171:../../../os/rt/include/chtime.h ****  * @brief   Type of microseconds.
 172:../../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 173:../../../os/rt/include/chtime.h ****  */
 174:../../../os/rt/include/chtime.h **** typedef uint32_t time_usecs_t;
 175:../../../os/rt/include/chtime.h **** 
 176:../../../os/rt/include/chtime.h **** /**
 177:../../../os/rt/include/chtime.h ****  * @brief   Type of time conversion variable.
 178:../../../os/rt/include/chtime.h ****  * @note    This type must have double width than other time types, it is
 179:../../../os/rt/include/chtime.h ****  *          only used internally for conversions.
 180:../../../os/rt/include/chtime.h ****  */
 181:../../../os/rt/include/chtime.h **** typedef uint64_t time_conv_t;
 182:../../../os/rt/include/chtime.h **** 
 183:../../../os/rt/include/chtime.h **** #else
 184:../../../os/rt/include/chtime.h **** typedef uint16_t time_secs_t;
 185:../../../os/rt/include/chtime.h **** typedef uint16_t time_msecs_t;
 186:../../../os/rt/include/chtime.h **** typedef uint16_t time_usecs_t;
 187:../../../os/rt/include/chtime.h **** typedef uint32_t time_conv_t;
 188:../../../os/rt/include/chtime.h **** #endif
 189:../../../os/rt/include/chtime.h **** 
 190:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 191:../../../os/rt/include/chtime.h **** /* Module macros.                                                            */
 192:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 193:../../../os/rt/include/chtime.h **** 
 194:../../../os/rt/include/chtime.h **** 
 195:../../../os/rt/include/chtime.h **** /**
 196:../../../os/rt/include/chtime.h ****  * @name    Fast time conversion utilities
 197:../../../os/rt/include/chtime.h ****  * @{
 198:../../../os/rt/include/chtime.h ****  */
 199:../../../os/rt/include/chtime.h **** /**
 200:../../../os/rt/include/chtime.h ****  * @brief   Seconds to time interval.
 201:../../../os/rt/include/chtime.h ****  * @details Converts from seconds to system ticks number.
 202:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 203:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 204:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 205:../../../os/rt/include/chtime.h ****  *          converted.
 206:../../../os/rt/include/chtime.h ****  *
 207:../../../os/rt/include/chtime.h ****  * @param[in] secs      number of seconds
 208:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 209:../../../os/rt/include/chtime.h ****  *
 210:../../../os/rt/include/chtime.h ****  * @api
 211:../../../os/rt/include/chtime.h ****  */
 212:../../../os/rt/include/chtime.h **** #define TIME_S2I(secs)                                                      \
 213:../../../os/rt/include/chtime.h ****   ((sysinterval_t)((time_conv_t)(secs) * (time_conv_t)CH_CFG_ST_FREQUENCY))
 214:../../../os/rt/include/chtime.h **** 
 215:../../../os/rt/include/chtime.h **** /**
 216:../../../os/rt/include/chtime.h ****  * @brief   Milliseconds to time interval.
 217:../../../os/rt/include/chtime.h ****  * @details Converts from milliseconds to system ticks number.
 218:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 219:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 220:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 221:../../../os/rt/include/chtime.h ****  *          converted.
 222:../../../os/rt/include/chtime.h ****  *
 223:../../../os/rt/include/chtime.h ****  * @param[in] msecs     number of milliseconds
 224:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 225:../../../os/rt/include/chtime.h ****  *
 226:../../../os/rt/include/chtime.h ****  * @api
 227:../../../os/rt/include/chtime.h ****  */
 228:../../../os/rt/include/chtime.h **** #define TIME_MS2I(msecs)                                                    \
 229:../../../os/rt/include/chtime.h ****   ((sysinterval_t)((((time_conv_t)(msecs) *                                 \
 230:../../../os/rt/include/chtime.h ****                      (time_conv_t)CH_CFG_ST_FREQUENCY) +                    \
 231:../../../os/rt/include/chtime.h ****                     (time_conv_t)999) / (time_conv_t)1000))
 232:../../../os/rt/include/chtime.h **** 
 233:../../../os/rt/include/chtime.h **** /**
 234:../../../os/rt/include/chtime.h ****  * @brief   Microseconds to time interval.
 235:../../../os/rt/include/chtime.h ****  * @details Converts from microseconds to system ticks number.
 236:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 237:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 238:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 239:../../../os/rt/include/chtime.h ****  *          converted.
 240:../../../os/rt/include/chtime.h ****  *
 241:../../../os/rt/include/chtime.h ****  * @param[in] usecs     number of microseconds
 242:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 243:../../../os/rt/include/chtime.h ****  *
 244:../../../os/rt/include/chtime.h ****  * @api
 245:../../../os/rt/include/chtime.h ****  */
 246:../../../os/rt/include/chtime.h **** #define TIME_US2I(usecs)                                                    \
 247:../../../os/rt/include/chtime.h ****   ((sysinterval_t)((((time_conv_t)(usecs) *                                 \
 248:../../../os/rt/include/chtime.h ****                      (time_conv_t)CH_CFG_ST_FREQUENCY) +                    \
 249:../../../os/rt/include/chtime.h ****                     (time_conv_t)999999) / (time_conv_t)1000000))
 250:../../../os/rt/include/chtime.h **** 
 251:../../../os/rt/include/chtime.h **** /**
 252:../../../os/rt/include/chtime.h ****  * @brief   Time interval to seconds.
 253:../../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to seconds.
 254:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next second boundary.
 255:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 256:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 257:../../../os/rt/include/chtime.h ****  *          converted.
 258:../../../os/rt/include/chtime.h ****  *
 259:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 260:../../../os/rt/include/chtime.h ****  * @return              The number of seconds.
 261:../../../os/rt/include/chtime.h ****  *
 262:../../../os/rt/include/chtime.h ****  * @api
 263:../../../os/rt/include/chtime.h ****  */
 264:../../../os/rt/include/chtime.h **** #define TIME_I2S(interval)                                                  \
 265:../../../os/rt/include/chtime.h ****   (time_secs_t)(((time_conv_t)(interval) +                                  \
 266:../../../os/rt/include/chtime.h ****                  (time_conv_t)CH_CFG_ST_FREQUENCY -                         \
 267:../../../os/rt/include/chtime.h ****                  (time_conv_t)1) / (time_conv_t)CH_CFG_ST_FREQUENCY)
 268:../../../os/rt/include/chtime.h **** 
 269:../../../os/rt/include/chtime.h **** /**
 270:../../../os/rt/include/chtime.h ****  * @brief   Time interval to milliseconds.
 271:../../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to milliseconds.
 272:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next millisecond boundary.
 273:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 274:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 275:../../../os/rt/include/chtime.h ****  *          converted.
 276:../../../os/rt/include/chtime.h ****  *
 277:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 278:../../../os/rt/include/chtime.h ****  * @return              The number of milliseconds.
 279:../../../os/rt/include/chtime.h ****  *
 280:../../../os/rt/include/chtime.h ****  * @api
 281:../../../os/rt/include/chtime.h ****  */
 282:../../../os/rt/include/chtime.h **** #define TIME_I2MS(interval)                                                 \
 283:../../../os/rt/include/chtime.h ****   (time_msecs_t)((((time_conv_t)(interval) * (time_conv_t)1000) +           \
 284:../../../os/rt/include/chtime.h ****                   (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /      \
 285:../../../os/rt/include/chtime.h ****                  (time_conv_t)CH_CFG_ST_FREQUENCY)
 286:../../../os/rt/include/chtime.h **** 
 287:../../../os/rt/include/chtime.h **** /**
 288:../../../os/rt/include/chtime.h ****  * @brief   Time interval to microseconds.
 289:../../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to microseconds.
 290:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next microsecond boundary.
 291:../../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 292:../../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 293:../../../os/rt/include/chtime.h ****  *          converted.
 294:../../../os/rt/include/chtime.h ****  *
 295:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 296:../../../os/rt/include/chtime.h ****  * @return              The number of microseconds.
 297:../../../os/rt/include/chtime.h ****  *
 298:../../../os/rt/include/chtime.h ****  * @api
 299:../../../os/rt/include/chtime.h ****  */
 300:../../../os/rt/include/chtime.h **** #define TIME_I2US(interval)                                                 \
 301:../../../os/rt/include/chtime.h ****     (time_msecs_t)((((time_conv_t)(interval) * (time_conv_t)1000000) +      \
 302:../../../os/rt/include/chtime.h ****                     (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /    \
 303:../../../os/rt/include/chtime.h ****                    (time_conv_t)CH_CFG_ST_FREQUENCY)
 304:../../../os/rt/include/chtime.h **** /** @} */
 305:../../../os/rt/include/chtime.h **** 
 306:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 307:../../../os/rt/include/chtime.h **** /* External declarations.                                                    */
 308:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 309:../../../os/rt/include/chtime.h **** 
 310:../../../os/rt/include/chtime.h **** /*
 311:../../../os/rt/include/chtime.h ****  * Virtual Timers APIs.
 312:../../../os/rt/include/chtime.h ****  */
 313:../../../os/rt/include/chtime.h **** #ifdef __cplusplus
 314:../../../os/rt/include/chtime.h **** extern "C" {
 315:../../../os/rt/include/chtime.h **** #endif
 316:../../../os/rt/include/chtime.h **** 
 317:../../../os/rt/include/chtime.h **** #ifdef __cplusplus
 318:../../../os/rt/include/chtime.h **** }
 319:../../../os/rt/include/chtime.h **** #endif
 320:../../../os/rt/include/chtime.h **** 
 321:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 322:../../../os/rt/include/chtime.h **** /* Module inline functions.                                                  */
 323:../../../os/rt/include/chtime.h **** /*===========================================================================*/
 324:../../../os/rt/include/chtime.h **** 
 325:../../../os/rt/include/chtime.h **** /**
 326:../../../os/rt/include/chtime.h ****  * @name    Secure time conversion utilities
 327:../../../os/rt/include/chtime.h ****  * @{
 328:../../../os/rt/include/chtime.h ****  */
 329:../../../os/rt/include/chtime.h **** /**
 330:../../../os/rt/include/chtime.h ****  * @brief   Seconds to time interval.
 331:../../../os/rt/include/chtime.h ****  * @details Converts from seconds to system ticks number.
 332:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 333:../../../os/rt/include/chtime.h ****  *
 334:../../../os/rt/include/chtime.h ****  * @param[in] secs      number of seconds
 335:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 336:../../../os/rt/include/chtime.h ****  *
 337:../../../os/rt/include/chtime.h ****  * @special
 338:../../../os/rt/include/chtime.h ****  */
 339:../../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeS2I(time_secs_t secs) {
 340:../../../os/rt/include/chtime.h ****   time_conv_t ticks;
 341:../../../os/rt/include/chtime.h **** 
 342:../../../os/rt/include/chtime.h ****   ticks = (time_conv_t)secs * (time_conv_t)CH_CFG_ST_FREQUENCY;
 343:../../../os/rt/include/chtime.h **** 
 344:../../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 345:../../../os/rt/include/chtime.h ****               "conversion overflow");
 346:../../../os/rt/include/chtime.h **** 
 347:../../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 348:../../../os/rt/include/chtime.h **** }
 349:../../../os/rt/include/chtime.h **** 
 350:../../../os/rt/include/chtime.h **** /**
 351:../../../os/rt/include/chtime.h ****  * @brief   Milliseconds to time interval.
 352:../../../os/rt/include/chtime.h ****  * @details Converts from milliseconds to system ticks number.
 353:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 354:../../../os/rt/include/chtime.h ****  *
 355:../../../os/rt/include/chtime.h ****  * @param[in] msec      number of milliseconds
 356:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 357:../../../os/rt/include/chtime.h ****  *
 358:../../../os/rt/include/chtime.h ****  * @special
 359:../../../os/rt/include/chtime.h ****  */
 360:../../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeMS2I(time_msecs_t msec) {
 361:../../../os/rt/include/chtime.h ****   time_conv_t ticks;
 362:../../../os/rt/include/chtime.h **** 
 363:../../../os/rt/include/chtime.h ****   ticks = (((time_conv_t)msec * (time_conv_t)CH_CFG_ST_FREQUENCY) +
 364:../../../os/rt/include/chtime.h ****            (time_conv_t)999) / (time_conv_t)1000;
 365:../../../os/rt/include/chtime.h **** 
 366:../../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 367:../../../os/rt/include/chtime.h ****               "conversion overflow");
 368:../../../os/rt/include/chtime.h **** 
 369:../../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 370:../../../os/rt/include/chtime.h **** }
 371:../../../os/rt/include/chtime.h **** 
 372:../../../os/rt/include/chtime.h **** /**
 373:../../../os/rt/include/chtime.h ****  * @brief   Microseconds to time interval.
 374:../../../os/rt/include/chtime.h ****  * @details Converts from microseconds to system ticks number.
 375:../../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 376:../../../os/rt/include/chtime.h ****  *
 377:../../../os/rt/include/chtime.h ****  * @param[in] usec      number of microseconds
 378:../../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 379:../../../os/rt/include/chtime.h ****  *
 380:../../../os/rt/include/chtime.h ****  * @special
 381:../../../os/rt/include/chtime.h ****  */
 382:../../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeUS2I(time_usecs_t usec) {
 383:../../../os/rt/include/chtime.h ****   time_conv_t ticks;
 384:../../../os/rt/include/chtime.h **** 
 385:../../../os/rt/include/chtime.h ****   ticks = (((time_conv_t)usec * (time_conv_t)CH_CFG_ST_FREQUENCY) +
 386:../../../os/rt/include/chtime.h ****            (time_conv_t)999999) / (time_conv_t)1000000;
 387:../../../os/rt/include/chtime.h **** 
 388:../../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 389:../../../os/rt/include/chtime.h ****               "conversion overflow");
 390:../../../os/rt/include/chtime.h **** 
 391:../../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 392:../../../os/rt/include/chtime.h **** }
 393:../../../os/rt/include/chtime.h **** 
 394:../../../os/rt/include/chtime.h **** /**
 395:../../../os/rt/include/chtime.h ****  * @brief   Time interval to seconds.
 396:../../../os/rt/include/chtime.h ****  * @details Converts from system interval to seconds.
 397:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next second boundary.
 398:../../../os/rt/include/chtime.h ****  *
 399:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 400:../../../os/rt/include/chtime.h ****  * @return              The number of seconds.
 401:../../../os/rt/include/chtime.h ****  *
 402:../../../os/rt/include/chtime.h ****  * @special
 403:../../../os/rt/include/chtime.h ****  */
 404:../../../os/rt/include/chtime.h **** static inline time_secs_t chTimeI2S(sysinterval_t interval) {
 405:../../../os/rt/include/chtime.h ****   time_conv_t secs;
 406:../../../os/rt/include/chtime.h **** 
 407:../../../os/rt/include/chtime.h ****   secs = ((time_conv_t)interval +
 408:../../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY -
 409:../../../os/rt/include/chtime.h ****           (time_conv_t)1) / (time_conv_t)CH_CFG_ST_FREQUENCY;
 410:../../../os/rt/include/chtime.h **** 
 411:../../../os/rt/include/chtime.h ****   chDbgAssert(secs < (time_conv_t)((time_secs_t)-1),
 412:../../../os/rt/include/chtime.h ****               "conversion overflow");
 413:../../../os/rt/include/chtime.h **** 
 414:../../../os/rt/include/chtime.h ****   return (time_secs_t)secs;
 415:../../../os/rt/include/chtime.h **** }
 416:../../../os/rt/include/chtime.h **** 
 417:../../../os/rt/include/chtime.h **** /**
 418:../../../os/rt/include/chtime.h ****  * @brief   Time interval to milliseconds.
 419:../../../os/rt/include/chtime.h ****  * @details Converts from system interval to milliseconds.
 420:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next millisecond boundary.
 421:../../../os/rt/include/chtime.h ****  *
 422:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 423:../../../os/rt/include/chtime.h ****  * @return              The number of milliseconds.
 424:../../../os/rt/include/chtime.h ****  *
 425:../../../os/rt/include/chtime.h ****  * @special
 426:../../../os/rt/include/chtime.h ****  */
 427:../../../os/rt/include/chtime.h **** static inline time_msecs_t chTimeI2MS(sysinterval_t interval) {
 428:../../../os/rt/include/chtime.h ****   time_conv_t msecs;
 429:../../../os/rt/include/chtime.h **** 
 430:../../../os/rt/include/chtime.h ****   msecs = (((time_conv_t)interval * (time_conv_t)1000) +
 431:../../../os/rt/include/chtime.h ****            (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /
 432:../../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY;
 433:../../../os/rt/include/chtime.h **** 
 434:../../../os/rt/include/chtime.h ****   chDbgAssert(msecs < (time_conv_t)((time_msecs_t)-1),
 435:../../../os/rt/include/chtime.h ****               "conversion overflow");
 436:../../../os/rt/include/chtime.h **** 
 437:../../../os/rt/include/chtime.h ****   return (time_msecs_t)msecs;
 438:../../../os/rt/include/chtime.h **** }
 439:../../../os/rt/include/chtime.h **** 
 440:../../../os/rt/include/chtime.h **** /**
 441:../../../os/rt/include/chtime.h ****  * @brief   Time interval to microseconds.
 442:../../../os/rt/include/chtime.h ****  * @details Converts from system interval to microseconds.
 443:../../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next microsecond boundary.
 444:../../../os/rt/include/chtime.h ****  *
 445:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 446:../../../os/rt/include/chtime.h ****  * @return              The number of microseconds.
 447:../../../os/rt/include/chtime.h ****  *
 448:../../../os/rt/include/chtime.h ****  * @special
 449:../../../os/rt/include/chtime.h ****  */
 450:../../../os/rt/include/chtime.h **** static inline time_usecs_t chTimeI2US(sysinterval_t interval) {
 451:../../../os/rt/include/chtime.h ****   time_conv_t usecs;
 452:../../../os/rt/include/chtime.h **** 
 453:../../../os/rt/include/chtime.h ****   usecs = (((time_conv_t)interval * (time_conv_t)1000000) +
 454:../../../os/rt/include/chtime.h ****            (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /
 455:../../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY;
 456:../../../os/rt/include/chtime.h **** 
 457:../../../os/rt/include/chtime.h ****   chDbgAssert(usecs <= (time_conv_t)((time_usecs_t)-1),
 458:../../../os/rt/include/chtime.h ****               "conversion overflow");
 459:../../../os/rt/include/chtime.h **** 
 460:../../../os/rt/include/chtime.h ****   return (time_usecs_t)usecs;
 461:../../../os/rt/include/chtime.h **** }
 462:../../../os/rt/include/chtime.h **** 
 463:../../../os/rt/include/chtime.h **** /**
 464:../../../os/rt/include/chtime.h ****  * @brief   Adds an interval to a system time returning a system time.
 465:../../../os/rt/include/chtime.h ****  *
 466:../../../os/rt/include/chtime.h ****  * @param[in] systime   base system time
 467:../../../os/rt/include/chtime.h ****  * @param[in] interval  interval to be added
 468:../../../os/rt/include/chtime.h ****  * @return              The new system time.
 469:../../../os/rt/include/chtime.h ****  *
 470:../../../os/rt/include/chtime.h ****  * @xclass
 471:../../../os/rt/include/chtime.h ****  */
 472:../../../os/rt/include/chtime.h **** static inline systime_t chTimeAddX(systime_t systime,
 473:../../../os/rt/include/chtime.h ****                                    sysinterval_t interval) {
 474:../../../os/rt/include/chtime.h **** 
 475:../../../os/rt/include/chtime.h **** #if CH_CFG_ST_RESOLUTION != CH_CFG_INTERVALS_SIZE
 476:../../../os/rt/include/chtime.h ****   chDbgCheck(interval <= (sysinterval_t)((systime_t)-1));
 477:../../../os/rt/include/chtime.h **** #endif
 478:../../../os/rt/include/chtime.h **** 
 479:../../../os/rt/include/chtime.h ****   return systime + (systime_t)interval;
 908               		.loc 6 479 0
 909 0032 420E      		add r4,r18
 910 0034 531E      		adc r5,r19
 911               	.LVL51:
 912               	.LBE321:
 913               	.LBE320:
 914               	.LBE319:
 360:../../../os/hal/src/hal_buffers.c ****   size_t r = 0;
 915               		.loc 1 360 0
 916 0036 E12C      		mov r14,__zero_reg__
 917 0038 F12C      		mov r15,__zero_reg__
 918               	.LBB322:
 919               	.LBB323:
 361:../../../os/hal/src/hal_buffers.c ****   systime_t deadline;
 362:../../../os/hal/src/hal_buffers.c **** 
 363:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck(n > 0U);
 364:../../../os/hal/src/hal_buffers.c **** 
 365:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 366:../../../os/hal/src/hal_buffers.c **** 
 367:../../../os/hal/src/hal_buffers.c ****   /* Time window for the whole operation.*/
 368:../../../os/hal/src/hal_buffers.c ****   deadline = osalTimeAddX(osalOsGetSystemTimeX(), timeout);
 369:../../../os/hal/src/hal_buffers.c **** 
 370:../../../os/hal/src/hal_buffers.c ****   while (true) {
 371:../../../os/hal/src/hal_buffers.c ****     size_t size;
 372:../../../os/hal/src/hal_buffers.c **** 
 373:../../../os/hal/src/hal_buffers.c ****     /* This condition indicates that a new buffer must be acquired.*/
 374:../../../os/hal/src/hal_buffers.c ****     if (ibqp->ptr == NULL) {
 375:../../../os/hal/src/hal_buffers.c ****       msg_t msg;
 376:../../../os/hal/src/hal_buffers.c **** 
 377:../../../os/hal/src/hal_buffers.c ****       /* TIME_INFINITE and TIME_IMMEDIATE are handled differently, no
 378:../../../os/hal/src/hal_buffers.c ****          deadline.*/
 379:../../../os/hal/src/hal_buffers.c ****       if ((timeout == TIME_INFINITE) || (timeout == TIME_IMMEDIATE)) {
 920               		.loc 1 379 0
 921 003a 3901      		movw r6,r18
 922 003c 21E0      		ldi r18,1
 923 003e 621A      		sub r6,r18
 924 0040 7108      		sbc r7,__zero_reg__
 925               	.LVL52:
 926 0042 00C0      		rjmp .L55
 927               	.LVL53:
 928               	.L60:
 929               	.LBE323:
 380:../../../os/hal/src/hal_buffers.c ****         msg = ibqGetFullBufferTimeoutS(ibqp, timeout);
 381:../../../os/hal/src/hal_buffers.c ****       }
 382:../../../os/hal/src/hal_buffers.c ****       else {
 383:../../../os/hal/src/hal_buffers.c ****         sysinterval_t next_timeout = osalTimeDiffX(osalOsGetSystemTimeX(),
 384:../../../os/hal/src/hal_buffers.c ****                                                    deadline);
 385:../../../os/hal/src/hal_buffers.c **** 
 386:../../../os/hal/src/hal_buffers.c ****         /* Handling the case where the system time went past the deadline,
 387:../../../os/hal/src/hal_buffers.c ****            in this case next becomes a very high number because the system
 388:../../../os/hal/src/hal_buffers.c ****            time is an unsigned type.*/
 389:../../../os/hal/src/hal_buffers.c ****         if (next_timeout > timeout) {
 390:../../../os/hal/src/hal_buffers.c ****           osalSysUnlock();
 391:../../../os/hal/src/hal_buffers.c ****           return r;
 392:../../../os/hal/src/hal_buffers.c ****         }
 393:../../../os/hal/src/hal_buffers.c ****         msg = ibqGetFullBufferTimeoutS(ibqp, next_timeout);
 394:../../../os/hal/src/hal_buffers.c ****       }
 395:../../../os/hal/src/hal_buffers.c **** 
 396:../../../os/hal/src/hal_buffers.c ****       /* Anything except MSG_OK interrupts the operation.*/
 397:../../../os/hal/src/hal_buffers.c ****       if (msg != MSG_OK) {
 398:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 399:../../../os/hal/src/hal_buffers.c ****         return r;
 400:../../../os/hal/src/hal_buffers.c ****       }
 401:../../../os/hal/src/hal_buffers.c ****     }
 402:../../../os/hal/src/hal_buffers.c **** 
 403:../../../os/hal/src/hal_buffers.c ****     /* Size of the data chunk present in the current buffer.*/
 404:../../../os/hal/src/hal_buffers.c ****     size = (size_t)ibqp->top - (size_t)ibqp->ptr;
 405:../../../os/hal/src/hal_buffers.c ****     if (size > (n - r)) {
 406:../../../os/hal/src/hal_buffers.c ****       size = n - r;
 407:../../../os/hal/src/hal_buffers.c ****     }
 408:../../../os/hal/src/hal_buffers.c **** 
 409:../../../os/hal/src/hal_buffers.c ****     /* Smaller chunks in order to not make the critical zone too long,
 410:../../../os/hal/src/hal_buffers.c ****        this impacts throughput however.*/
 411:../../../os/hal/src/hal_buffers.c ****     if (size > 64U) {
 412:../../../os/hal/src/hal_buffers.c ****       /* Giving the compiler a chance to optimize for a fixed size move.*/
 413:../../../os/hal/src/hal_buffers.c ****       memcpy(bp, ibqp->ptr, 64U);
 930               		.loc 1 413 0
 931 0044 80E4      		ldi r24,lo8(64)
 932 0046 FB01      		movw r30,r22
 933 0048 D601      		movw r26,r12
 934               		0:
 935 004a 0190      		ld r0,Z+
 936 004c 0D92      		st X+,r0
 937 004e 8A95      		dec r24
 938 0050 01F4      		brne 0b
 414:../../../os/hal/src/hal_buffers.c ****       bp        += 64U;
 939               		.loc 1 414 0
 940 0052 20E4      		ldi r18,64
 941 0054 C20E      		add r12,r18
 942 0056 D11C      		adc r13,__zero_reg__
 943               	.LVL54:
 415:../../../os/hal/src/hal_buffers.c ****       ibqp->ptr += 64U;
 944               		.loc 1 415 0
 945 0058 8B89      		ldd r24,Y+19
 946 005a 9C89      		ldd r25,Y+20
 947 005c 805C      		subi r24,-64
 948 005e 9F4F      		sbci r25,-1
 949 0060 9C8B      		std Y+20,r25
 950 0062 8B8B      		std Y+19,r24
 416:../../../os/hal/src/hal_buffers.c ****       r         += 64U;
 951               		.loc 1 416 0
 952 0064 20E4      		ldi r18,64
 953 0066 E20E      		add r14,r18
 954 0068 F11C      		adc r15,__zero_reg__
 955               	.LVL55:
 956               	.L50:
 417:../../../os/hal/src/hal_buffers.c ****     }
 418:../../../os/hal/src/hal_buffers.c ****     else {
 419:../../../os/hal/src/hal_buffers.c ****       memcpy(bp, ibqp->ptr, size);
 420:../../../os/hal/src/hal_buffers.c ****       bp        += size;
 421:../../../os/hal/src/hal_buffers.c ****       ibqp->ptr += size;
 422:../../../os/hal/src/hal_buffers.c ****       r         += size;
 423:../../../os/hal/src/hal_buffers.c ****     }
 424:../../../os/hal/src/hal_buffers.c **** 
 425:../../../os/hal/src/hal_buffers.c ****     /* Has the current data buffer been finished? if so then release it.*/
 426:../../../os/hal/src/hal_buffers.c ****     if (ibqp->ptr >= ibqp->top) {
 957               		.loc 1 426 0
 958 006a 2D89      		ldd r18,Y+21
 959 006c 3E89      		ldd r19,Y+22
 960 006e 8217      		cp r24,r18
 961 0070 9307      		cpc r25,r19
 962 0072 00F0      		brlo .L52
 963               	.LVL56:
 964               	.LBB336:
 965               	.LBB337:
 275:../../../os/hal/src/hal_buffers.c ****   ibqp->brdptr += ibqp->bsize;
 966               		.loc 1 275 0
 967 0074 8D81      		ldd r24,Y+5
 968 0076 9E81      		ldd r25,Y+6
 969 0078 0197      		sbiw r24,1
 970 007a 9E83      		std Y+6,r25
 971 007c 8D83      		std Y+5,r24
 276:../../../os/hal/src/hal_buffers.c ****   if (ibqp->brdptr >= ibqp->btop) {
 972               		.loc 1 276 0
 973 007e 2985      		ldd r18,Y+9
 974 0080 3A85      		ldd r19,Y+10
 975 0082 8D85      		ldd r24,Y+13
 976 0084 9E85      		ldd r25,Y+14
 977 0086 820F      		add r24,r18
 978 0088 931F      		adc r25,r19
 979 008a 9A87      		std Y+10,r25
 980 008c 8987      		std Y+9,r24
 277:../../../os/hal/src/hal_buffers.c ****     ibqp->brdptr = ibqp->buffers;
 981               		.loc 1 277 0
 982 008e 2B85      		ldd r18,Y+11
 983 0090 3C85      		ldd r19,Y+12
 984 0092 8217      		cp r24,r18
 985 0094 9307      		cpc r25,r19
 986 0096 00F0      		brlo .L53
 278:../../../os/hal/src/hal_buffers.c ****   }
 987               		.loc 1 278 0
 988 0098 8989      		ldd r24,Y+17
 989 009a 9A89      		ldd r25,Y+18
 990 009c 9A87      		std Y+10,r25
 991 009e 8987      		std Y+9,r24
 992               	.L53:
 282:../../../os/hal/src/hal_buffers.c **** 
 993               		.loc 1 282 0
 994 00a0 1C8A      		std Y+20,__zero_reg__
 995 00a2 1B8A      		std Y+19,__zero_reg__
 285:../../../os/hal/src/hal_buffers.c ****     ibqp->notify(ibqp);
 996               		.loc 1 285 0
 997 00a4 EF89      		ldd r30,Y+23
 998 00a6 F88D      		ldd r31,Y+24
 999 00a8 3097      		sbiw r30,0
 1000 00aa 01F0      		breq .L52
 286:../../../os/hal/src/hal_buffers.c ****   }
 1001               		.loc 1 286 0
 1002 00ac CE01      		movw r24,r28
 1003 00ae 0995      		icall
 1004               	.LVL57:
 1005               	.L52:
 1006               	.LBE337:
 1007               	.LBE336:
 1008               	.LBB338:
 1009               	.LBB339:
 1010               	.LBB340:
 1011               	.LBB341:
 1012               	.LBB342:
 1013               		.loc 4 447 0
 1014               	/* #APP */
 1015               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1016 00b0 7894      		sei
 1017               	 ;  0 "" 2
 1018               	/* #NOAPP */
 1019               	.LBE342:
 1020               	.LBE341:
 1021               	.LBE340:
 1022               	.LBE339:
 1023               	.LBE338:
 427:../../../os/hal/src/hal_buffers.c ****       ibqReleaseEmptyBufferS(ibqp);
 428:../../../os/hal/src/hal_buffers.c ****     }
 429:../../../os/hal/src/hal_buffers.c **** 
 430:../../../os/hal/src/hal_buffers.c ****     /* Giving a preemption chance.*/
 431:../../../os/hal/src/hal_buffers.c ****     osalSysUnlock();
 432:../../../os/hal/src/hal_buffers.c ****     if (r >= n) {
 1024               		.loc 1 432 0
 1025 00b2 EA14      		cp r14,r10
 1026 00b4 FB04      		cpc r15,r11
 1027 00b6 00F0      		brlo .+2
 1028 00b8 00C0      		rjmp .L46
 1029               	.LBB343:
 1030               	.LBB344:
 1031               	.LBB345:
 1032               	.LBB346:
 437:../../../os/common/ports/AVR/chcore.h **** }
 1033               		.loc 4 437 0
 1034               	/* #APP */
 1035               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 1036 00ba F894      		cli
 1037               	 ;  0 "" 2
 1038               	.LVL58:
 1039               	/* #NOAPP */
 1040               	.L55:
 1041               	.LBE346:
 1042               	.LBE345:
 1043               	.LBE344:
 1044               	.LBE343:
 374:../../../os/hal/src/hal_buffers.c ****       msg_t msg;
 1045               		.loc 1 374 0
 1046 00bc 6B89      		ldd r22,Y+19
 1047 00be 7C89      		ldd r23,Y+20
 1048 00c0 6115      		cp r22,__zero_reg__
 1049 00c2 7105      		cpc r23,__zero_reg__
 1050 00c4 01F0      		breq .L59
 1051               	.L42:
 404:../../../os/hal/src/hal_buffers.c ****     if (size > (n - r)) {
 1052               		.loc 1 404 0
 1053 00c6 0D89      		ldd r16,Y+21
 1054 00c8 1E89      		ldd r17,Y+22
 1055               	.LVL59:
 405:../../../os/hal/src/hal_buffers.c ****       size = n - r;
 1056               		.loc 1 405 0
 1057 00ca C501      		movw r24,r10
 1058 00cc 8E19      		sub r24,r14
 1059 00ce 9F09      		sbc r25,r15
 1060 00d0 061B      		sub r16,r22
 1061 00d2 170B      		sbc r17,r23
 1062               	.LVL60:
 1063 00d4 8017      		cp r24,r16
 1064 00d6 9107      		cpc r25,r17
 1065 00d8 00F4      		brsh .L48
 1066 00da 8C01      		movw r16,r24
 1067               	.LVL61:
 1068               	.L48:
 411:../../../os/hal/src/hal_buffers.c ****       /* Giving the compiler a chance to optimize for a fixed size move.*/
 1069               		.loc 1 411 0
 1070 00dc 0134      		cpi r16,65
 1071 00de 1105      		cpc r17,__zero_reg__
 1072 00e0 00F0      		brlo .+2
 1073 00e2 00C0      		rjmp .L60
 419:../../../os/hal/src/hal_buffers.c ****       bp        += size;
 1074               		.loc 1 419 0
 1075 00e4 A801      		movw r20,r16
 1076 00e6 C601      		movw r24,r12
 1077 00e8 0E94 0000 		call memcpy
 1078               	.LVL62:
 420:../../../os/hal/src/hal_buffers.c ****       ibqp->ptr += size;
 1079               		.loc 1 420 0
 1080 00ec C00E      		add r12,r16
 1081 00ee D11E      		adc r13,r17
 1082               	.LVL63:
 421:../../../os/hal/src/hal_buffers.c ****       r         += size;
 1083               		.loc 1 421 0
 1084 00f0 8B89      		ldd r24,Y+19
 1085 00f2 9C89      		ldd r25,Y+20
 1086 00f4 800F      		add r24,r16
 1087 00f6 911F      		adc r25,r17
 1088 00f8 9C8B      		std Y+20,r25
 1089 00fa 8B8B      		std Y+19,r24
 422:../../../os/hal/src/hal_buffers.c ****     }
 1090               		.loc 1 422 0
 1091 00fc E00E      		add r14,r16
 1092 00fe F11E      		adc r15,r17
 1093               	.LVL64:
 1094 0100 00C0      		rjmp .L50
 1095               	.LVL65:
 1096               	.L59:
 1097               	.LBB347:
 379:../../../os/hal/src/hal_buffers.c ****         msg = ibqGetFullBufferTimeoutS(ibqp, timeout);
 1098               		.loc 1 379 0
 1099 0102 8EEF      		ldi r24,-2
 1100 0104 6816      		cp r6,r24
 1101 0106 8FEF      		ldi r24,-1
 1102 0108 7806      		cpc r7,r24
 1103 010a 00F4      		brsh .L61
 1104               	.LBB324:
 1105               	.LBB325:
 1106               	.LBB326:
 1107               	.LBB327:
 1108               		.loc 5 118 0
 1109 010c 8091 0000 		lds r24,ch+19
 1110 0110 9091 0000 		lds r25,ch+19+1
 1111               	.LVL66:
 1112               	.LBE327:
 1113               	.LBE326:
 1114               	.LBE325:
 1115               	.LBB328:
 1116               	.LBB329:
 1117               	.LBB330:
 480:../../../os/rt/include/chtime.h **** }
 481:../../../os/rt/include/chtime.h **** 
 482:../../../os/rt/include/chtime.h **** /**
 483:../../../os/rt/include/chtime.h ****  * @brief   Subtracts two system times returning an interval.
 484:../../../os/rt/include/chtime.h ****  *
 485:../../../os/rt/include/chtime.h ****  * @param[in] start     first system time
 486:../../../os/rt/include/chtime.h ****  * @param[in] end       second system time
 487:../../../os/rt/include/chtime.h ****  * @return              The interval representing the time difference.
 488:../../../os/rt/include/chtime.h ****  *
 489:../../../os/rt/include/chtime.h ****  * @xclass
 490:../../../os/rt/include/chtime.h ****  */
 491:../../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeDiffX(systime_t start, systime_t end) {
 492:../../../os/rt/include/chtime.h **** 
 493:../../../os/rt/include/chtime.h ****   /*lint -save -e9033 [10.8] This cast is required by the operation, it is
 494:../../../os/rt/include/chtime.h ****     known that the destination type can be wider.*/
 495:../../../os/rt/include/chtime.h ****   return (sysinterval_t)((systime_t)(end - start));
 1118               		.loc 6 495 0
 1119 0114 B201      		movw r22,r4
 1120 0116 681B      		sub r22,r24
 1121 0118 790B      		sbc r23,r25
 1122               	.LVL67:
 1123               	.LBE330:
 1124               	.LBE329:
 1125               	.LBE328:
 389:../../../os/hal/src/hal_buffers.c ****           osalSysUnlock();
 1126               		.loc 1 389 0
 1127 011a 8616      		cp r8,r22
 1128 011c 9706      		cpc r9,r23
 1129 011e 00F0      		brlo .L47
 393:../../../os/hal/src/hal_buffers.c ****       }
 1130               		.loc 1 393 0
 1131 0120 CE01      		movw r24,r28
 1132 0122 0E94 0000 		call ibqGetFullBufferTimeoutS
 1133               	.LVL68:
 1134               	.LBE324:
 397:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 1135               		.loc 1 397 0
 1136 0126 892B      		or r24,r25
 1137 0128 01F4      		brne .L47
 1138               	.L62:
 1139 012a 6B89      		ldd r22,Y+19
 1140 012c 7C89      		ldd r23,Y+20
 1141 012e 00C0      		rjmp .L42
 1142               	.LVL69:
 1143               	.L61:
 380:../../../os/hal/src/hal_buffers.c ****       }
 1144               		.loc 1 380 0
 1145 0130 B401      		movw r22,r8
 1146 0132 CE01      		movw r24,r28
 1147 0134 0E94 0000 		call ibqGetFullBufferTimeoutS
 1148               	.LVL70:
 397:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 1149               		.loc 1 397 0
 1150 0138 892B      		or r24,r25
 1151 013a 01F0      		breq .L62
 1152               	.LVL71:
 1153               	.L47:
 1154               	.LBB331:
 1155               	.LBB332:
 1156               	.LBB333:
 1157               	.LBB334:
 1158               	.LBB335:
 1159               		.loc 4 447 0
 1160               	/* #APP */
 1161               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1162 013c 7894      		sei
 1163               	 ;  0 "" 2
 1164               	/* #NOAPP */
 1165               	.L46:
 1166               	.LBE335:
 1167               	.LBE334:
 1168               	.LBE333:
 1169               	.LBE332:
 1170               	.LBE331:
 1171               	.LBE347:
 1172               	.LBE322:
 433:../../../os/hal/src/hal_buffers.c ****       return r;
 434:../../../os/hal/src/hal_buffers.c ****     }
 435:../../../os/hal/src/hal_buffers.c ****     osalSysLock();
 436:../../../os/hal/src/hal_buffers.c ****   }
 437:../../../os/hal/src/hal_buffers.c **** }
 1173               		.loc 1 437 0
 1174 013e C701      		movw r24,r14
 1175               	/* epilogue start */
 1176 0140 DF91      		pop r29
 1177 0142 CF91      		pop r28
 1178               	.LVL72:
 1179 0144 1F91      		pop r17
 1180 0146 0F91      		pop r16
 1181 0148 FF90      		pop r15
 1182 014a EF90      		pop r14
 1183               	.LVL73:
 1184 014c DF90      		pop r13
 1185 014e CF90      		pop r12
 1186               	.LVL74:
 1187 0150 BF90      		pop r11
 1188 0152 AF90      		pop r10
 1189               	.LVL75:
 1190 0154 9F90      		pop r9
 1191 0156 8F90      		pop r8
 1192               	.LVL76:
 1193 0158 7F90      		pop r7
 1194 015a 6F90      		pop r6
 1195               	.LVL77:
 1196 015c 5F90      		pop r5
 1197 015e 4F90      		pop r4
 1198 0160 0895      		ret
 1199               		.cfi_endproc
 1200               	.LFE177:
 1202               		.section	.text.obqObjectInit,"ax",@progbits
 1203               	.global	obqObjectInit
 1205               	obqObjectInit:
 1206               	.LFB178:
 438:../../../os/hal/src/hal_buffers.c **** 
 439:../../../os/hal/src/hal_buffers.c **** /**
 440:../../../os/hal/src/hal_buffers.c ****  * @brief   Initializes an output buffers queue object.
 441:../../../os/hal/src/hal_buffers.c ****  *
 442:../../../os/hal/src/hal_buffers.c ****  * @param[out] obqp     pointer to the @p output_buffers_queue_t object
 443:../../../os/hal/src/hal_buffers.c ****  * @param[in] suspended initial state of the queue
 444:../../../os/hal/src/hal_buffers.c ****  * @param[in] bp        pointer to a memory area allocated for buffers
 445:../../../os/hal/src/hal_buffers.c ****  * @param[in] size      buffers size
 446:../../../os/hal/src/hal_buffers.c ****  * @param[in] n         number of buffers
 447:../../../os/hal/src/hal_buffers.c ****  * @param[in] onfy      callback called when a buffer is posted in the queue
 448:../../../os/hal/src/hal_buffers.c ****  * @param[in] link      application defined pointer
 449:../../../os/hal/src/hal_buffers.c ****  *
 450:../../../os/hal/src/hal_buffers.c ****  * @init
 451:../../../os/hal/src/hal_buffers.c ****  */
 452:../../../os/hal/src/hal_buffers.c **** void obqObjectInit(output_buffers_queue_t *obqp, bool suspended, uint8_t *bp,
 453:../../../os/hal/src/hal_buffers.c ****                    size_t size, size_t n, bqnotify_t onfy, void *link) {
 1207               		.loc 1 453 0
 1208               		.cfi_startproc
 1209               	.LVL78:
 1210 0000 CF92      		push r12
 1211               	.LCFI30:
 1212               		.cfi_def_cfa_offset 3
 1213               		.cfi_offset 12, -2
 1214 0002 DF92      		push r13
 1215               	.LCFI31:
 1216               		.cfi_def_cfa_offset 4
 1217               		.cfi_offset 13, -3
 1218 0004 EF92      		push r14
 1219               	.LCFI32:
 1220               		.cfi_def_cfa_offset 5
 1221               		.cfi_offset 14, -4
 1222 0006 FF92      		push r15
 1223               	.LCFI33:
 1224               		.cfi_def_cfa_offset 6
 1225               		.cfi_offset 15, -5
 1226 0008 0F93      		push r16
 1227               	.LCFI34:
 1228               		.cfi_def_cfa_offset 7
 1229               		.cfi_offset 16, -6
 1230 000a 1F93      		push r17
 1231               	.LCFI35:
 1232               		.cfi_def_cfa_offset 8
 1233               		.cfi_offset 17, -7
 1234               	/* prologue: function */
 1235               	/* frame size = 0 */
 1236               	/* stack size = 6 */
 1237               	.L__stack_usage = 6
 1238 000c FC01      		movw r30,r24
 1239               	.LVL79:
 1240               	.LBB348:
 1241               	.LBB349:
 1242               	.LBB350:
 1243               	.LBB351:
 539:../../../os/rt/include/chschd.h ****   tqp->prev = (thread_t *)tqp;
 1244               		.loc 2 539 0
 1245 000e 9183      		std Z+1,r25
 1246 0010 8083      		st Z,r24
 1247               		.loc 2 540 0
 1248 0012 9383      		std Z+3,r25
 1249 0014 8283      		std Z+2,r24
 1250               	.LVL80:
 1251               	.LBE351:
 1252               	.LBE350:
 1253               	.LBE349:
 1254               	.LBE348:
 454:../../../os/hal/src/hal_buffers.c **** 
 455:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck((obqp != NULL) && (bp != NULL) && (size >= 2U));
 456:../../../os/hal/src/hal_buffers.c **** 
 457:../../../os/hal/src/hal_buffers.c ****   osalThreadQueueObjectInit(&obqp->waiting);
 458:../../../os/hal/src/hal_buffers.c ****   obqp->suspended = suspended;
 1255               		.loc 1 458 0
 1256 0016 6483      		std Z+4,r22
 459:../../../os/hal/src/hal_buffers.c ****   obqp->bcounter  = n;
 1257               		.loc 1 459 0
 1258 0018 1683      		std Z+6,r17
 1259 001a 0583      		std Z+5,r16
 460:../../../os/hal/src/hal_buffers.c ****   obqp->brdptr    = bp;
 1260               		.loc 1 460 0
 1261 001c 5287      		std Z+10,r21
 1262 001e 4187      		std Z+9,r20
 461:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr    = bp;
 1263               		.loc 1 461 0
 1264 0020 5087      		std Z+8,r21
 1265 0022 4783      		std Z+7,r20
 462:../../../os/hal/src/hal_buffers.c ****   obqp->btop      = bp + ((size + sizeof (size_t)) * n);
 1266               		.loc 1 462 0
 1267 0024 2E5F      		subi r18,-2
 1268 0026 3F4F      		sbci r19,-1
 1269               	.LVL81:
 1270 0028 029F      		mul r16,r18
 1271 002a C001      		movw r24,r0
 1272 002c 039F      		mul r16,r19
 1273 002e 900D      		add r25,r0
 1274 0030 129F      		mul r17,r18
 1275 0032 900D      		add r25,r0
 1276 0034 1124      		clr r1
 1277               	.LVL82:
 1278 0036 840F      		add r24,r20
 1279 0038 951F      		adc r25,r21
 1280 003a 9487      		std Z+12,r25
 1281 003c 8387      		std Z+11,r24
 463:../../../os/hal/src/hal_buffers.c ****   obqp->bsize     = size + sizeof (size_t);
 1282               		.loc 1 463 0
 1283 003e 3687      		std Z+14,r19
 1284 0040 2587      		std Z+13,r18
 464:../../../os/hal/src/hal_buffers.c ****   obqp->bn        = n;
 1285               		.loc 1 464 0
 1286 0042 108B      		std Z+16,r17
 1287 0044 0787      		std Z+15,r16
 465:../../../os/hal/src/hal_buffers.c ****   obqp->buffers   = bp;
 1288               		.loc 1 465 0
 1289 0046 528B      		std Z+18,r21
 1290 0048 418B      		std Z+17,r20
 466:../../../os/hal/src/hal_buffers.c ****   obqp->ptr       = NULL;
 1291               		.loc 1 466 0
 1292 004a 148A      		std Z+20,__zero_reg__
 1293 004c 138A      		std Z+19,__zero_reg__
 467:../../../os/hal/src/hal_buffers.c ****   obqp->top       = NULL;
 1294               		.loc 1 467 0
 1295 004e 168A      		std Z+22,__zero_reg__
 1296 0050 158A      		std Z+21,__zero_reg__
 468:../../../os/hal/src/hal_buffers.c ****   obqp->notify    = onfy;
 1297               		.loc 1 468 0
 1298 0052 F08E      		std Z+24,r15
 1299 0054 E78A      		std Z+23,r14
 469:../../../os/hal/src/hal_buffers.c ****   obqp->link      = link;
 1300               		.loc 1 469 0
 1301 0056 D28E      		std Z+26,r13
 1302 0058 C18E      		std Z+25,r12
 1303               	/* epilogue start */
 470:../../../os/hal/src/hal_buffers.c **** }
 1304               		.loc 1 470 0
 1305 005a 1F91      		pop r17
 1306 005c 0F91      		pop r16
 1307               	.LVL83:
 1308 005e FF90      		pop r15
 1309 0060 EF90      		pop r14
 1310               	.LVL84:
 1311 0062 DF90      		pop r13
 1312 0064 CF90      		pop r12
 1313               	.LVL85:
 1314 0066 0895      		ret
 1315               		.cfi_endproc
 1316               	.LFE178:
 1318               		.section	.text.obqResetI,"ax",@progbits
 1319               	.global	obqResetI
 1321               	obqResetI:
 1322               	.LFB179:
 471:../../../os/hal/src/hal_buffers.c **** 
 472:../../../os/hal/src/hal_buffers.c **** /**
 473:../../../os/hal/src/hal_buffers.c ****  * @brief   Resets an output buffers queue.
 474:../../../os/hal/src/hal_buffers.c ****  * @details All the data in the output buffers queue is erased and lost, any
 475:../../../os/hal/src/hal_buffers.c ****  *          waiting thread is resumed with status @p MSG_RESET.
 476:../../../os/hal/src/hal_buffers.c ****  * @note    A reset operation can be used by a low level driver in order to
 477:../../../os/hal/src/hal_buffers.c ****  *          obtain immediate attention from the high level layers.
 478:../../../os/hal/src/hal_buffers.c ****  *
 479:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 480:../../../os/hal/src/hal_buffers.c ****  *
 481:../../../os/hal/src/hal_buffers.c ****  * @iclass
 482:../../../os/hal/src/hal_buffers.c ****  */
 483:../../../os/hal/src/hal_buffers.c **** void obqResetI(output_buffers_queue_t *obqp) {
 1323               		.loc 1 483 0
 1324               		.cfi_startproc
 1325               	.LVL86:
 1326               	/* prologue: function */
 1327               	/* frame size = 0 */
 1328               	/* stack size = 0 */
 1329               	.L__stack_usage = 0
 1330 0000 FC01      		movw r30,r24
 484:../../../os/hal/src/hal_buffers.c **** 
 485:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 486:../../../os/hal/src/hal_buffers.c **** 
 487:../../../os/hal/src/hal_buffers.c ****   obqp->bcounter  = bqSizeX(obqp);
 1331               		.loc 1 487 0
 1332 0002 8785      		ldd r24,Z+15
 1333 0004 9089      		ldd r25,Z+16
 1334               	.LVL87:
 1335 0006 9683      		std Z+6,r25
 1336 0008 8583      		std Z+5,r24
 488:../../../os/hal/src/hal_buffers.c ****   obqp->brdptr    = obqp->buffers;
 1337               		.loc 1 488 0
 1338 000a 8189      		ldd r24,Z+17
 1339 000c 9289      		ldd r25,Z+18
 1340 000e 9287      		std Z+10,r25
 1341 0010 8187      		std Z+9,r24
 489:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr    = obqp->buffers;
 1342               		.loc 1 489 0
 1343 0012 9087      		std Z+8,r25
 1344 0014 8783      		std Z+7,r24
 490:../../../os/hal/src/hal_buffers.c ****   obqp->ptr       = NULL;
 1345               		.loc 1 490 0
 1346 0016 148A      		std Z+20,__zero_reg__
 1347 0018 138A      		std Z+19,__zero_reg__
 491:../../../os/hal/src/hal_buffers.c ****   obqp->top       = NULL;
 1348               		.loc 1 491 0
 1349 001a 168A      		std Z+22,__zero_reg__
 1350 001c 158A      		std Z+21,__zero_reg__
 1351               	.LVL88:
 1352               	.LBB352:
 1353               	.LBB353:
 1354               		.loc 3 857 0
 1355 001e 6EEF      		ldi r22,lo8(-2)
 1356 0020 7FEF      		ldi r23,lo8(-1)
 1357 0022 CF01      		movw r24,r30
 1358 0024 0C94 0000 		jmp chThdDequeueAllI
 1359               	.LVL89:
 1360               	.LBE353:
 1361               	.LBE352:
 1362               		.cfi_endproc
 1363               	.LFE179:
 1365               		.section	.text.obqGetFullBufferI,"ax",@progbits
 1366               	.global	obqGetFullBufferI
 1368               	obqGetFullBufferI:
 1369               	.LFB180:
 492:../../../os/hal/src/hal_buffers.c ****   osalThreadDequeueAllI(&obqp->waiting, MSG_RESET);
 493:../../../os/hal/src/hal_buffers.c **** }
 494:../../../os/hal/src/hal_buffers.c **** 
 495:../../../os/hal/src/hal_buffers.c **** /**
 496:../../../os/hal/src/hal_buffers.c ****  * @brief   Gets the next filled buffer from the queue.
 497:../../../os/hal/src/hal_buffers.c ****  * @note    The function always returns the same buffer if called repeatedly.
 498:../../../os/hal/src/hal_buffers.c ****  *
 499:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 500:../../../os/hal/src/hal_buffers.c ****  * @param[out] sizep    pointer to the filled buffer size
 501:../../../os/hal/src/hal_buffers.c ****  * @return              A pointer to the filled buffer.
 502:../../../os/hal/src/hal_buffers.c ****  * @retval NULL         if the queue is empty.
 503:../../../os/hal/src/hal_buffers.c ****  *
 504:../../../os/hal/src/hal_buffers.c ****  * @iclass
 505:../../../os/hal/src/hal_buffers.c ****  */
 506:../../../os/hal/src/hal_buffers.c **** uint8_t *obqGetFullBufferI(output_buffers_queue_t *obqp,
 507:../../../os/hal/src/hal_buffers.c ****                            size_t *sizep) {
 1370               		.loc 1 507 0
 1371               		.cfi_startproc
 1372               	.LVL90:
 1373               	/* prologue: function */
 1374               	/* frame size = 0 */
 1375               	/* stack size = 0 */
 1376               	.L__stack_usage = 0
 1377 0000 FC01      		movw r30,r24
 508:../../../os/hal/src/hal_buffers.c **** 
 509:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 510:../../../os/hal/src/hal_buffers.c **** 
 511:../../../os/hal/src/hal_buffers.c ****   if (obqIsEmptyI(obqp)) {
 1378               		.loc 1 511 0
 1379 0002 2185      		ldd r18,Z+9
 1380 0004 3285      		ldd r19,Z+10
 1381 0006 8781      		ldd r24,Z+7
 1382 0008 9085      		ldd r25,Z+8
 1383               	.LVL91:
 1384 000a 8217      		cp r24,r18
 1385 000c 9307      		cpc r25,r19
 1386 000e 01F0      		breq .L72
 1387               	.L66:
 512:../../../os/hal/src/hal_buffers.c ****     return NULL;
 513:../../../os/hal/src/hal_buffers.c ****   }
 514:../../../os/hal/src/hal_buffers.c **** 
 515:../../../os/hal/src/hal_buffers.c ****   /* Buffer size.*/
 516:../../../os/hal/src/hal_buffers.c ****   *sizep = *((size_t *)obqp->brdptr);
 1388               		.loc 1 516 0
 1389 0010 F901      		movw r30,r18
 1390               	.LVL92:
 1391 0012 2191      		ld r18,Z+
 1392 0014 3191      		ld r19,Z+
 1393 0016 CF01      		movw r24,r30
 1394 0018 FB01      		movw r30,r22
 1395 001a 3183      		std Z+1,r19
 1396 001c 2083      		st Z,r18
 517:../../../os/hal/src/hal_buffers.c **** 
 518:../../../os/hal/src/hal_buffers.c ****   return obqp->brdptr + sizeof (size_t);
 519:../../../os/hal/src/hal_buffers.c **** }
 1397               		.loc 1 519 0
 1398 001e 0895      		ret
 1399               	.LVL93:
 1400               	.L72:
 511:../../../os/hal/src/hal_buffers.c ****     return NULL;
 1401               		.loc 1 511 0 discriminator 1
 1402 0020 8581      		ldd r24,Z+5
 1403 0022 9681      		ldd r25,Z+6
 1404 0024 892B      		or r24,r25
 1405 0026 01F0      		breq .L66
 512:../../../os/hal/src/hal_buffers.c ****     return NULL;
 1406               		.loc 1 512 0
 1407 0028 80E0      		ldi r24,0
 1408 002a 90E0      		ldi r25,0
 1409 002c 0895      		ret
 1410               		.cfi_endproc
 1411               	.LFE180:
 1413               		.section	.text.obqReleaseEmptyBufferI,"ax",@progbits
 1414               	.global	obqReleaseEmptyBufferI
 1416               	obqReleaseEmptyBufferI:
 1417               	.LFB181:
 520:../../../os/hal/src/hal_buffers.c **** 
 521:../../../os/hal/src/hal_buffers.c **** /**
 522:../../../os/hal/src/hal_buffers.c ****  * @brief   Releases the next filled buffer back in the queue.
 523:../../../os/hal/src/hal_buffers.c ****  *
 524:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 525:../../../os/hal/src/hal_buffers.c ****  *
 526:../../../os/hal/src/hal_buffers.c ****  * @iclass
 527:../../../os/hal/src/hal_buffers.c ****  */
 528:../../../os/hal/src/hal_buffers.c **** void obqReleaseEmptyBufferI(output_buffers_queue_t *obqp) {
 1418               		.loc 1 528 0
 1419               		.cfi_startproc
 1420               	.LVL94:
 1421               	/* prologue: function */
 1422               	/* frame size = 0 */
 1423               	/* stack size = 0 */
 1424               	.L__stack_usage = 0
 1425 0000 FC01      		movw r30,r24
 529:../../../os/hal/src/hal_buffers.c **** 
 530:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 531:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!obqIsEmptyI(obqp), "buffers queue empty");
 532:../../../os/hal/src/hal_buffers.c **** 
 533:../../../os/hal/src/hal_buffers.c ****   /* Freeing a buffer slot in the queue.*/
 534:../../../os/hal/src/hal_buffers.c ****   obqp->bcounter++;
 1426               		.loc 1 534 0
 1427 0002 8581      		ldd r24,Z+5
 1428 0004 9681      		ldd r25,Z+6
 1429               	.LVL95:
 1430 0006 0196      		adiw r24,1
 1431 0008 9683      		std Z+6,r25
 1432 000a 8583      		std Z+5,r24
 535:../../../os/hal/src/hal_buffers.c ****   obqp->brdptr += obqp->bsize;
 1433               		.loc 1 535 0
 1434 000c 2185      		ldd r18,Z+9
 1435 000e 3285      		ldd r19,Z+10
 1436 0010 8585      		ldd r24,Z+13
 1437 0012 9685      		ldd r25,Z+14
 1438 0014 820F      		add r24,r18
 1439 0016 931F      		adc r25,r19
 1440 0018 9287      		std Z+10,r25
 1441 001a 8187      		std Z+9,r24
 536:../../../os/hal/src/hal_buffers.c ****   if (obqp->brdptr >= obqp->btop) {
 1442               		.loc 1 536 0
 1443 001c 2385      		ldd r18,Z+11
 1444 001e 3485      		ldd r19,Z+12
 1445 0020 8217      		cp r24,r18
 1446 0022 9307      		cpc r25,r19
 1447 0024 00F0      		brlo .L74
 537:../../../os/hal/src/hal_buffers.c ****     obqp->brdptr = obqp->buffers;
 1448               		.loc 1 537 0
 1449 0026 8189      		ldd r24,Z+17
 1450 0028 9289      		ldd r25,Z+18
 1451 002a 9287      		std Z+10,r25
 1452 002c 8187      		std Z+9,r24
 1453               	.L74:
 1454               	.LVL96:
 1455               	.LBB354:
 1456               	.LBB355:
 844:../../../os/hal/osal/rt/osal.h **** }
 1457               		.loc 3 844 0
 1458 002e 60E0      		ldi r22,0
 1459 0030 70E0      		ldi r23,0
 1460 0032 CF01      		movw r24,r30
 1461 0034 0C94 0000 		jmp chThdDequeueNextI
 1462               	.LVL97:
 1463               	.LBE355:
 1464               	.LBE354:
 1465               		.cfi_endproc
 1466               	.LFE181:
 1468               		.section	.text.obqGetEmptyBufferTimeoutS,"ax",@progbits
 1469               	.global	obqGetEmptyBufferTimeoutS
 1471               	obqGetEmptyBufferTimeoutS:
 1472               	.LFB183:
 538:../../../os/hal/src/hal_buffers.c ****   }
 539:../../../os/hal/src/hal_buffers.c **** 
 540:../../../os/hal/src/hal_buffers.c ****   /* Waking up one waiting thread, if any.*/
 541:../../../os/hal/src/hal_buffers.c ****   osalThreadDequeueNextI(&obqp->waiting, MSG_OK);
 542:../../../os/hal/src/hal_buffers.c **** }
 543:../../../os/hal/src/hal_buffers.c **** 
 544:../../../os/hal/src/hal_buffers.c **** /**
 545:../../../os/hal/src/hal_buffers.c ****  * @brief   Gets the next empty buffer from the queue.
 546:../../../os/hal/src/hal_buffers.c ****  * @note    The function always acquires the same buffer if called repeatedly.
 547:../../../os/hal/src/hal_buffers.c ****  * @post    After calling the function the fields @p ptr and @p top are set
 548:../../../os/hal/src/hal_buffers.c ****  *          at beginning and end of the buffer data or @p NULL if the queue
 549:../../../os/hal/src/hal_buffers.c ****  *          is empty.
 550:../../../os/hal/src/hal_buffers.c ****  *
 551:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 552:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 553:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 554:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 555:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 556:../../../os/hal/src/hal_buffers.c ****  *                      .
 557:../../../os/hal/src/hal_buffers.c ****  * @return              The operation status.
 558:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_OK       if a buffer has been acquired.
 559:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_TIMEOUT  if the specified time expired.
 560:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_RESET    if the queue has been reset or has been put in
 561:../../../os/hal/src/hal_buffers.c ****  *                      suspended state.
 562:../../../os/hal/src/hal_buffers.c ****  *
 563:../../../os/hal/src/hal_buffers.c ****  * @api
 564:../../../os/hal/src/hal_buffers.c ****  */
 565:../../../os/hal/src/hal_buffers.c **** msg_t obqGetEmptyBufferTimeout(output_buffers_queue_t *obqp,
 566:../../../os/hal/src/hal_buffers.c ****                                 sysinterval_t timeout) {
 567:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 568:../../../os/hal/src/hal_buffers.c **** 
 569:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 570:../../../os/hal/src/hal_buffers.c ****   msg = obqGetEmptyBufferTimeoutS(obqp, timeout);
 571:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 572:../../../os/hal/src/hal_buffers.c **** 
 573:../../../os/hal/src/hal_buffers.c ****   return msg;
 574:../../../os/hal/src/hal_buffers.c **** }
 575:../../../os/hal/src/hal_buffers.c **** 
 576:../../../os/hal/src/hal_buffers.c **** /**
 577:../../../os/hal/src/hal_buffers.c ****  * @brief   Gets the next empty buffer from the queue.
 578:../../../os/hal/src/hal_buffers.c ****  * @note    The function always acquires the same buffer if called repeatedly.
 579:../../../os/hal/src/hal_buffers.c ****  * @post    After calling the function the fields @p ptr and @p top are set
 580:../../../os/hal/src/hal_buffers.c ****  *          at beginning and end of the buffer data or @p NULL if the queue
 581:../../../os/hal/src/hal_buffers.c ****  *          is empty.
 582:../../../os/hal/src/hal_buffers.c ****  *
 583:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 584:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 585:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 586:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 587:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 588:../../../os/hal/src/hal_buffers.c ****  *                      .
 589:../../../os/hal/src/hal_buffers.c ****  * @return              The operation status.
 590:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_OK       if a buffer has been acquired.
 591:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_TIMEOUT  if the specified time expired.
 592:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_RESET    if the queue has been reset or has been put in
 593:../../../os/hal/src/hal_buffers.c ****  *                      suspended state.
 594:../../../os/hal/src/hal_buffers.c ****  *
 595:../../../os/hal/src/hal_buffers.c ****  * @sclass
 596:../../../os/hal/src/hal_buffers.c ****  */
 597:../../../os/hal/src/hal_buffers.c **** msg_t obqGetEmptyBufferTimeoutS(output_buffers_queue_t *obqp,
 598:../../../os/hal/src/hal_buffers.c ****                                 sysinterval_t timeout) {
 1473               		.loc 1 598 0
 1474               		.cfi_startproc
 1475               	.LVL98:
 1476 0000 0F93      		push r16
 1477               	.LCFI36:
 1478               		.cfi_def_cfa_offset 3
 1479               		.cfi_offset 16, -2
 1480 0002 1F93      		push r17
 1481               	.LCFI37:
 1482               		.cfi_def_cfa_offset 4
 1483               		.cfi_offset 17, -3
 1484 0004 CF93      		push r28
 1485               	.LCFI38:
 1486               		.cfi_def_cfa_offset 5
 1487               		.cfi_offset 28, -4
 1488 0006 DF93      		push r29
 1489               	.LCFI39:
 1490               		.cfi_def_cfa_offset 6
 1491               		.cfi_offset 29, -5
 1492               	/* prologue: function */
 1493               	/* frame size = 0 */
 1494               	/* stack size = 4 */
 1495               	.L__stack_usage = 4
 1496 0008 EC01      		movw r28,r24
 1497 000a 8B01      		movw r16,r22
 599:../../../os/hal/src/hal_buffers.c **** 
 600:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassS();
 601:../../../os/hal/src/hal_buffers.c **** 
 602:../../../os/hal/src/hal_buffers.c ****   while (obqIsFullI(obqp)) {
 1498               		.loc 1 602 0
 1499 000c 00C0      		rjmp .L76
 1500               	.LVL99:
 1501               	.L78:
 1502               	.LBB364:
 603:../../../os/hal/src/hal_buffers.c ****     if (obqp->suspended) {
 1503               		.loc 1 603 0
 1504 000e 8C81      		ldd r24,Y+4
 1505 0010 8111      		cpse r24,__zero_reg__
 1506 0012 00C0      		rjmp .L79
 1507               	.LVL100:
 1508               	.LBB365:
 1509               	.LBB366:
 831:../../../os/hal/osal/rt/osal.h **** }
 1510               		.loc 3 831 0
 1511 0014 B801      		movw r22,r16
 1512 0016 CE01      		movw r24,r28
 1513 0018 0E94 0000 		call chThdEnqueueTimeoutS
 1514               	.LVL101:
 1515               	.LBE366:
 1516               	.LBE365:
 604:../../../os/hal/src/hal_buffers.c ****       return MSG_RESET;
 605:../../../os/hal/src/hal_buffers.c ****     }
 606:../../../os/hal/src/hal_buffers.c ****     msg_t msg = osalThreadEnqueueTimeoutS(&obqp->waiting, timeout);
 607:../../../os/hal/src/hal_buffers.c ****     if (msg < MSG_OK) {
 1517               		.loc 1 607 0
 1518 001c 97FD      		sbrc r25,7
 1519 001e 00C0      		rjmp .L77
 1520               	.L76:
 1521               	.LBE364:
 602:../../../os/hal/src/hal_buffers.c ****     if (obqp->suspended) {
 1522               		.loc 1 602 0
 1523 0020 8D81      		ldd r24,Y+5
 1524 0022 9E81      		ldd r25,Y+6
 1525 0024 892B      		or r24,r25
 1526 0026 01F0      		breq .L78
 1527               	.LVL102:
 1528               	.LBB367:
 1529               	.LBB368:
 608:../../../os/hal/src/hal_buffers.c ****       return msg;
 609:../../../os/hal/src/hal_buffers.c ****     }
 610:../../../os/hal/src/hal_buffers.c ****   }
 611:../../../os/hal/src/hal_buffers.c **** 
 612:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!obqIsFullI(obqp), "still full");
 613:../../../os/hal/src/hal_buffers.c **** 
 614:../../../os/hal/src/hal_buffers.c ****   /* Setting up the "current" buffer and its boundary.*/
 615:../../../os/hal/src/hal_buffers.c ****   obqp->ptr = obqp->bwrptr + sizeof (size_t);
 1530               		.loc 1 615 0
 1531 0028 2F81      		ldd r18,Y+7
 1532 002a 3885      		ldd r19,Y+8
 1533 002c C901      		movw r24,r18
 1534 002e 0296      		adiw r24,2
 1535 0030 9C8B      		std Y+20,r25
 1536 0032 8B8B      		std Y+19,r24
 616:../../../os/hal/src/hal_buffers.c ****   obqp->top = obqp->bwrptr + obqp->bsize;
 1537               		.loc 1 616 0
 1538 0034 8D85      		ldd r24,Y+13
 1539 0036 9E85      		ldd r25,Y+14
 1540 0038 820F      		add r24,r18
 1541 003a 931F      		adc r25,r19
 1542 003c 9E8B      		std Y+22,r25
 1543 003e 8D8B      		std Y+21,r24
 1544               	.LVL103:
 1545 0040 80E0      		ldi r24,0
 1546 0042 90E0      		ldi r25,0
 1547               	.L77:
 1548               	/* epilogue start */
 1549               	.LBE368:
 1550               	.LBE367:
 617:../../../os/hal/src/hal_buffers.c **** 
 618:../../../os/hal/src/hal_buffers.c ****   return MSG_OK;
 619:../../../os/hal/src/hal_buffers.c **** }
 1551               		.loc 1 619 0
 1552 0044 DF91      		pop r29
 1553 0046 CF91      		pop r28
 1554               	.LVL104:
 1555 0048 1F91      		pop r17
 1556 004a 0F91      		pop r16
 1557               	.LVL105:
 1558 004c 0895      		ret
 1559               	.LVL106:
 1560               	.L79:
 1561               	.LBB369:
 604:../../../os/hal/src/hal_buffers.c ****     }
 1562               		.loc 1 604 0
 1563 004e 8EEF      		ldi r24,lo8(-2)
 1564 0050 9FEF      		ldi r25,lo8(-1)
 1565               	/* epilogue start */
 1566               	.LBE369:
 1567               		.loc 1 619 0
 1568 0052 DF91      		pop r29
 1569 0054 CF91      		pop r28
 1570               	.LVL107:
 1571 0056 1F91      		pop r17
 1572 0058 0F91      		pop r16
 1573               	.LVL108:
 1574 005a 0895      		ret
 1575               		.cfi_endproc
 1576               	.LFE183:
 1578               		.section	.text.obqGetEmptyBufferTimeout,"ax",@progbits
 1579               	.global	obqGetEmptyBufferTimeout
 1581               	obqGetEmptyBufferTimeout:
 1582               	.LFB182:
 566:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 1583               		.loc 1 566 0
 1584               		.cfi_startproc
 1585               	.LVL109:
 1586               	/* prologue: function */
 1587               	/* frame size = 0 */
 1588               	/* stack size = 0 */
 1589               	.L__stack_usage = 0
 1590               	.LBB370:
 1591               	.LBB371:
 1592               	.LBB372:
 1593               	.LBB373:
 437:../../../os/common/ports/AVR/chcore.h **** }
 1594               		.loc 4 437 0
 1595               	/* #APP */
 1596               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 1597 0000 F894      		cli
 1598               	 ;  0 "" 2
 1599               	/* #NOAPP */
 1600               	.LBE373:
 1601               	.LBE372:
 1602               	.LBE371:
 1603               	.LBE370:
 570:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 1604               		.loc 1 570 0
 1605 0002 0E94 0000 		call obqGetEmptyBufferTimeoutS
 1606               	.LVL110:
 1607               	.LBB374:
 1608               	.LBB375:
 1609               	.LBB376:
 1610               	.LBB377:
 1611               	.LBB378:
 1612               		.loc 4 447 0
 1613               	/* #APP */
 1614               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1615 0006 7894      		sei
 1616               	 ;  0 "" 2
 1617               	/* #NOAPP */
 1618               	.LBE378:
 1619               	.LBE377:
 1620               	.LBE376:
 1621               	.LBE375:
 1622               	.LBE374:
 574:../../../os/hal/src/hal_buffers.c **** 
 1623               		.loc 1 574 0
 1624 0008 0895      		ret
 1625               		.cfi_endproc
 1626               	.LFE182:
 1628               		.section	.text.obqPostFullBuffer,"ax",@progbits
 1629               	.global	obqPostFullBuffer
 1631               	obqPostFullBuffer:
 1632               	.LFB184:
 620:../../../os/hal/src/hal_buffers.c **** 
 621:../../../os/hal/src/hal_buffers.c **** /**
 622:../../../os/hal/src/hal_buffers.c ****  * @brief   Posts a new filled buffer to the queue.
 623:../../../os/hal/src/hal_buffers.c ****  * @note    The object callback is called after releasing the buffer.
 624:../../../os/hal/src/hal_buffers.c ****  *
 625:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 626:../../../os/hal/src/hal_buffers.c ****  * @param[in] size      used size of the buffer, cannot be zero
 627:../../../os/hal/src/hal_buffers.c ****  *
 628:../../../os/hal/src/hal_buffers.c ****  * @api
 629:../../../os/hal/src/hal_buffers.c ****  */
 630:../../../os/hal/src/hal_buffers.c **** void obqPostFullBuffer(output_buffers_queue_t *obqp, size_t size) {
 1633               		.loc 1 630 0
 1634               		.cfi_startproc
 1635               	.LVL111:
 1636               	/* prologue: function */
 1637               	/* frame size = 0 */
 1638               	/* stack size = 0 */
 1639               	.L__stack_usage = 0
 1640 0000 DC01      		movw r26,r24
 1641               	.LBB379:
 1642               	.LBB380:
 1643               	.LBB381:
 1644               	.LBB382:
 437:../../../os/common/ports/AVR/chcore.h **** }
 1645               		.loc 4 437 0
 1646               	/* #APP */
 1647               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 1648 0002 F894      		cli
 1649               	 ;  0 "" 2
 1650               	.LVL112:
 1651               	/* #NOAPP */
 1652               	.LBE382:
 1653               	.LBE381:
 1654               	.LBE380:
 1655               	.LBE379:
 1656               	.LBB383:
 1657               	.LBB384:
 631:../../../os/hal/src/hal_buffers.c **** 
 632:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 633:../../../os/hal/src/hal_buffers.c ****   obqPostFullBufferS(obqp, size);
 634:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 635:../../../os/hal/src/hal_buffers.c **** }
 636:../../../os/hal/src/hal_buffers.c **** 
 637:../../../os/hal/src/hal_buffers.c **** /**
 638:../../../os/hal/src/hal_buffers.c ****  * @brief   Posts a new filled buffer to the queue.
 639:../../../os/hal/src/hal_buffers.c ****  * @note    The object callback is called after releasing the buffer.
 640:../../../os/hal/src/hal_buffers.c ****  *
 641:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 642:../../../os/hal/src/hal_buffers.c ****  * @param[in] size      used size of the buffer, cannot be zero
 643:../../../os/hal/src/hal_buffers.c ****  *
 644:../../../os/hal/src/hal_buffers.c ****  * @sclass
 645:../../../os/hal/src/hal_buffers.c ****  */
 646:../../../os/hal/src/hal_buffers.c **** void obqPostFullBufferS(output_buffers_queue_t *obqp, size_t size) {
 647:../../../os/hal/src/hal_buffers.c **** 
 648:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassS();
 649:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck((size > 0U) && (size <= (obqp->bsize - sizeof (size_t))));
 650:../../../os/hal/src/hal_buffers.c ****   osalDbgAssert(!obqIsFullI(obqp), "buffers queue full");
 651:../../../os/hal/src/hal_buffers.c **** 
 652:../../../os/hal/src/hal_buffers.c ****   /* Writing size field in the buffer.*/
 653:../../../os/hal/src/hal_buffers.c ****   *((size_t *)obqp->bwrptr) = size;
 1658               		.loc 1 653 0
 1659 0004 1796      		adiw r26,7
 1660 0006 ED91      		ld r30,X+
 1661 0008 FC91      		ld r31,X
 1662 000a 1897      		sbiw r26,7+1
 1663 000c 7183      		std Z+1,r23
 1664 000e 6083      		st Z,r22
 654:../../../os/hal/src/hal_buffers.c **** 
 655:../../../os/hal/src/hal_buffers.c ****   /* Posting the buffer in the queue.*/
 656:../../../os/hal/src/hal_buffers.c ****   obqp->bcounter--;
 1665               		.loc 1 656 0
 1666 0010 1596      		adiw r26,5
 1667 0012 2D91      		ld r18,X+
 1668 0014 3C91      		ld r19,X
 1669 0016 1697      		sbiw r26,5+1
 1670 0018 2150      		subi r18,1
 1671 001a 3109      		sbc r19,__zero_reg__
 1672 001c 1696      		adiw r26,5+1
 1673 001e 3C93      		st X,r19
 1674 0020 2E93      		st -X,r18
 1675 0022 1597      		sbiw r26,5
 657:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr += obqp->bsize;
 1676               		.loc 1 657 0
 1677 0024 1D96      		adiw r26,13
 1678 0026 8D91      		ld r24,X+
 1679 0028 9C91      		ld r25,X
 1680 002a 1E97      		sbiw r26,13+1
 1681               	.LVL113:
 1682 002c 8E0F      		add r24,r30
 1683 002e 9F1F      		adc r25,r31
 1684 0030 1896      		adiw r26,7+1
 1685 0032 9C93      		st X,r25
 1686 0034 8E93      		st -X,r24
 1687 0036 1797      		sbiw r26,7
 658:../../../os/hal/src/hal_buffers.c ****   if (obqp->bwrptr >= obqp->btop) {
 1688               		.loc 1 658 0
 1689 0038 1B96      		adiw r26,11
 1690 003a 2D91      		ld r18,X+
 1691 003c 3C91      		ld r19,X
 1692 003e 1C97      		sbiw r26,11+1
 1693 0040 8217      		cp r24,r18
 1694 0042 9307      		cpc r25,r19
 1695 0044 00F0      		brlo .L82
 659:../../../os/hal/src/hal_buffers.c ****     obqp->bwrptr = obqp->buffers;
 1696               		.loc 1 659 0
 1697 0046 5196      		adiw r26,17
 1698 0048 8D91      		ld r24,X+
 1699 004a 9C91      		ld r25,X
 1700 004c 5297      		sbiw r26,17+1
 1701 004e 1896      		adiw r26,7+1
 1702 0050 9C93      		st X,r25
 1703 0052 8E93      		st -X,r24
 1704 0054 1797      		sbiw r26,7
 1705               	.L82:
 660:../../../os/hal/src/hal_buffers.c ****   }
 661:../../../os/hal/src/hal_buffers.c **** 
 662:../../../os/hal/src/hal_buffers.c ****   /* No "current" buffer.*/
 663:../../../os/hal/src/hal_buffers.c ****   obqp->ptr = NULL;
 1706               		.loc 1 663 0
 1707 0056 5496      		adiw r26,19+1
 1708 0058 1C92      		st X,__zero_reg__
 1709 005a 1E92      		st -X,__zero_reg__
 1710 005c 5397      		sbiw r26,19
 664:../../../os/hal/src/hal_buffers.c **** 
 665:../../../os/hal/src/hal_buffers.c ****   /* Notifying the buffer release.*/
 666:../../../os/hal/src/hal_buffers.c ****   if (obqp->notify != NULL) {
 1711               		.loc 1 666 0
 1712 005e 5796      		adiw r26,23
 1713 0060 ED91      		ld r30,X+
 1714 0062 FC91      		ld r31,X
 1715 0064 5897      		sbiw r26,23+1
 1716 0066 3097      		sbiw r30,0
 1717 0068 01F0      		breq .L83
 1718 006a CD01      		movw r24,r26
 667:../../../os/hal/src/hal_buffers.c ****     obqp->notify(obqp);
 1719               		.loc 1 667 0
 1720 006c 0995      		icall
 1721               	.LVL114:
 1722               	.L83:
 1723               	.LBE384:
 1724               	.LBE383:
 1725               	.LBB385:
 1726               	.LBB386:
 1727               	.LBB387:
 1728               	.LBB388:
 1729               	.LBB389:
 1730               		.loc 4 447 0
 1731               	/* #APP */
 1732               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1733 006e 7894      		sei
 1734               	 ;  0 "" 2
 1735               	/* #NOAPP */
 1736 0070 0895      		ret
 1737               	.LBE389:
 1738               	.LBE388:
 1739               	.LBE387:
 1740               	.LBE386:
 1741               	.LBE385:
 1742               		.cfi_endproc
 1743               	.LFE184:
 1745               		.section	.text.obqPostFullBufferS,"ax",@progbits
 1746               	.global	obqPostFullBufferS
 1748               	obqPostFullBufferS:
 1749               	.LFB185:
 646:../../../os/hal/src/hal_buffers.c **** 
 1750               		.loc 1 646 0
 1751               		.cfi_startproc
 1752               	.LVL115:
 1753               	/* prologue: function */
 1754               	/* frame size = 0 */
 1755               	/* stack size = 0 */
 1756               	.L__stack_usage = 0
 1757 0000 DC01      		movw r26,r24
 653:../../../os/hal/src/hal_buffers.c **** 
 1758               		.loc 1 653 0
 1759 0002 1796      		adiw r26,7
 1760 0004 ED91      		ld r30,X+
 1761 0006 FC91      		ld r31,X
 1762 0008 1897      		sbiw r26,7+1
 1763 000a 7183      		std Z+1,r23
 1764 000c 6083      		st Z,r22
 656:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr += obqp->bsize;
 1765               		.loc 1 656 0
 1766 000e 1596      		adiw r26,5
 1767 0010 2D91      		ld r18,X+
 1768 0012 3C91      		ld r19,X
 1769 0014 1697      		sbiw r26,5+1
 1770 0016 2150      		subi r18,1
 1771 0018 3109      		sbc r19,__zero_reg__
 1772 001a 1696      		adiw r26,5+1
 1773 001c 3C93      		st X,r19
 1774 001e 2E93      		st -X,r18
 1775 0020 1597      		sbiw r26,5
 657:../../../os/hal/src/hal_buffers.c ****   if (obqp->bwrptr >= obqp->btop) {
 1776               		.loc 1 657 0
 1777 0022 1D96      		adiw r26,13
 1778 0024 8D91      		ld r24,X+
 1779 0026 9C91      		ld r25,X
 1780 0028 1E97      		sbiw r26,13+1
 1781               	.LVL116:
 1782 002a 8E0F      		add r24,r30
 1783 002c 9F1F      		adc r25,r31
 1784 002e 1896      		adiw r26,7+1
 1785 0030 9C93      		st X,r25
 1786 0032 8E93      		st -X,r24
 1787 0034 1797      		sbiw r26,7
 658:../../../os/hal/src/hal_buffers.c ****     obqp->bwrptr = obqp->buffers;
 1788               		.loc 1 658 0
 1789 0036 1B96      		adiw r26,11
 1790 0038 2D91      		ld r18,X+
 1791 003a 3C91      		ld r19,X
 1792 003c 1C97      		sbiw r26,11+1
 1793 003e 8217      		cp r24,r18
 1794 0040 9307      		cpc r25,r19
 1795 0042 00F0      		brlo .L88
 659:../../../os/hal/src/hal_buffers.c ****   }
 1796               		.loc 1 659 0
 1797 0044 5196      		adiw r26,17
 1798 0046 8D91      		ld r24,X+
 1799 0048 9C91      		ld r25,X
 1800 004a 5297      		sbiw r26,17+1
 1801 004c 1896      		adiw r26,7+1
 1802 004e 9C93      		st X,r25
 1803 0050 8E93      		st -X,r24
 1804 0052 1797      		sbiw r26,7
 1805               	.L88:
 663:../../../os/hal/src/hal_buffers.c **** 
 1806               		.loc 1 663 0
 1807 0054 5496      		adiw r26,19+1
 1808 0056 1C92      		st X,__zero_reg__
 1809 0058 1E92      		st -X,__zero_reg__
 1810 005a 5397      		sbiw r26,19
 666:../../../os/hal/src/hal_buffers.c ****     obqp->notify(obqp);
 1811               		.loc 1 666 0
 1812 005c 5796      		adiw r26,23
 1813 005e ED91      		ld r30,X+
 1814 0060 FC91      		ld r31,X
 1815 0062 5897      		sbiw r26,23+1
 1816 0064 3097      		sbiw r30,0
 1817 0066 01F0      		breq .L87
 1818               		.loc 1 667 0
 1819 0068 CD01      		movw r24,r26
 1820 006a 0994      		ijmp
 1821               	.LVL117:
 1822               	.L87:
 1823 006c 0895      		ret
 1824               		.cfi_endproc
 1825               	.LFE185:
 1827               		.section	.text.obqPutTimeout,"ax",@progbits
 1828               	.global	obqPutTimeout
 1830               	obqPutTimeout:
 1831               	.LFB186:
 668:../../../os/hal/src/hal_buffers.c ****   }
 669:../../../os/hal/src/hal_buffers.c **** }
 670:../../../os/hal/src/hal_buffers.c **** 
 671:../../../os/hal/src/hal_buffers.c **** /**
 672:../../../os/hal/src/hal_buffers.c ****  * @brief   Output queue write with timeout.
 673:../../../os/hal/src/hal_buffers.c ****  * @details This function writes a byte value to an output queue. If
 674:../../../os/hal/src/hal_buffers.c ****  *          the queue is full then the calling thread is suspended until a
 675:../../../os/hal/src/hal_buffers.c ****  *          new buffer is freed in the queue or a timeout occurs.
 676:../../../os/hal/src/hal_buffers.c ****  *
 677:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 678:../../../os/hal/src/hal_buffers.c ****  * @param[in] b         byte value to be transferred
 679:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 680:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 681:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 682:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 683:../../../os/hal/src/hal_buffers.c ****  *                      .
 684:../../../os/hal/src/hal_buffers.c ****  * @return              A byte value from the queue.
 685:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_TIMEOUT  if the specified time expired.
 686:../../../os/hal/src/hal_buffers.c ****  * @retval MSG_RESET    if the queue has been reset or has been put in
 687:../../../os/hal/src/hal_buffers.c ****  *                      suspended state.
 688:../../../os/hal/src/hal_buffers.c ****  *
 689:../../../os/hal/src/hal_buffers.c ****  * @api
 690:../../../os/hal/src/hal_buffers.c ****  */
 691:../../../os/hal/src/hal_buffers.c **** msg_t obqPutTimeout(output_buffers_queue_t *obqp, uint8_t b,
 692:../../../os/hal/src/hal_buffers.c ****                     sysinterval_t timeout) {
 1832               		.loc 1 692 0
 1833               		.cfi_startproc
 1834               	.LVL118:
 1835 0000 1F93      		push r17
 1836               	.LCFI40:
 1837               		.cfi_def_cfa_offset 3
 1838               		.cfi_offset 17, -2
 1839 0002 CF93      		push r28
 1840               	.LCFI41:
 1841               		.cfi_def_cfa_offset 4
 1842               		.cfi_offset 28, -3
 1843 0004 DF93      		push r29
 1844               	.LCFI42:
 1845               		.cfi_def_cfa_offset 5
 1846               		.cfi_offset 29, -4
 1847               	/* prologue: function */
 1848               	/* frame size = 0 */
 1849               	/* stack size = 3 */
 1850               	.L__stack_usage = 3
 1851 0006 EC01      		movw r28,r24
 1852 0008 162F      		mov r17,r22
 1853               	.LBB390:
 1854               	.LBB391:
 1855               	.LBB392:
 1856               	.LBB393:
 437:../../../os/common/ports/AVR/chcore.h **** }
 1857               		.loc 4 437 0
 1858               	/* #APP */
 1859               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 1860 000a F894      		cli
 1861               	 ;  0 "" 2
 1862               	/* #NOAPP */
 1863               	.LBE393:
 1864               	.LBE392:
 1865               	.LBE391:
 1866               	.LBE390:
 693:../../../os/hal/src/hal_buffers.c ****   msg_t msg;
 694:../../../os/hal/src/hal_buffers.c **** 
 695:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 696:../../../os/hal/src/hal_buffers.c **** 
 697:../../../os/hal/src/hal_buffers.c ****   /* This condition indicates that a new buffer must be acquired.*/
 698:../../../os/hal/src/hal_buffers.c ****   if (obqp->ptr == NULL) {
 1867               		.loc 1 698 0
 1868 000c EB89      		ldd r30,Y+19
 1869 000e FC89      		ldd r31,Y+20
 1870 0010 3097      		sbiw r30,0
 1871 0012 01F0      		breq .L101
 1872               	.LVL119:
 1873               	.L91:
 699:../../../os/hal/src/hal_buffers.c ****     msg = obqGetEmptyBufferTimeoutS(obqp, timeout);
 700:../../../os/hal/src/hal_buffers.c ****     if (msg != MSG_OK) {
 701:../../../os/hal/src/hal_buffers.c ****       osalSysUnlock();
 702:../../../os/hal/src/hal_buffers.c ****       return msg;
 703:../../../os/hal/src/hal_buffers.c ****     }
 704:../../../os/hal/src/hal_buffers.c ****   }
 705:../../../os/hal/src/hal_buffers.c **** 
 706:../../../os/hal/src/hal_buffers.c ****   /* Writing the byte to the buffer.*/
 707:../../../os/hal/src/hal_buffers.c ****   *obqp->ptr = b;
 1874               		.loc 1 707 0
 1875 0014 1083      		st Z,r17
 708:../../../os/hal/src/hal_buffers.c ****   obqp->ptr++;
 1876               		.loc 1 708 0
 1877 0016 8B89      		ldd r24,Y+19
 1878 0018 9C89      		ldd r25,Y+20
 1879 001a 0196      		adiw r24,1
 1880 001c 9C8B      		std Y+20,r25
 1881 001e 8B8B      		std Y+19,r24
 709:../../../os/hal/src/hal_buffers.c **** 
 710:../../../os/hal/src/hal_buffers.c ****   /* If the current buffer has been fully written then it is posted as
 711:../../../os/hal/src/hal_buffers.c ****      full in the queue.*/
 712:../../../os/hal/src/hal_buffers.c ****   if (obqp->ptr >= obqp->top) {
 1882               		.loc 1 712 0
 1883 0020 2D89      		ldd r18,Y+21
 1884 0022 3E89      		ldd r19,Y+22
 1885 0024 8217      		cp r24,r18
 1886 0026 9307      		cpc r25,r19
 1887 0028 00F0      		brlo .L95
 1888               	.LVL120:
 1889               	.LBB394:
 1890               	.LBB395:
 653:../../../os/hal/src/hal_buffers.c **** 
 1891               		.loc 1 653 0
 1892 002a EF81      		ldd r30,Y+7
 1893 002c F885      		ldd r31,Y+8
 1894 002e 2D85      		ldd r18,Y+13
 1895 0030 3E85      		ldd r19,Y+14
 1896 0032 2250      		subi r18,2
 1897 0034 3109      		sbc r19,__zero_reg__
 1898               	.LVL121:
 1899 0036 3183      		std Z+1,r19
 1900 0038 2083      		st Z,r18
 656:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr += obqp->bsize;
 1901               		.loc 1 656 0
 1902 003a 2D81      		ldd r18,Y+5
 1903 003c 3E81      		ldd r19,Y+6
 1904               	.LVL122:
 1905 003e 2150      		subi r18,1
 1906 0040 3109      		sbc r19,__zero_reg__
 1907 0042 3E83      		std Y+6,r19
 1908 0044 2D83      		std Y+5,r18
 1909               	.LVL123:
 657:../../../os/hal/src/hal_buffers.c ****   if (obqp->bwrptr >= obqp->btop) {
 1910               		.loc 1 657 0
 1911 0046 8D85      		ldd r24,Y+13
 1912 0048 9E85      		ldd r25,Y+14
 1913 004a 8E0F      		add r24,r30
 1914 004c 9F1F      		adc r25,r31
 1915 004e 9887      		std Y+8,r25
 1916 0050 8F83      		std Y+7,r24
 658:../../../os/hal/src/hal_buffers.c ****     obqp->bwrptr = obqp->buffers;
 1917               		.loc 1 658 0
 1918 0052 2B85      		ldd r18,Y+11
 1919 0054 3C85      		ldd r19,Y+12
 1920 0056 8217      		cp r24,r18
 1921 0058 9307      		cpc r25,r19
 1922 005a 00F0      		brlo .L96
 659:../../../os/hal/src/hal_buffers.c ****   }
 1923               		.loc 1 659 0
 1924 005c 8989      		ldd r24,Y+17
 1925 005e 9A89      		ldd r25,Y+18
 1926 0060 9887      		std Y+8,r25
 1927 0062 8F83      		std Y+7,r24
 1928               	.L96:
 663:../../../os/hal/src/hal_buffers.c **** 
 1929               		.loc 1 663 0
 1930 0064 1C8A      		std Y+20,__zero_reg__
 1931 0066 1B8A      		std Y+19,__zero_reg__
 666:../../../os/hal/src/hal_buffers.c ****     obqp->notify(obqp);
 1932               		.loc 1 666 0
 1933 0068 EF89      		ldd r30,Y+23
 1934 006a F88D      		ldd r31,Y+24
 1935 006c 3097      		sbiw r30,0
 1936 006e 01F0      		breq .L95
 667:../../../os/hal/src/hal_buffers.c ****   }
 1937               		.loc 1 667 0
 1938 0070 CE01      		movw r24,r28
 1939 0072 0995      		icall
 1940               	.LVL124:
 1941               	.L95:
 1942               	.LBE395:
 1943               	.LBE394:
 1944               	.LBB396:
 1945               	.LBB397:
 1946               	.LBB398:
 1947               	.LBB399:
 1948               	.LBB400:
 1949               		.loc 4 447 0
 1950               	/* #APP */
 1951               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1952 0074 7894      		sei
 1953               	 ;  0 "" 2
 1954               	/* #NOAPP */
 1955               	.LBE400:
 1956               	.LBE399:
 1957               	.LBE398:
 1958               	.LBE397:
 1959               	.LBE396:
 713:../../../os/hal/src/hal_buffers.c ****     obqPostFullBufferS(obqp, obqp->bsize - sizeof (size_t));
 714:../../../os/hal/src/hal_buffers.c ****   }
 715:../../../os/hal/src/hal_buffers.c **** 
 716:../../../os/hal/src/hal_buffers.c ****   osalSysUnlock();
 717:../../../os/hal/src/hal_buffers.c ****   return MSG_OK;
 1960               		.loc 1 717 0
 1961 0076 80E0      		ldi r24,0
 1962 0078 90E0      		ldi r25,0
 1963               	.L93:
 1964               	/* epilogue start */
 718:../../../os/hal/src/hal_buffers.c **** }
 1965               		.loc 1 718 0
 1966 007a DF91      		pop r29
 1967 007c CF91      		pop r28
 1968               	.LVL125:
 1969 007e 1F91      		pop r17
 1970               	.LVL126:
 1971 0080 0895      		ret
 1972               	.LVL127:
 1973               	.L101:
 699:../../../os/hal/src/hal_buffers.c ****     if (msg != MSG_OK) {
 1974               		.loc 1 699 0
 1975 0082 BA01      		movw r22,r20
 1976 0084 0E94 0000 		call obqGetEmptyBufferTimeoutS
 1977               	.LVL128:
 700:../../../os/hal/src/hal_buffers.c ****       osalSysUnlock();
 1978               		.loc 1 700 0
 1979 0088 0097      		sbiw r24,0
 1980 008a 01F4      		brne .L92
 1981 008c EB89      		ldd r30,Y+19
 1982 008e FC89      		ldd r31,Y+20
 1983 0090 00C0      		rjmp .L91
 1984               	.L92:
 1985               	.LBB401:
 1986               	.LBB402:
 1987               	.LBB403:
 1988               	.LBB404:
 1989               	.LBB405:
 1990               		.loc 4 447 0
 1991               	/* #APP */
 1992               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 1993 0092 7894      		sei
 1994               	 ;  0 "" 2
 1995               	/* #NOAPP */
 1996               	.LBE405:
 1997               	.LBE404:
 1998               	.LBE403:
 1999               	.LBE402:
 2000               	.LBE401:
 702:../../../os/hal/src/hal_buffers.c ****     }
 2001               		.loc 1 702 0
 2002 0094 00C0      		rjmp .L93
 2003               		.cfi_endproc
 2004               	.LFE186:
 2006               		.section	.text.obqWriteTimeout,"ax",@progbits
 2007               	.global	obqWriteTimeout
 2009               	obqWriteTimeout:
 2010               	.LFB187:
 719:../../../os/hal/src/hal_buffers.c **** 
 720:../../../os/hal/src/hal_buffers.c **** /**
 721:../../../os/hal/src/hal_buffers.c ****  * @brief   Output queue write with timeout.
 722:../../../os/hal/src/hal_buffers.c ****  * @details The function writes data from a buffer to an output queue. The
 723:../../../os/hal/src/hal_buffers.c ****  *          operation completes when the specified amount of data has been
 724:../../../os/hal/src/hal_buffers.c ****  *          transferred or after the specified timeout or if the queue has
 725:../../../os/hal/src/hal_buffers.c ****  *          been reset.
 726:../../../os/hal/src/hal_buffers.c ****  *
 727:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 728:../../../os/hal/src/hal_buffers.c ****  * @param[in] bp        pointer to the data buffer
 729:../../../os/hal/src/hal_buffers.c ****  * @param[in] n         the maximum amount of data to be transferred, the
 730:../../../os/hal/src/hal_buffers.c ****  *                      value 0 is reserved
 731:../../../os/hal/src/hal_buffers.c ****  * @param[in] timeout   the number of ticks before the operation timeouts,
 732:../../../os/hal/src/hal_buffers.c ****  *                      the following special values are allowed:
 733:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 734:../../../os/hal/src/hal_buffers.c ****  *                      - @a TIME_INFINITE no timeout.
 735:../../../os/hal/src/hal_buffers.c ****  *                      .
 736:../../../os/hal/src/hal_buffers.c ****  * @return              The number of bytes effectively transferred.
 737:../../../os/hal/src/hal_buffers.c ****  * @retval 0            if a timeout occurred.
 738:../../../os/hal/src/hal_buffers.c ****  *
 739:../../../os/hal/src/hal_buffers.c ****  * @api
 740:../../../os/hal/src/hal_buffers.c ****  */
 741:../../../os/hal/src/hal_buffers.c **** size_t obqWriteTimeout(output_buffers_queue_t *obqp, const uint8_t *bp,
 742:../../../os/hal/src/hal_buffers.c ****                        size_t n, sysinterval_t timeout) {
 2011               		.loc 1 742 0
 2012               		.cfi_startproc
 2013               	.LVL129:
 2014 0000 4F92      		push r4
 2015               	.LCFI43:
 2016               		.cfi_def_cfa_offset 3
 2017               		.cfi_offset 4, -2
 2018 0002 5F92      		push r5
 2019               	.LCFI44:
 2020               		.cfi_def_cfa_offset 4
 2021               		.cfi_offset 5, -3
 2022 0004 6F92      		push r6
 2023               	.LCFI45:
 2024               		.cfi_def_cfa_offset 5
 2025               		.cfi_offset 6, -4
 2026 0006 7F92      		push r7
 2027               	.LCFI46:
 2028               		.cfi_def_cfa_offset 6
 2029               		.cfi_offset 7, -5
 2030 0008 8F92      		push r8
 2031               	.LCFI47:
 2032               		.cfi_def_cfa_offset 7
 2033               		.cfi_offset 8, -6
 2034 000a 9F92      		push r9
 2035               	.LCFI48:
 2036               		.cfi_def_cfa_offset 8
 2037               		.cfi_offset 9, -7
 2038 000c AF92      		push r10
 2039               	.LCFI49:
 2040               		.cfi_def_cfa_offset 9
 2041               		.cfi_offset 10, -8
 2042 000e BF92      		push r11
 2043               	.LCFI50:
 2044               		.cfi_def_cfa_offset 10
 2045               		.cfi_offset 11, -9
 2046 0010 CF92      		push r12
 2047               	.LCFI51:
 2048               		.cfi_def_cfa_offset 11
 2049               		.cfi_offset 12, -10
 2050 0012 DF92      		push r13
 2051               	.LCFI52:
 2052               		.cfi_def_cfa_offset 12
 2053               		.cfi_offset 13, -11
 2054 0014 EF92      		push r14
 2055               	.LCFI53:
 2056               		.cfi_def_cfa_offset 13
 2057               		.cfi_offset 14, -12
 2058 0016 FF92      		push r15
 2059               	.LCFI54:
 2060               		.cfi_def_cfa_offset 14
 2061               		.cfi_offset 15, -13
 2062 0018 0F93      		push r16
 2063               	.LCFI55:
 2064               		.cfi_def_cfa_offset 15
 2065               		.cfi_offset 16, -14
 2066 001a 1F93      		push r17
 2067               	.LCFI56:
 2068               		.cfi_def_cfa_offset 16
 2069               		.cfi_offset 17, -15
 2070 001c CF93      		push r28
 2071               	.LCFI57:
 2072               		.cfi_def_cfa_offset 17
 2073               		.cfi_offset 28, -16
 2074 001e DF93      		push r29
 2075               	.LCFI58:
 2076               		.cfi_def_cfa_offset 18
 2077               		.cfi_offset 29, -17
 2078               	/* prologue: function */
 2079               	/* frame size = 0 */
 2080               	/* stack size = 16 */
 2081               	.L__stack_usage = 16
 2082 0020 EC01      		movw r28,r24
 2083 0022 6B01      		movw r12,r22
 2084 0024 5A01      		movw r10,r20
 2085 0026 4901      		movw r8,r18
 2086               	.LVL130:
 2087               	.LBB406:
 2088               	.LBB407:
 2089               	.LBB408:
 2090               	.LBB409:
 437:../../../os/common/ports/AVR/chcore.h **** }
 2091               		.loc 4 437 0
 2092               	/* #APP */
 2093               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 2094 0028 F894      		cli
 2095               	 ;  0 "" 2
 2096               	/* #NOAPP */
 2097               	.LBE409:
 2098               	.LBE408:
 2099               	.LBE407:
 2100               	.LBE406:
 2101               	.LBB410:
 2102               	.LBB411:
 2103               	.LBB412:
 2104               		.loc 5 118 0
 2105 002a 4090 0000 		lds r4,ch+19
 2106 002e 5090 0000 		lds r5,ch+19+1
 2107               	.LVL131:
 2108               	.LBE412:
 2109               	.LBE411:
 2110               	.LBE410:
 2111               	.LBB413:
 2112               	.LBB414:
 2113               	.LBB415:
 479:../../../os/rt/include/chtime.h **** }
 2114               		.loc 6 479 0
 2115 0032 420E      		add r4,r18
 2116 0034 531E      		adc r5,r19
 2117               	.LVL132:
 2118               	.LBE415:
 2119               	.LBE414:
 2120               	.LBE413:
 743:../../../os/hal/src/hal_buffers.c ****   size_t w = 0;
 2121               		.loc 1 743 0
 2122 0036 E12C      		mov r14,__zero_reg__
 2123 0038 F12C      		mov r15,__zero_reg__
 2124               	.LBB416:
 2125               	.LBB417:
 744:../../../os/hal/src/hal_buffers.c ****   systime_t deadline;
 745:../../../os/hal/src/hal_buffers.c **** 
 746:../../../os/hal/src/hal_buffers.c ****   osalDbgCheck(n > 0U);
 747:../../../os/hal/src/hal_buffers.c **** 
 748:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 749:../../../os/hal/src/hal_buffers.c **** 
 750:../../../os/hal/src/hal_buffers.c ****   /* Time window for the whole operation.*/
 751:../../../os/hal/src/hal_buffers.c ****   deadline = osalTimeAddX(osalOsGetSystemTimeX(), timeout);
 752:../../../os/hal/src/hal_buffers.c **** 
 753:../../../os/hal/src/hal_buffers.c ****   while (true) {
 754:../../../os/hal/src/hal_buffers.c ****     size_t size;
 755:../../../os/hal/src/hal_buffers.c **** 
 756:../../../os/hal/src/hal_buffers.c ****     /* This condition indicates that a new buffer must be acquired.*/
 757:../../../os/hal/src/hal_buffers.c ****     if (obqp->ptr == NULL) {
 758:../../../os/hal/src/hal_buffers.c ****       msg_t msg;
 759:../../../os/hal/src/hal_buffers.c **** 
 760:../../../os/hal/src/hal_buffers.c ****       /* TIME_INFINITE and TIME_IMMEDIATE are handled differently, no
 761:../../../os/hal/src/hal_buffers.c ****          deadline.*/
 762:../../../os/hal/src/hal_buffers.c ****       if ((timeout == TIME_INFINITE) || (timeout == TIME_IMMEDIATE)) {
 2126               		.loc 1 762 0
 2127 003a 3901      		movw r6,r18
 2128 003c 21E0      		ldi r18,1
 2129 003e 621A      		sub r6,r18
 2130 0040 7108      		sbc r7,__zero_reg__
 2131               	.LVL133:
 2132 0042 00C0      		rjmp .L116
 2133               	.LVL134:
 2134               	.L121:
 2135               	.LBE417:
 763:../../../os/hal/src/hal_buffers.c ****         msg = obqGetEmptyBufferTimeoutS(obqp, timeout);
 764:../../../os/hal/src/hal_buffers.c ****       }
 765:../../../os/hal/src/hal_buffers.c ****       else {
 766:../../../os/hal/src/hal_buffers.c ****         sysinterval_t next_timeout = osalTimeDiffX(osalOsGetSystemTimeX(),
 767:../../../os/hal/src/hal_buffers.c ****                                                    deadline);
 768:../../../os/hal/src/hal_buffers.c **** 
 769:../../../os/hal/src/hal_buffers.c ****         /* Handling the case where the system time went past the deadline,
 770:../../../os/hal/src/hal_buffers.c ****            in this case next becomes a very high number because the system
 771:../../../os/hal/src/hal_buffers.c ****            time is an unsigned type.*/
 772:../../../os/hal/src/hal_buffers.c ****         if (next_timeout > timeout) {
 773:../../../os/hal/src/hal_buffers.c ****           osalSysUnlock();
 774:../../../os/hal/src/hal_buffers.c ****           return w;
 775:../../../os/hal/src/hal_buffers.c ****         }
 776:../../../os/hal/src/hal_buffers.c ****         msg = obqGetEmptyBufferTimeoutS(obqp, next_timeout);
 777:../../../os/hal/src/hal_buffers.c ****       }
 778:../../../os/hal/src/hal_buffers.c **** 
 779:../../../os/hal/src/hal_buffers.c ****       /* Anything except MSG_OK interrupts the operation.*/
 780:../../../os/hal/src/hal_buffers.c ****       if (msg != MSG_OK) {
 781:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 782:../../../os/hal/src/hal_buffers.c ****         return w;
 783:../../../os/hal/src/hal_buffers.c ****       }
 784:../../../os/hal/src/hal_buffers.c ****     }
 785:../../../os/hal/src/hal_buffers.c **** 
 786:../../../os/hal/src/hal_buffers.c ****     /* Size of the space available in the current buffer.*/
 787:../../../os/hal/src/hal_buffers.c ****     size = (size_t)obqp->top - (size_t)obqp->ptr;
 788:../../../os/hal/src/hal_buffers.c ****     if (size > (n - w)) {
 789:../../../os/hal/src/hal_buffers.c ****       size = n - w;
 790:../../../os/hal/src/hal_buffers.c ****     }
 791:../../../os/hal/src/hal_buffers.c **** 
 792:../../../os/hal/src/hal_buffers.c ****     /* Smaller chunks in order to not make the critical zone too long,
 793:../../../os/hal/src/hal_buffers.c ****        this impacts throughput however.*/
 794:../../../os/hal/src/hal_buffers.c ****     if (size > 64U) {
 795:../../../os/hal/src/hal_buffers.c ****       /* Giving the compiler a chance to optimize for a fixed size move.*/
 796:../../../os/hal/src/hal_buffers.c ****       memcpy(obqp->ptr, bp, 64U);
 2136               		.loc 1 796 0
 2137 0044 20E4      		ldi r18,lo8(64)
 2138 0046 F601      		movw r30,r12
 2139 0048 DC01      		movw r26,r24
 2140               		0:
 2141 004a 0190      		ld r0,Z+
 2142 004c 0D92      		st X+,r0
 2143 004e 2A95      		dec r18
 2144 0050 01F4      		brne 0b
 797:../../../os/hal/src/hal_buffers.c ****       bp        += 64U;
 2145               		.loc 1 797 0
 2146 0052 20E4      		ldi r18,64
 2147 0054 C20E      		add r12,r18
 2148 0056 D11C      		adc r13,__zero_reg__
 2149               	.LVL135:
 798:../../../os/hal/src/hal_buffers.c ****       obqp->ptr += 64U;
 2150               		.loc 1 798 0
 2151 0058 8B89      		ldd r24,Y+19
 2152 005a 9C89      		ldd r25,Y+20
 2153 005c 805C      		subi r24,-64
 2154 005e 9F4F      		sbci r25,-1
 2155 0060 9C8B      		std Y+20,r25
 2156 0062 8B8B      		std Y+19,r24
 799:../../../os/hal/src/hal_buffers.c ****       w         += 64U;
 2157               		.loc 1 799 0
 2158 0064 20E4      		ldi r18,64
 2159 0066 E20E      		add r14,r18
 2160 0068 F11C      		adc r15,__zero_reg__
 2161               	.LVL136:
 2162               	.L111:
 800:../../../os/hal/src/hal_buffers.c ****     }
 801:../../../os/hal/src/hal_buffers.c ****     else {
 802:../../../os/hal/src/hal_buffers.c ****       memcpy(obqp->ptr, bp, size);
 803:../../../os/hal/src/hal_buffers.c ****       bp        += size;
 804:../../../os/hal/src/hal_buffers.c ****       obqp->ptr += size;
 805:../../../os/hal/src/hal_buffers.c ****       w         += size;
 806:../../../os/hal/src/hal_buffers.c ****     }
 807:../../../os/hal/src/hal_buffers.c **** 
 808:../../../os/hal/src/hal_buffers.c ****     /* Has the current data buffer been finished? if so then release it.*/
 809:../../../os/hal/src/hal_buffers.c ****     if (obqp->ptr >= obqp->top) {
 2163               		.loc 1 809 0
 2164 006a 2D89      		ldd r18,Y+21
 2165 006c 3E89      		ldd r19,Y+22
 2166 006e 8217      		cp r24,r18
 2167 0070 9307      		cpc r25,r19
 2168 0072 00F0      		brlo .L113
 2169               	.LVL137:
 2170               	.LBB430:
 2171               	.LBB431:
 653:../../../os/hal/src/hal_buffers.c **** 
 2172               		.loc 1 653 0
 2173 0074 EF81      		ldd r30,Y+7
 2174 0076 F885      		ldd r31,Y+8
 2175 0078 8D85      		ldd r24,Y+13
 2176 007a 9E85      		ldd r25,Y+14
 2177 007c 0297      		sbiw r24,2
 2178               	.LVL138:
 2179 007e 9183      		std Z+1,r25
 2180 0080 8083      		st Z,r24
 656:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr += obqp->bsize;
 2181               		.loc 1 656 0
 2182 0082 2D81      		ldd r18,Y+5
 2183 0084 3E81      		ldd r19,Y+6
 2184 0086 2150      		subi r18,1
 2185 0088 3109      		sbc r19,__zero_reg__
 2186 008a 3E83      		std Y+6,r19
 2187 008c 2D83      		std Y+5,r18
 657:../../../os/hal/src/hal_buffers.c ****   if (obqp->bwrptr >= obqp->btop) {
 2188               		.loc 1 657 0
 2189 008e 8D85      		ldd r24,Y+13
 2190 0090 9E85      		ldd r25,Y+14
 2191               	.LVL139:
 2192 0092 8E0F      		add r24,r30
 2193 0094 9F1F      		adc r25,r31
 2194 0096 9887      		std Y+8,r25
 2195 0098 8F83      		std Y+7,r24
 658:../../../os/hal/src/hal_buffers.c ****     obqp->bwrptr = obqp->buffers;
 2196               		.loc 1 658 0
 2197 009a 2B85      		ldd r18,Y+11
 2198 009c 3C85      		ldd r19,Y+12
 2199 009e 8217      		cp r24,r18
 2200 00a0 9307      		cpc r25,r19
 2201 00a2 00F0      		brlo .L114
 659:../../../os/hal/src/hal_buffers.c ****   }
 2202               		.loc 1 659 0
 2203 00a4 8989      		ldd r24,Y+17
 2204 00a6 9A89      		ldd r25,Y+18
 2205 00a8 9887      		std Y+8,r25
 2206 00aa 8F83      		std Y+7,r24
 2207               	.L114:
 663:../../../os/hal/src/hal_buffers.c **** 
 2208               		.loc 1 663 0
 2209 00ac 1C8A      		std Y+20,__zero_reg__
 2210 00ae 1B8A      		std Y+19,__zero_reg__
 666:../../../os/hal/src/hal_buffers.c ****     obqp->notify(obqp);
 2211               		.loc 1 666 0
 2212 00b0 EF89      		ldd r30,Y+23
 2213 00b2 F88D      		ldd r31,Y+24
 2214 00b4 3097      		sbiw r30,0
 2215 00b6 01F0      		breq .L113
 667:../../../os/hal/src/hal_buffers.c ****   }
 2216               		.loc 1 667 0
 2217 00b8 CE01      		movw r24,r28
 2218 00ba 0995      		icall
 2219               	.LVL140:
 2220               	.L113:
 2221               	.LBE431:
 2222               	.LBE430:
 2223               	.LBB432:
 2224               	.LBB433:
 2225               	.LBB434:
 2226               	.LBB435:
 2227               	.LBB436:
 2228               		.loc 4 447 0
 2229               	/* #APP */
 2230               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 2231 00bc 7894      		sei
 2232               	 ;  0 "" 2
 2233               	/* #NOAPP */
 2234               	.LBE436:
 2235               	.LBE435:
 2236               	.LBE434:
 2237               	.LBE433:
 2238               	.LBE432:
 810:../../../os/hal/src/hal_buffers.c ****       obqPostFullBufferS(obqp, obqp->bsize - sizeof (size_t));
 811:../../../os/hal/src/hal_buffers.c ****     }
 812:../../../os/hal/src/hal_buffers.c **** 
 813:../../../os/hal/src/hal_buffers.c ****     /* Giving a preemption chance.*/
 814:../../../os/hal/src/hal_buffers.c ****     osalSysUnlock();
 815:../../../os/hal/src/hal_buffers.c ****     if (w >= n) {
 2239               		.loc 1 815 0
 2240 00be EA14      		cp r14,r10
 2241 00c0 FB04      		cpc r15,r11
 2242 00c2 00F0      		brlo .+2
 2243 00c4 00C0      		rjmp .L107
 2244               	.LBB437:
 2245               	.LBB438:
 2246               	.LBB439:
 2247               	.LBB440:
 437:../../../os/common/ports/AVR/chcore.h **** }
 2248               		.loc 4 437 0
 2249               	/* #APP */
 2250               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 2251 00c6 F894      		cli
 2252               	 ;  0 "" 2
 2253               	.LVL141:
 2254               	/* #NOAPP */
 2255               	.L116:
 2256               	.LBE440:
 2257               	.LBE439:
 2258               	.LBE438:
 2259               	.LBE437:
 757:../../../os/hal/src/hal_buffers.c ****       msg_t msg;
 2260               		.loc 1 757 0
 2261 00c8 8B89      		ldd r24,Y+19
 2262 00ca 9C89      		ldd r25,Y+20
 2263 00cc 0097      		sbiw r24,0
 2264 00ce 01F0      		breq .L120
 2265               	.L103:
 787:../../../os/hal/src/hal_buffers.c ****     if (size > (n - w)) {
 2266               		.loc 1 787 0
 2267 00d0 0D89      		ldd r16,Y+21
 2268 00d2 1E89      		ldd r17,Y+22
 2269               	.LVL142:
 788:../../../os/hal/src/hal_buffers.c ****       size = n - w;
 2270               		.loc 1 788 0
 2271 00d4 9501      		movw r18,r10
 2272 00d6 2E19      		sub r18,r14
 2273 00d8 3F09      		sbc r19,r15
 2274 00da 081B      		sub r16,r24
 2275 00dc 190B      		sbc r17,r25
 2276               	.LVL143:
 2277 00de 2017      		cp r18,r16
 2278 00e0 3107      		cpc r19,r17
 2279 00e2 00F4      		brsh .L109
 2280 00e4 8901      		movw r16,r18
 2281               	.LVL144:
 2282               	.L109:
 794:../../../os/hal/src/hal_buffers.c ****       /* Giving the compiler a chance to optimize for a fixed size move.*/
 2283               		.loc 1 794 0
 2284 00e6 0134      		cpi r16,65
 2285 00e8 1105      		cpc r17,__zero_reg__
 2286 00ea 00F0      		brlo .+2
 2287 00ec 00C0      		rjmp .L121
 802:../../../os/hal/src/hal_buffers.c ****       bp        += size;
 2288               		.loc 1 802 0
 2289 00ee A801      		movw r20,r16
 2290 00f0 B601      		movw r22,r12
 2291 00f2 0E94 0000 		call memcpy
 2292               	.LVL145:
 803:../../../os/hal/src/hal_buffers.c ****       obqp->ptr += size;
 2293               		.loc 1 803 0
 2294 00f6 C00E      		add r12,r16
 2295 00f8 D11E      		adc r13,r17
 2296               	.LVL146:
 804:../../../os/hal/src/hal_buffers.c ****       w         += size;
 2297               		.loc 1 804 0
 2298 00fa 8B89      		ldd r24,Y+19
 2299 00fc 9C89      		ldd r25,Y+20
 2300 00fe 800F      		add r24,r16
 2301 0100 911F      		adc r25,r17
 2302 0102 9C8B      		std Y+20,r25
 2303 0104 8B8B      		std Y+19,r24
 805:../../../os/hal/src/hal_buffers.c ****     }
 2304               		.loc 1 805 0
 2305 0106 E00E      		add r14,r16
 2306 0108 F11E      		adc r15,r17
 2307               	.LVL147:
 2308 010a 00C0      		rjmp .L111
 2309               	.LVL148:
 2310               	.L120:
 2311               	.LBB441:
 762:../../../os/hal/src/hal_buffers.c ****         msg = obqGetEmptyBufferTimeoutS(obqp, timeout);
 2312               		.loc 1 762 0
 2313 010c 8EEF      		ldi r24,-2
 2314 010e 6816      		cp r6,r24
 2315 0110 8FEF      		ldi r24,-1
 2316 0112 7806      		cpc r7,r24
 2317 0114 00F4      		brsh .L122
 2318               	.LBB418:
 2319               	.LBB419:
 2320               	.LBB420:
 2321               	.LBB421:
 2322               		.loc 5 118 0
 2323 0116 8091 0000 		lds r24,ch+19
 2324 011a 9091 0000 		lds r25,ch+19+1
 2325               	.LVL149:
 2326               	.LBE421:
 2327               	.LBE420:
 2328               	.LBE419:
 2329               	.LBB422:
 2330               	.LBB423:
 2331               	.LBB424:
 2332               		.loc 6 495 0
 2333 011e B201      		movw r22,r4
 2334 0120 681B      		sub r22,r24
 2335 0122 790B      		sbc r23,r25
 2336               	.LVL150:
 2337               	.LBE424:
 2338               	.LBE423:
 2339               	.LBE422:
 772:../../../os/hal/src/hal_buffers.c ****           osalSysUnlock();
 2340               		.loc 1 772 0
 2341 0124 8616      		cp r8,r22
 2342 0126 9706      		cpc r9,r23
 2343 0128 00F0      		brlo .L108
 776:../../../os/hal/src/hal_buffers.c ****       }
 2344               		.loc 1 776 0
 2345 012a CE01      		movw r24,r28
 2346 012c 0E94 0000 		call obqGetEmptyBufferTimeoutS
 2347               	.LVL151:
 2348               	.LBE418:
 780:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 2349               		.loc 1 780 0
 2350 0130 892B      		or r24,r25
 2351 0132 01F4      		brne .L108
 2352               	.L123:
 2353 0134 8B89      		ldd r24,Y+19
 2354 0136 9C89      		ldd r25,Y+20
 2355               	.LVL152:
 2356 0138 00C0      		rjmp .L103
 2357               	.L122:
 763:../../../os/hal/src/hal_buffers.c ****       }
 2358               		.loc 1 763 0
 2359 013a B401      		movw r22,r8
 2360 013c CE01      		movw r24,r28
 2361 013e 0E94 0000 		call obqGetEmptyBufferTimeoutS
 2362               	.LVL153:
 780:../../../os/hal/src/hal_buffers.c ****         osalSysUnlock();
 2363               		.loc 1 780 0
 2364 0142 892B      		or r24,r25
 2365 0144 01F0      		breq .L123
 2366               	.LVL154:
 2367               	.L108:
 2368               	.LBB425:
 2369               	.LBB426:
 2370               	.LBB427:
 2371               	.LBB428:
 2372               	.LBB429:
 2373               		.loc 4 447 0
 2374               	/* #APP */
 2375               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 2376 0146 7894      		sei
 2377               	 ;  0 "" 2
 2378               	/* #NOAPP */
 2379               	.L107:
 2380               	.LBE429:
 2381               	.LBE428:
 2382               	.LBE427:
 2383               	.LBE426:
 2384               	.LBE425:
 2385               	.LBE441:
 2386               	.LBE416:
 816:../../../os/hal/src/hal_buffers.c ****       return w;
 817:../../../os/hal/src/hal_buffers.c ****     }
 818:../../../os/hal/src/hal_buffers.c ****     osalSysLock();
 819:../../../os/hal/src/hal_buffers.c ****   }
 820:../../../os/hal/src/hal_buffers.c **** }
 2387               		.loc 1 820 0
 2388 0148 C701      		movw r24,r14
 2389               	/* epilogue start */
 2390 014a DF91      		pop r29
 2391 014c CF91      		pop r28
 2392               	.LVL155:
 2393 014e 1F91      		pop r17
 2394 0150 0F91      		pop r16
 2395 0152 FF90      		pop r15
 2396 0154 EF90      		pop r14
 2397               	.LVL156:
 2398 0156 DF90      		pop r13
 2399 0158 CF90      		pop r12
 2400               	.LVL157:
 2401 015a BF90      		pop r11
 2402 015c AF90      		pop r10
 2403               	.LVL158:
 2404 015e 9F90      		pop r9
 2405 0160 8F90      		pop r8
 2406               	.LVL159:
 2407 0162 7F90      		pop r7
 2408 0164 6F90      		pop r6
 2409               	.LVL160:
 2410 0166 5F90      		pop r5
 2411 0168 4F90      		pop r4
 2412 016a 0895      		ret
 2413               		.cfi_endproc
 2414               	.LFE187:
 2416               		.section	.text.obqTryFlushI,"ax",@progbits
 2417               	.global	obqTryFlushI
 2419               	obqTryFlushI:
 2420               	.LFB188:
 821:../../../os/hal/src/hal_buffers.c **** 
 822:../../../os/hal/src/hal_buffers.c **** /**
 823:../../../os/hal/src/hal_buffers.c ****  * @brief   Flushes the current, partially filled, buffer to the queue.
 824:../../../os/hal/src/hal_buffers.c ****  * @note    The notification callback is not invoked because the function
 825:../../../os/hal/src/hal_buffers.c ****  *          is meant to be called from ISR context. An operation status is
 826:../../../os/hal/src/hal_buffers.c ****  *          returned instead.
 827:../../../os/hal/src/hal_buffers.c ****  *
 828:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 829:../../../os/hal/src/hal_buffers.c ****  * @return              The operation status.
 830:../../../os/hal/src/hal_buffers.c ****  * @retval false        if no new filled buffer has been posted to the queue.
 831:../../../os/hal/src/hal_buffers.c ****  * @retval true         if a new filled buffer has been posted to the queue.
 832:../../../os/hal/src/hal_buffers.c ****  *
 833:../../../os/hal/src/hal_buffers.c ****  * @iclass
 834:../../../os/hal/src/hal_buffers.c ****  */
 835:../../../os/hal/src/hal_buffers.c **** bool obqTryFlushI(output_buffers_queue_t *obqp) {
 2421               		.loc 1 835 0
 2422               		.cfi_startproc
 2423               	.LVL161:
 2424               	/* prologue: function */
 2425               	/* frame size = 0 */
 2426               	/* stack size = 0 */
 2427               	.L__stack_usage = 0
 2428 0000 FC01      		movw r30,r24
 836:../../../os/hal/src/hal_buffers.c **** 
 837:../../../os/hal/src/hal_buffers.c ****   osalDbgCheckClassI();
 838:../../../os/hal/src/hal_buffers.c **** 
 839:../../../os/hal/src/hal_buffers.c ****   /* If queue is empty and there is a buffer partially filled and
 840:../../../os/hal/src/hal_buffers.c ****      it is not being written.*/
 841:../../../os/hal/src/hal_buffers.c ****   if (obqIsEmptyI(obqp) && (obqp->ptr != NULL)) {
 2429               		.loc 1 841 0
 2430 0002 A781      		ldd r26,Z+7
 2431 0004 B085      		ldd r27,Z+8
 2432 0006 8185      		ldd r24,Z+9
 2433 0008 9285      		ldd r25,Z+10
 2434               	.LVL162:
 2435 000a A817      		cp r26,r24
 2436 000c B907      		cpc r27,r25
 2437 000e 01F0      		breq .L133
 2438               	.L132:
 842:../../../os/hal/src/hal_buffers.c ****     size_t size = (size_t)obqp->ptr - ((size_t)obqp->bwrptr + sizeof (size_t));
 843:../../../os/hal/src/hal_buffers.c **** 
 844:../../../os/hal/src/hal_buffers.c ****     if (size > 0U) {
 845:../../../os/hal/src/hal_buffers.c **** 
 846:../../../os/hal/src/hal_buffers.c ****       /* Writing size field in the buffer.*/
 847:../../../os/hal/src/hal_buffers.c ****       *((size_t *)obqp->bwrptr) = size;
 848:../../../os/hal/src/hal_buffers.c **** 
 849:../../../os/hal/src/hal_buffers.c ****       /* Posting the buffer in the queue.*/
 850:../../../os/hal/src/hal_buffers.c ****       obqp->bcounter--;
 851:../../../os/hal/src/hal_buffers.c ****       obqp->bwrptr += obqp->bsize;
 852:../../../os/hal/src/hal_buffers.c ****       if (obqp->bwrptr >= obqp->btop) {
 853:../../../os/hal/src/hal_buffers.c ****         obqp->bwrptr = obqp->buffers;
 854:../../../os/hal/src/hal_buffers.c ****       }
 855:../../../os/hal/src/hal_buffers.c **** 
 856:../../../os/hal/src/hal_buffers.c ****       /* No "current" buffer.*/
 857:../../../os/hal/src/hal_buffers.c ****       obqp->ptr = NULL;
 858:../../../os/hal/src/hal_buffers.c **** 
 859:../../../os/hal/src/hal_buffers.c ****       return true;
 860:../../../os/hal/src/hal_buffers.c ****     }
 861:../../../os/hal/src/hal_buffers.c ****   }
 862:../../../os/hal/src/hal_buffers.c ****   return false;
 2439               		.loc 1 862 0
 2440 0010 80E0      		ldi r24,0
 863:../../../os/hal/src/hal_buffers.c **** }
 2441               		.loc 1 863 0
 2442 0012 0895      		ret
 2443               	.L133:
 841:../../../os/hal/src/hal_buffers.c ****     size_t size = (size_t)obqp->ptr - ((size_t)obqp->bwrptr + sizeof (size_t));
 2444               		.loc 1 841 0 discriminator 1
 2445 0014 8581      		ldd r24,Z+5
 2446 0016 9681      		ldd r25,Z+6
 2447 0018 892B      		or r24,r25
 2448 001a 01F0      		breq .L132
 841:../../../os/hal/src/hal_buffers.c ****     size_t size = (size_t)obqp->ptr - ((size_t)obqp->bwrptr + sizeof (size_t));
 2449               		.loc 1 841 0 is_stmt 0
 2450 001c 8389      		ldd r24,Z+19
 2451 001e 9489      		ldd r25,Z+20
 2452 0020 0097      		sbiw r24,0
 2453 0022 01F0      		breq .L132
 2454               	.LBB442:
 842:../../../os/hal/src/hal_buffers.c ****     size_t size = (size_t)obqp->ptr - ((size_t)obqp->bwrptr + sizeof (size_t));
 2455               		.loc 1 842 0 is_stmt 1
 2456 0024 0297      		sbiw r24,2
 2457 0026 8A1B      		sub r24,r26
 2458 0028 9B0B      		sbc r25,r27
 2459               	.LVL163:
 844:../../../os/hal/src/hal_buffers.c **** 
 2460               		.loc 1 844 0
 2461 002a 01F0      		breq .L132
 847:../../../os/hal/src/hal_buffers.c **** 
 2462               		.loc 1 847 0
 2463 002c 1196      		adiw r26,1
 2464 002e 9C93      		st X,r25
 2465 0030 8E93      		st -X,r24
 850:../../../os/hal/src/hal_buffers.c ****       obqp->bwrptr += obqp->bsize;
 2466               		.loc 1 850 0
 2467 0032 8581      		ldd r24,Z+5
 2468 0034 9681      		ldd r25,Z+6
 2469               	.LVL164:
 2470 0036 0197      		sbiw r24,1
 2471 0038 9683      		std Z+6,r25
 2472 003a 8583      		std Z+5,r24
 2473               	.LVL165:
 851:../../../os/hal/src/hal_buffers.c ****       if (obqp->bwrptr >= obqp->btop) {
 2474               		.loc 1 851 0
 2475 003c 8585      		ldd r24,Z+13
 2476 003e 9685      		ldd r25,Z+14
 2477 0040 A80F      		add r26,r24
 2478 0042 B91F      		adc r27,r25
 2479               	.LVL166:
 2480 0044 B087      		std Z+8,r27
 2481 0046 A783      		std Z+7,r26
 2482               	.LVL167:
 852:../../../os/hal/src/hal_buffers.c ****         obqp->bwrptr = obqp->buffers;
 2483               		.loc 1 852 0
 2484 0048 8385      		ldd r24,Z+11
 2485 004a 9485      		ldd r25,Z+12
 2486 004c A817      		cp r26,r24
 2487 004e B907      		cpc r27,r25
 2488 0050 00F0      		brlo .L127
 853:../../../os/hal/src/hal_buffers.c ****       }
 2489               		.loc 1 853 0
 2490 0052 8189      		ldd r24,Z+17
 2491 0054 9289      		ldd r25,Z+18
 2492 0056 9087      		std Z+8,r25
 2493 0058 8783      		std Z+7,r24
 2494               	.L127:
 857:../../../os/hal/src/hal_buffers.c **** 
 2495               		.loc 1 857 0
 2496 005a 148A      		std Z+20,__zero_reg__
 2497 005c 138A      		std Z+19,__zero_reg__
 859:../../../os/hal/src/hal_buffers.c ****     }
 2498               		.loc 1 859 0
 2499 005e 81E0      		ldi r24,lo8(1)
 2500 0060 0895      		ret
 2501               	.LBE442:
 2502               		.cfi_endproc
 2503               	.LFE188:
 2505               		.section	.text.obqFlush,"ax",@progbits
 2506               	.global	obqFlush
 2508               	obqFlush:
 2509               	.LFB189:
 864:../../../os/hal/src/hal_buffers.c **** 
 865:../../../os/hal/src/hal_buffers.c **** /**
 866:../../../os/hal/src/hal_buffers.c ****  * @brief   Flushes the current, partially filled, buffer to the queue.
 867:../../../os/hal/src/hal_buffers.c ****  *
 868:../../../os/hal/src/hal_buffers.c ****  * @param[in] obqp      pointer to the @p output_buffers_queue_t object
 869:../../../os/hal/src/hal_buffers.c ****  *
 870:../../../os/hal/src/hal_buffers.c ****  * @api
 871:../../../os/hal/src/hal_buffers.c ****  */
 872:../../../os/hal/src/hal_buffers.c **** void obqFlush(output_buffers_queue_t *obqp) {
 2510               		.loc 1 872 0
 2511               		.cfi_startproc
 2512               	.LVL168:
 2513               	/* prologue: function */
 2514               	/* frame size = 0 */
 2515               	/* stack size = 0 */
 2516               	.L__stack_usage = 0
 2517 0000 DC01      		movw r26,r24
 2518               	.LBB443:
 2519               	.LBB444:
 2520               	.LBB445:
 2521               	.LBB446:
 437:../../../os/common/ports/AVR/chcore.h **** }
 2522               		.loc 4 437 0
 2523               	/* #APP */
 2524               	 ;  437 "../../../os/common/ports/AVR/chcore.h" 1
 2525 0002 F894      		cli
 2526               	 ;  0 "" 2
 2527               	/* #NOAPP */
 2528               	.LBE446:
 2529               	.LBE445:
 2530               	.LBE444:
 2531               	.LBE443:
 873:../../../os/hal/src/hal_buffers.c **** 
 874:../../../os/hal/src/hal_buffers.c ****   osalSysLock();
 875:../../../os/hal/src/hal_buffers.c **** 
 876:../../../os/hal/src/hal_buffers.c ****   /* If there is a buffer partially filled and not being written.*/
 877:../../../os/hal/src/hal_buffers.c ****   if (obqp->ptr != NULL) {
 2532               		.loc 1 877 0
 2533 0004 5396      		adiw r26,19
 2534 0006 8D91      		ld r24,X+
 2535 0008 9C91      		ld r25,X
 2536 000a 5497      		sbiw r26,19+1
 2537               	.LVL169:
 2538 000c 0097      		sbiw r24,0
 2539 000e 01F0      		breq .L136
 2540               	.LBB447:
 878:../../../os/hal/src/hal_buffers.c ****     size_t size = ((size_t)obqp->ptr - (size_t)obqp->bwrptr) - sizeof (size_t);
 2541               		.loc 1 878 0
 2542 0010 1796      		adiw r26,7
 2543 0012 ED91      		ld r30,X+
 2544 0014 FC91      		ld r31,X
 2545 0016 1897      		sbiw r26,7+1
 2546 0018 0297      		sbiw r24,2
 2547 001a 8E1B      		sub r24,r30
 2548 001c 9F0B      		sbc r25,r31
 2549               	.LVL170:
 879:../../../os/hal/src/hal_buffers.c **** 
 880:../../../os/hal/src/hal_buffers.c ****     if (size > 0U) {
 2550               		.loc 1 880 0
 2551 001e 01F0      		breq .L136
 2552               	.LVL171:
 2553               	.LBB448:
 2554               	.LBB449:
 653:../../../os/hal/src/hal_buffers.c **** 
 2555               		.loc 1 653 0
 2556 0020 9183      		std Z+1,r25
 2557 0022 8083      		st Z,r24
 656:../../../os/hal/src/hal_buffers.c ****   obqp->bwrptr += obqp->bsize;
 2558               		.loc 1 656 0
 2559 0024 1596      		adiw r26,5
 2560 0026 8D91      		ld r24,X+
 2561 0028 9C91      		ld r25,X
 2562 002a 1697      		sbiw r26,5+1
 2563               	.LVL172:
 2564 002c 0197      		sbiw r24,1
 2565 002e 1696      		adiw r26,5+1
 2566 0030 9C93      		st X,r25
 2567 0032 8E93      		st -X,r24
 2568 0034 1597      		sbiw r26,5
 2569               	.LVL173:
 657:../../../os/hal/src/hal_buffers.c ****   if (obqp->bwrptr >= obqp->btop) {
 2570               		.loc 1 657 0
 2571 0036 1D96      		adiw r26,13
 2572 0038 8D91      		ld r24,X+
 2573 003a 9C91      		ld r25,X
 2574 003c 1E97      		sbiw r26,13+1
 2575 003e E80F      		add r30,r24
 2576 0040 F91F      		adc r31,r25
 2577               	.LVL174:
 2578 0042 1896      		adiw r26,7+1
 2579 0044 FC93      		st X,r31
 2580 0046 EE93      		st -X,r30
 2581 0048 1797      		sbiw r26,7
 2582               	.LVL175:
 658:../../../os/hal/src/hal_buffers.c ****     obqp->bwrptr = obqp->buffers;
 2583               		.loc 1 658 0
 2584 004a 1B96      		adiw r26,11
 2585 004c 8D91      		ld r24,X+
 2586 004e 9C91      		ld r25,X
 2587 0050 1C97      		sbiw r26,11+1
 2588 0052 E817      		cp r30,r24
 2589 0054 F907      		cpc r31,r25
 2590 0056 00F0      		brlo .L138
 659:../../../os/hal/src/hal_buffers.c ****   }
 2591               		.loc 1 659 0
 2592 0058 5196      		adiw r26,17
 2593 005a 8D91      		ld r24,X+
 2594 005c 9C91      		ld r25,X
 2595 005e 5297      		sbiw r26,17+1
 2596 0060 1896      		adiw r26,7+1
 2597 0062 9C93      		st X,r25
 2598 0064 8E93      		st -X,r24
 2599 0066 1797      		sbiw r26,7
 2600               	.L138:
 663:../../../os/hal/src/hal_buffers.c **** 
 2601               		.loc 1 663 0
 2602 0068 5496      		adiw r26,19+1
 2603 006a 1C92      		st X,__zero_reg__
 2604 006c 1E92      		st -X,__zero_reg__
 2605 006e 5397      		sbiw r26,19
 666:../../../os/hal/src/hal_buffers.c ****     obqp->notify(obqp);
 2606               		.loc 1 666 0
 2607 0070 5796      		adiw r26,23
 2608 0072 ED91      		ld r30,X+
 2609 0074 FC91      		ld r31,X
 2610 0076 5897      		sbiw r26,23+1
 2611 0078 3097      		sbiw r30,0
 2612 007a 01F0      		breq .L136
 2613 007c CD01      		movw r24,r26
 667:../../../os/hal/src/hal_buffers.c ****   }
 2614               		.loc 1 667 0
 2615 007e 0995      		icall
 2616               	.LVL176:
 2617               	.L136:
 2618               	.LBE449:
 2619               	.LBE448:
 2620               	.LBE447:
 2621               	.LBB450:
 2622               	.LBB451:
 2623               	.LBB452:
 2624               	.LBB453:
 2625               	.LBB454:
 2626               		.loc 4 447 0
 2627               	/* #APP */
 2628               	 ;  447 "../../../os/common/ports/AVR/chcore.h" 1
 2629 0080 7894      		sei
 2630               	 ;  0 "" 2
 2631               	/* #NOAPP */
 2632 0082 0895      		ret
 2633               	.LBE454:
 2634               	.LBE453:
 2635               	.LBE452:
 2636               	.LBE451:
 2637               	.LBE450:
 2638               		.cfi_endproc
 2639               	.LFE189:
 2641               		.text
 2642               	.Letext0:
 2643               		.file 7 "/usr/lib/gcc/avr/5.4.0/include/stddef.h"
 2644               		.file 8 "/usr/lib/avr/include/stdint.h"
 2645               		.file 9 "../../../os/common/ports/AVR/compilers/GCC/chtypes.h"
 2646               		.file 10 "../../../os/rt/include/chsystypes.h"
 2647               		.file 11 "../../../os/rt/include/chsem.h"
 2648               		.file 12 "../../../os/rt/include/chmtx.h"
 2649               		.file 13 "../../../os/hal/include/hal_buffers.h"
 2650               		.file 14 "../../../os/rt/include/chsys.h"
 2651               		.file 15 "../../../os/rt/include/chthreads.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 hal_buffers.c
     /tmp/cc35uMUY.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/cc35uMUY.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/cc35uMUY.s:4      *ABS*:000000000000003f __SREG__
     /tmp/cc35uMUY.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/cc35uMUY.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/cc35uMUY.s:13     .text.ibqObjectInit:0000000000000000 ibqObjectInit
     /tmp/cc35uMUY.s:131    .text.ibqResetI:0000000000000000 ibqResetI
     /tmp/cc35uMUY.s:177    .text.ibqGetEmptyBufferI:0000000000000000 ibqGetEmptyBufferI
     /tmp/cc35uMUY.s:218    .text.ibqPostFullBufferI:0000000000000000 ibqPostFullBufferI
     /tmp/cc35uMUY.s:279    .text.ibqGetFullBufferTimeoutS:0000000000000000 ibqGetFullBufferTimeoutS
     /tmp/cc35uMUY.s:390    .text.ibqGetFullBufferTimeout:0000000000000000 ibqGetFullBufferTimeout
     /tmp/cc35uMUY.s:441    .text.ibqReleaseEmptyBuffer:0000000000000000 ibqReleaseEmptyBuffer
     /tmp/cc35uMUY.s:554    .text.ibqReleaseEmptyBufferS:0000000000000000 ibqReleaseEmptyBufferS
     /tmp/cc35uMUY.s:632    .text.ibqGetTimeout:0000000000000000 ibqGetTimeout
     /tmp/cc35uMUY.s:801    .text.ibqReadTimeout:0000000000000000 ibqReadTimeout
     /tmp/cc35uMUY.s:1205   .text.obqObjectInit:0000000000000000 obqObjectInit
     /tmp/cc35uMUY.s:1321   .text.obqResetI:0000000000000000 obqResetI
     /tmp/cc35uMUY.s:1368   .text.obqGetFullBufferI:0000000000000000 obqGetFullBufferI
     /tmp/cc35uMUY.s:1416   .text.obqReleaseEmptyBufferI:0000000000000000 obqReleaseEmptyBufferI
     /tmp/cc35uMUY.s:1471   .text.obqGetEmptyBufferTimeoutS:0000000000000000 obqGetEmptyBufferTimeoutS
     /tmp/cc35uMUY.s:1581   .text.obqGetEmptyBufferTimeout:0000000000000000 obqGetEmptyBufferTimeout
     /tmp/cc35uMUY.s:1631   .text.obqPostFullBuffer:0000000000000000 obqPostFullBuffer
     /tmp/cc35uMUY.s:1748   .text.obqPostFullBufferS:0000000000000000 obqPostFullBufferS
     /tmp/cc35uMUY.s:1830   .text.obqPutTimeout:0000000000000000 obqPutTimeout
     /tmp/cc35uMUY.s:2009   .text.obqWriteTimeout:0000000000000000 obqWriteTimeout
     /tmp/cc35uMUY.s:2419   .text.obqTryFlushI:0000000000000000 obqTryFlushI
     /tmp/cc35uMUY.s:2508   .text.obqFlush:0000000000000000 obqFlush

UNDEFINED SYMBOLS
chThdDequeueAllI
chThdDequeueNextI
chThdEnqueueTimeoutS
ch
memcpy
